(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

/*  static collision detection worker */

var distance2d = function distance2d(a, b) {
	return Math.sqrt(Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2));
},
    distance2dCompare = function distance2dCompare(a, b, n) {
	// more efficient version of distance2d()
	return Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2) < n * n;
},
    distance3dCompare = function distance3dCompare(a, b, n) {
	// ..faster than using Math.sqrt()
	return Math.pow(a[0] - b[0], 2) + Math.pow(a[1] - b[1], 2) + Math.pow(a[2] - b[2], 2) < n * n;
};

var observer = {
	position: [0, 0, 0],
	prevPos: [0, 0, 0],
	velocity: [0, 0, 0],
	vrHeight: 1.66
},
    voxelList = [],
    voxels = [];

self.update = function () {

	var distance = 0,
	    position = observer.position,
	    innerBox = [false, false],
	    velocity = observer.velocity,
	    vrHeight = observer.vrHeight,
	    collision = false,
	    yPos = 0,
	    voxel = null,
	    ent = null,
	    entRadius = 10,
	    structure = null,
	    bounds = [0, 0],
	    voxel = null,
	    delta = [0, 0],
	    oPos = [],
	    speed = 0,
	    e = 0,
	    i = 0,
	    v = 0;

	for (i = 0; i < voxelList.length; i++) {
		voxel = voxelList[i];

		if (!!!voxel || !!!voxel.position) continue;
		if (!!voxel && distance2dCompare(position, voxel.position, 180)) {
			// do collisions on voxels & structures... just walls at first..
			if (voxel.loaded == undefined) {
				voxel.loaded = true;
				self.postMessage('{"command": "load entities", "data":{"coords":"' + voxel.cell[0] + '.' + voxel.cell[1] + '.' + voxel.cell[2] + '"}}');
			}
			if (distance2dCompare(position, voxel.position, 60)) {

				var alt = voxel.altitude || 0;

				yPos = voxel.position[1];
				if (distance2dCompare(position, voxel.position, 24.5)) {
					if (position[1] > yPos - 21 + vrHeight && position[1] < 14.25 + yPos + (vrHeight != 0 ? vrHeight + 0.25 : 0)) {
						collision = true;
						self.postMessage('{"command": "platform collision", "data":{"type":"top", "position":[' + voxel.position[0] + ',' + yPos + ',' + voxel.position[2] + '] }}');
					}
				}
				if (!!voxel.entities && voxel.entities.length > 0) {
					collision = self.checkStaticCollisions(voxel, position);
				}
			}
		}
	}

	if (!collision) observer.prevPos = [observer.position[0], observer.position[1], observer.position[2]];

	self.postMessage('{"command": "update"}');
	self.updateLoop = setTimeout(function () {
		self.update();
	}, 15);
};

self.checkStaticCollisions = function (voxel, position) {
	var e = voxel.entities.length - 1,
	    ent = null,
	    entRadius = 10,
	    collision = false;

	while (e >= 0) {
		ent = voxel.entities[e];
		entRadius = ent.boundingRadius;
		if (!!!ent || !!!ent.components) {
			console.warn("Problem with entity! ", e, ent);continue;
		}
		if (distance3dCompare(position, [ent.position[0] - entRadius / 2.0, ent.position[1], ent.position[2] - entRadius / 2.0], (entRadius * 1.6 || 3) + 2.5)) {

			ent.components.map(function (entComp) {
				var boundingRadius = entComp.boundingRadius * 1.2 || Math.max(entComp.props.geometry.size[0], entComp.props.geometry.size[2]) * 1.2;

				if (!!entComp.props.floor) {
					var rootPos = ent.position.map(function (v) {
						return v - ent.boundingRadius / 2.0;
					});
					if (distance2dCompare(position, [rootPos[0] + entComp.position[0], 0, rootPos[2] + entComp.position[2]], boundingRadius * 1.7)) {
						var verticalOffset = position[1] + 2 - (entComp.position[1] + ent.position[1]); //  + entComp.geometry ? entComp.geometry.size[1] : 1
						if (verticalOffset > 0 && verticalOffset < 5) {
							self.postMessage(JSON.stringify({
								command: "floor collision", data: {
									position: entComp.position,
									floorData: entComp.props.floor
								}
							}));
							collision = true;
						}
					}
				} else if (distance3dCompare(position, [ent.position[0] + entComp.position[0], ent.position[1] + entComp.position[1], ent.position[2] + entComp.position[2]], boundingRadius)) {
					collision = true;
					self.postMessage(JSON.stringify({ command: "entity-user collision", data: { position: entComp.position } }));
				}
			});
		}
		e -= 1;
	}
	return collision;
};

self.onmessage = function (event) {

	var message = JSON.parse(event.data),
	    data = message.data,
	    user = observer,
	    voxel = null,
	    toRemove = null,
	    items = [],
	    entities = [],
	    c = 0,
	    p = 0;

	if (message.command == "update") {
		// user.prevPos = [user.position[0], user.position[1], user.position[2]];
		user.position = data.position;
		user.velocity = data.velocity;
		user.vrHeight = data.vrHeight;
		//self.postMessage(JSON.stringify(self.observer));
	} else if (message.command == "add voxels") {
		self.addVoxels(message, data);
	} else if (message.command == "remove voxels") {
		self.removeVoxels(message, data);
	} else if (message.command == "add entity") {
		self.addEntity();
	} else if (message.command == "remove entity") {
		self.removeEntity(message, data);
	} else if (message.command == "update entity" || message.command == "update telemetry") {
		if (message.command == "update entity") {
			self.updateEntity(message, data);
		} else {
			self.updateTelemetry(message, data);
		}
	} else if (message.command == "clear") {
		voxels = [];
		voxelList = [];
	} else if (message.command == "start") {
		self.update();
	} else if (message.command == "stop") {
		self.stop();
	} else if (message.command == "log") {
		if (data == "") {
			self.postMessage('{"command":"log","data":[' + user.position[0] + ',' + user.position[1] + ',' + user.position[2] + ']}');
			self.postMessage('{"command":"log","data":' + JSON.stringify(voxels) + '}');
		}
	}
};

self.addVoxels = function (message, data) {
	voxelList = voxelList.concat(data);
	data.map(function (v) {
		voxels[v.cell.join(".")] = v;
	});
};

self.removeVoxels = function (message, data) {
	var toRemove = null,
	    voxel = null,
	    c = 0,
	    p = data.length - 1;

	while (p >= 0) {
		toRemove = data[p];
		c = voxelList.length - 1;

		while (c >= 0) {
			voxel = voxelList[c];
			if (voxel != null && voxel.cell[0] == toRemove.cell[0] && voxel.cell[1] == toRemove.cell[1] && voxel.cell[2] == toRemove.cell[2]) {
				voxelList.splice(c, 1);
				voxels[voxel.cell.join(".")] = null;
			}
			c--;
		}
		p--;
	}
};

self.addEntity = function (message, data) {
	if (!data) {
		console.warn("no data for addEntity");
		return;
	}
	if (!!!voxels[data.coords.join(".")]) {
		voxels[data.coords.join(".")] = { entities: [], cell: data.coords };
	}
	var entities = voxels[data.coords.join(".")].entities;

	entities.push(data.entity);
};

self.removeEntity = function (message, data) {
	var entities = voxels[data.coords.join(".")].entities;

	if (entities != null) {
		var c = entities.length - 1;

		while (c >= 0) {
			if (entities[c].id == data.entityId) {
				voxels[data.coords.join(".")].entities.splice(c, 1);
				c = -1;
			}
			c--;
		}
	}
};

self.updateEntity = function (message, data) {
	var cell = data.coords.join(".");

	if (!data || !data.coords) {
		console.warn("no data to update entity");
		return;
	}
	if (!voxels[cell]) {
		console.warn("can't update entity with no voxel");
		return;
	}
	var entities = voxels[cell].entities;

	if (entities != null) {
		var c = entities.length - 1;

		while (c >= 0) {
			if (entities[c].id == data.entityId) {
				entities[c] = data.entity;
				c = -1;
			}
			c--;
		}
	}
};

self.updateTelemetry = function (message, data) {

	console.warn("physics worker: updateTelemetry()", message, data);
	if (!data || !data.coords) {
		console.warn("no data to update entity");
		return;
	}
	var cell = data.coords.join(".");

	if (!voxels[cell]) {
		console.warn("can't update entity with no voxel");
		return;
	}
	var entities = voxels[cell].entities,
	    oldCell = message.data.oldCoords.join("."),
	    oldEntities = voxels[oldCell];

	if (oldCell != cell) {
		var c = oldEntities.length - 1;

		while (c >= 0) {
			var movedEnt = oldEntities[c];
			if (movedEnt.id == data.entityId) {
				oldEntities.splice(oldEntities.indexOf(movedEnt), 1);
				entities.push(movedEnt);
				console.log("physics worker: update telemetry: moved between voxels");
				movedEnt.position = data.position;
				if (data.quaternion) {
					movedEnt.quaternion = data.quaternion;
				}
				c = -1;
			}
		}
	} else {
		if (entities != null) {
			var _c = entities.length - 1;
			while (_c >= 0) {
				if (entities[_c].id == data.entityId) {
					console.info("physics worker: update telemetry");
					entities[_c].position = data.position;
					if (data.quaternion) {
						entities[_c].quaternion = data.quaternion;
					}
					_c = -1;
				}
				_c--;
			}
		}
	}
};

self.stop = function () {
	clearTimeout(self.updateLoop);
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmNcXHdvcmtlcnNcXHN0YXRpYy1jb2xsaXNpb25zLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQTs7QUFFQSxJQUFJLGFBQWEsU0FBYixVQUFhLENBQUUsQ0FBRixFQUFLLENBQUwsRUFBWTtBQUN6QixRQUFPLEtBQUssSUFBTCxDQUFXLEtBQUssR0FBTCxDQUFXLEVBQUUsQ0FBRixJQUFLLEVBQUUsQ0FBRixDQUFoQixFQUF1QixDQUF2QixJQUE2QixLQUFLLEdBQUwsQ0FBVyxFQUFFLENBQUYsSUFBSyxFQUFFLENBQUYsQ0FBaEIsRUFBdUIsQ0FBdkIsQ0FBeEMsQ0FBUDtBQUNELENBRkg7QUFBQSxJQUdFLG9CQUFvQixTQUFwQixpQkFBb0IsQ0FBRSxDQUFGLEVBQUssQ0FBTCxFQUFRLENBQVIsRUFBZTtBQUFFO0FBQ3BDLFFBQU8sS0FBSyxHQUFMLENBQVcsRUFBRSxDQUFGLElBQUssRUFBRSxDQUFGLENBQWhCLEVBQXVCLENBQXZCLElBQTZCLEtBQUssR0FBTCxDQUFXLEVBQUUsQ0FBRixJQUFLLEVBQUUsQ0FBRixDQUFoQixFQUF1QixDQUF2QixDQUE3QixHQUEyRCxJQUFFLENBQXBFO0FBQ0EsQ0FMSDtBQUFBLElBTUUsb0JBQW9CLFNBQXBCLGlCQUFvQixDQUFFLENBQUYsRUFBSyxDQUFMLEVBQVEsQ0FBUixFQUFlO0FBQUU7QUFDcEMsUUFBUSxLQUFLLEdBQUwsQ0FBVyxFQUFFLENBQUYsSUFBSyxFQUFFLENBQUYsQ0FBaEIsRUFBdUIsQ0FBdkIsSUFBNkIsS0FBSyxHQUFMLENBQVcsRUFBRSxDQUFGLElBQUssRUFBRSxDQUFGLENBQWhCLEVBQXVCLENBQXZCLENBQTdCLEdBQTBELEtBQUssR0FBTCxDQUFXLEVBQUUsQ0FBRixJQUFLLEVBQUUsQ0FBRixDQUFoQixFQUF1QixDQUF2QixDQUEzRCxHQUEyRixJQUFFLENBQXBHO0FBQ0EsQ0FSSDs7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QSxPQUFJLFNBQVMsRUFBVCxJQUFlLEtBQUssUUFBeEIsRUFBa0M7QUFDakMsZ0JBQVksTUFBWixDQUFtQixZQUFZLE9BQVosQ0FBb0IsUUFBcEIsQ0FBbkIsRUFBa0QsQ0FBbEQ7QUFDQSxhQUFTLElBQVQsQ0FBYyxRQUFkO0FBQ0EsWUFBUSxHQUFSLENBQVksd0RBQVo7QUFDQSxhQUFTLFFBQVQsR0FBb0IsS0FBSyxRQUF6QjtBQUNBLFFBQUksS0FBSyxVQUFULEVBQXFCO0FBQ3BCLGNBQVMsVUFBVCxHQUFzQixLQUFLLFVBQTNCO0FBQ0E7QUFDRCxRQUFJLENBQUMsQ0FBTDtBQUNBO0FBQ0Q7QUFFRCxFQWpCRCxNQWlCTztBQUNOLE1BQUksWUFBWSxJQUFoQixFQUFzQjtBQUNyQixPQUFJLEtBQUksU0FBUyxNQUFULEdBQWtCLENBQTFCO0FBQ0EsVUFBTyxNQUFLLENBQVosRUFBZTtBQUNkLFFBQUksU0FBUyxFQUFULEVBQVksRUFBWixJQUFrQixLQUFLLFFBQTNCLEVBQXFDO0FBQ3BDLGFBQVEsSUFBUixDQUFhLGtDQUFiO0FBQ0EsY0FBUyxFQUFULEVBQVksUUFBWixHQUF1QixLQUFLLFFBQTVCO0FBQ0EsU0FBSSxLQUFLLFVBQVQsRUFBcUI7QUFDcEIsZUFBUyxFQUFULEVBQVksVUFBWixHQUF5QixLQUFLLFVBQTlCO0FBQ0E7QUFDRCxVQUFJLENBQUMsQ0FBTDtBQUNBO0FBQ0Q7QUFDQTtBQUNEO0FBQ0Q7QUFDRCxDQWxERDs7QUFvREEsS0FBSyxJQUFMLEdBQVksWUFBTTtBQUNqQixjQUFjLEtBQUssVUFBbkI7QUFDQSxDQUZEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qICBzdGF0aWMgY29sbGlzaW9uIGRldGVjdGlvbiB3b3JrZXIgKi9cclxuXHJcbmxldCBkaXN0YW5jZTJkID0gKCBhLCBiICkgPT4ge1xyXG4gICAgcmV0dXJuIE1hdGguc3FydCggTWF0aC5wb3coIChhWzBdLWJbMF0pLCAyICkgKyBNYXRoLnBvdyggKGFbMl0tYlsyXSksIDIgKSApXHJcbiAgfSxcclxuICBkaXN0YW5jZTJkQ29tcGFyZSA9ICggYSwgYiwgbiApID0+IHsgLy8gbW9yZSBlZmZpY2llbnQgdmVyc2lvbiBvZiBkaXN0YW5jZTJkKClcclxuXHQgIHJldHVybiBNYXRoLnBvdyggKGFbMF0tYlswXSksIDIgKSArIE1hdGgucG93KCAoYVsyXS1iWzJdKSwgMiApIDwgKG4qbilcclxuICB9LFxyXG4gIGRpc3RhbmNlM2RDb21wYXJlID0gKCBhLCBiLCBuICkgPT4geyAvLyAuLmZhc3RlciB0aGFuIHVzaW5nIE1hdGguc3FydCgpXHJcblx0ICByZXR1cm4gKE1hdGgucG93KCAoYVswXS1iWzBdKSwgMiApICsgTWF0aC5wb3coIChhWzFdLWJbMV0pLCAyICkgKyBNYXRoLnBvdyggKGFbMl0tYlsyXSksIDIgKSApIDwgKG4qbilcclxuICB9XHJcblxyXG5sZXQgb2JzZXJ2ZXIgPSB7XHJcblx0XHRwb3NpdGlvbjogWzAsIDAsIDBdLFxyXG5cdFx0cHJldlBvczogWzAsIDAsIDBdLFxyXG5cdFx0dmVsb2NpdHk6IFswLCAwLCAwXSxcclxuXHRcdHZySGVpZ2h0OiAxLjY2XHJcblx0fSxcclxuXHR2b3hlbExpc3QgPSBbXSxcclxuXHR2b3hlbHMgPSBbXVxyXG5cclxuc2VsZi51cGRhdGUgPSAoICkgPT4ge1xyXG5cclxuXHR2YXIgZGlzdGFuY2UgPSAwLFxyXG5cdFx0cG9zaXRpb24gXHQgPSBvYnNlcnZlci5wb3NpdGlvbixcclxuXHRcdGlubmVyQm94IFx0ID0gW2ZhbHNlLCBmYWxzZV0sXHJcblx0XHR2ZWxvY2l0eSBcdCA9IG9ic2VydmVyLnZlbG9jaXR5LFxyXG5cdFx0dnJIZWlnaHQgXHQgPSBvYnNlcnZlci52ckhlaWdodCxcclxuXHRcdGNvbGxpc2lvbiBcdCA9IGZhbHNlLFxyXG5cdFx0eVBvcyBcdFx0ID0gMCxcclxuXHRcdHZveGVsIFx0XHQgPSBudWxsLFxyXG5cdFx0ZW50IFx0XHQgPSBudWxsLFxyXG5cdFx0ZW50UmFkaXVzICAgID0gMTAsXHJcblx0XHRzdHJ1Y3R1cmUgXHQgPSBudWxsLFxyXG5cdFx0Ym91bmRzIFx0XHQgPSBbMCwgMF0sXHJcblx0XHR2b3hlbCBcdFx0ID0gbnVsbCxcclxuXHRcdGRlbHRhIFx0XHQgPSBbMCwgMF0sXHJcblx0XHRvUG9zIFx0XHQgPSBbXSxcclxuXHRcdHNwZWVkIFx0XHQgPSAwLFxyXG5cdFx0ZSBcdFx0XHQgPSAwLFxyXG5cdFx0aSBcdFx0XHQgPSAwLFxyXG5cdFx0diBcdFx0XHQgPSAwXHJcblxyXG5cdGZvciAoIGkgPSAwOyBpIDwgdm94ZWxMaXN0Lmxlbmd0aDsgaSArKyApIHtcclxuXHRcdHZveGVsID0gdm94ZWxMaXN0WyBpIF1cclxuXHJcblx0XHRpZiAoICEhIXZveGVsIHx8ICEhIXZveGVsLnBvc2l0aW9uKSBjb250aW51ZVxyXG5cdFx0aWYgKCAhIXZveGVsICYmIGRpc3RhbmNlMmRDb21wYXJlKCBwb3NpdGlvbiwgdm94ZWwucG9zaXRpb24sIDE4MCApICkgeyBcdC8vIGRvIGNvbGxpc2lvbnMgb24gdm94ZWxzICYgc3RydWN0dXJlcy4uLiBqdXN0IHdhbGxzIGF0IGZpcnN0Li5cclxuXHRcdFx0aWYgKCB2b3hlbC5sb2FkZWQgPT0gdW5kZWZpbmVkICkge1xyXG5cdFx0XHRcdHZveGVsLmxvYWRlZCA9IHRydWVcclxuXHRcdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6IFwibG9hZCBlbnRpdGllc1wiLCBcImRhdGFcIjp7XCJjb29yZHNcIjpcIicrdm94ZWwuY2VsbFswXSsnLicrdm94ZWwuY2VsbFsxXSsnLicrdm94ZWwuY2VsbFsyXSsnXCJ9fScpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICggZGlzdGFuY2UyZENvbXBhcmUoIHBvc2l0aW9uLCB2b3hlbC5wb3NpdGlvbiwgNjAgKSApIHtcclxuXHJcblx0XHRcdFx0bGV0IGFsdCA9IHZveGVsLmFsdGl0dWRlIHx8IDBcclxuXHJcblx0XHRcdFx0eVBvcyA9IHZveGVsLnBvc2l0aW9uWzFdXHJcblx0XHRcdFx0aWYgKCBkaXN0YW5jZTJkQ29tcGFyZSggcG9zaXRpb24sIHZveGVsLnBvc2l0aW9uLCAyNC41ICkgKSB7XHJcblx0XHRcdFx0XHRpZiAoIHBvc2l0aW9uWzFdID4geVBvcyAtIDIxICsgdnJIZWlnaHQgICYmIHBvc2l0aW9uWzFdIDwgMTQuMjUreVBvcyArICh2ckhlaWdodCAhPSAwID8gdnJIZWlnaHQrMC4yNSA6IDApICkge1xyXG5cdFx0XHRcdFx0XHRjb2xsaXNpb24gPSB0cnVlXHJcblx0XHRcdFx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoJ3tcImNvbW1hbmRcIjogXCJwbGF0Zm9ybSBjb2xsaXNpb25cIiwgXCJkYXRhXCI6e1widHlwZVwiOlwidG9wXCIsIFwicG9zaXRpb25cIjpbJyArIHZveGVsLnBvc2l0aW9uWzBdICsgJywnICsgeVBvcyArICcsJyArIHZveGVsLnBvc2l0aW9uWzJdICsgJ10gfX0nKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKCAhIXZveGVsLmVudGl0aWVzICYmIHZveGVsLmVudGl0aWVzLmxlbmd0aCA+IDAgKSB7XHJcblx0XHRcdFx0XHRjb2xsaXNpb24gPSBzZWxmLmNoZWNrU3RhdGljQ29sbGlzaW9ucyggdm94ZWwsIHBvc2l0aW9uIClcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGlmICggIWNvbGxpc2lvbiApXHJcblx0XHRvYnNlcnZlci5wcmV2UG9zID0gWyBvYnNlcnZlci5wb3NpdGlvblswXSwgb2JzZXJ2ZXIucG9zaXRpb25bMV0sIG9ic2VydmVyLnBvc2l0aW9uWzJdIF1cclxuXHJcblx0c2VsZi5wb3N0TWVzc2FnZSgne1wiY29tbWFuZFwiOiBcInVwZGF0ZVwifScpXHJcblx0c2VsZi51cGRhdGVMb29wID0gc2V0VGltZW91dCggKCkgPT4ge1xyXG5cdFx0c2VsZi51cGRhdGUoKVxyXG5cdH0sIDE1KVxyXG59XHJcblxyXG5zZWxmLmNoZWNrU3RhdGljQ29sbGlzaW9ucyA9ICggdm94ZWwsIHBvc2l0aW9uICkgPT4ge1xyXG5cdGxldCBlID0gdm94ZWwuZW50aXRpZXMubGVuZ3RoIC0gMSxcclxuXHRcdGVudCA9IG51bGwsXHJcblx0XHRlbnRSYWRpdXMgPSAxMCxcclxuXHRcdGNvbGxpc2lvbiA9IGZhbHNlXHJcblxyXG5cdHdoaWxlIChlID49IDApIHtcclxuXHRcdGVudCA9IHZveGVsLmVudGl0aWVzW2VdXHJcblx0XHRlbnRSYWRpdXMgPSBlbnQuYm91bmRpbmdSYWRpdXNcclxuXHRcdGlmICghISFlbnQgfHwgISEhZW50LmNvbXBvbmVudHMpIHtcclxuXHRcdFx0Y29uc29sZS53YXJuKFwiUHJvYmxlbSB3aXRoIGVudGl0eSEgXCIsIGUsIGVudCk7IGNvbnRpbnVlXHJcblx0XHR9XHJcblx0XHRpZiAoZGlzdGFuY2UzZENvbXBhcmUoXHJcblx0XHRcdHBvc2l0aW9uLFxyXG5cdFx0XHRbZW50LnBvc2l0aW9uWzBdIC0gZW50UmFkaXVzLzIuMCwgZW50LnBvc2l0aW9uWzFdLFxyXG5cdFx0XHRlbnQucG9zaXRpb25bMl0gLSBlbnRSYWRpdXMvMi4wXSwgKGVudFJhZGl1cyAqIDEuNiB8fCAzKSArIDIuNVxyXG5cdFx0KSkge1xyXG5cclxuXHRcdFx0ZW50LmNvbXBvbmVudHMubWFwKGVudENvbXAgPT4ge1xyXG5cdFx0XHRcdGxldCBib3VuZGluZ1JhZGl1cyA9IGVudENvbXAuYm91bmRpbmdSYWRpdXMgKiAxLjIgfHxcclxuXHRcdFx0XHQgICAgTWF0aC5tYXgoZW50Q29tcC5wcm9wcy5nZW9tZXRyeS5zaXplWzBdLCBlbnRDb21wLnByb3BzLmdlb21ldHJ5LnNpemVbMl0pICogMS4yXHJcblxyXG5cdFx0XHRcdGlmICghIWVudENvbXAucHJvcHMuZmxvb3IpIHtcclxuXHRcdFx0XHRcdGxldCByb290UG9zID0gZW50LnBvc2l0aW9uLm1hcCggdiA9PiB2LWVudC5ib3VuZGluZ1JhZGl1cyAvIDIuMCApXHJcblx0XHRcdFx0XHRpZiAoZGlzdGFuY2UyZENvbXBhcmUoXHJcblx0XHRcdFx0XHRcdHBvc2l0aW9uLFxyXG5cdFx0XHRcdFx0XHRbcm9vdFBvc1swXSArIGVudENvbXAucG9zaXRpb25bMF0sIDAsIHJvb3RQb3NbMl0gKyBlbnRDb21wLnBvc2l0aW9uWzJdXSxcclxuXHRcdFx0XHRcdFx0Ym91bmRpbmdSYWRpdXMgKiAxLjdcclxuXHRcdFx0XHRcdCkpIHtcclxuXHRcdFx0XHRcdFx0bGV0IHZlcnRpY2FsT2Zmc2V0ID0gKHBvc2l0aW9uWzFdICsgMiAtIChlbnRDb21wLnBvc2l0aW9uWzFdICsgZW50LnBvc2l0aW9uWzFdICkpIC8vICArIGVudENvbXAuZ2VvbWV0cnkgPyBlbnRDb21wLmdlb21ldHJ5LnNpemVbMV0gOiAxXHJcblx0XHRcdFx0XHRcdGlmICh2ZXJ0aWNhbE9mZnNldCA+IDAgJiYgdmVydGljYWxPZmZzZXQgPCA1KSB7XHJcblx0XHRcdFx0XHRcdFx0c2VsZi5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeSh7XHJcblx0XHRcdFx0XHRcdFx0XHRjb21tYW5kOiBcImZsb29yIGNvbGxpc2lvblwiLCBkYXRhOiB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHBvc2l0aW9uOiBlbnRDb21wLnBvc2l0aW9uLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRmbG9vckRhdGE6IGVudENvbXAucHJvcHMuZmxvb3JcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9KSlcclxuXHRcdFx0XHRcdFx0XHRjb2xsaXNpb24gPSB0cnVlXHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9IGVsc2UgaWYgKGRpc3RhbmNlM2RDb21wYXJlKFxyXG5cdFx0XHRcdFx0cG9zaXRpb24sXHJcblx0XHRcdFx0XHRbZW50LnBvc2l0aW9uWzBdICsgZW50Q29tcC5wb3NpdGlvblswXSwgZW50LnBvc2l0aW9uWzFdICsgZW50Q29tcC5wb3NpdGlvblsxXSwgZW50LnBvc2l0aW9uWzJdICsgZW50Q29tcC5wb3NpdGlvblsyXV0sXHJcblx0XHRcdFx0XHRib3VuZGluZ1JhZGl1c1xyXG5cdFx0XHRcdCkpIHtcclxuXHRcdFx0XHRcdGNvbGxpc2lvbiA9IHRydWVcclxuXHRcdFx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkoeyBjb21tYW5kOiBcImVudGl0eS11c2VyIGNvbGxpc2lvblwiLCBkYXRhOiB7IHBvc2l0aW9uOiBlbnRDb21wLnBvc2l0aW9uIH0gfSkpXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0fSlcclxuXHRcdH1cclxuXHRcdGUgLT0gMVxyXG5cdH1cclxuXHRyZXR1cm4gY29sbGlzaW9uXHJcbn1cclxuXHJcbnNlbGYub25tZXNzYWdlID0gKCBldmVudCApID0+IHtcclxuXHJcblx0dmFyIG1lc3NhZ2UgID0gSlNPTi5wYXJzZSggZXZlbnQuZGF0YSApLFxyXG5cdFx0ZGF0YSBcdCA9IG1lc3NhZ2UuZGF0YSxcclxuXHRcdHVzZXIgXHQgPSBvYnNlcnZlcixcclxuXHRcdHZveGVsIFx0ID0gbnVsbCxcclxuXHRcdHRvUmVtb3ZlID0gbnVsbCxcclxuXHRcdGl0ZW1zIFx0ID0gW10sXHJcblx0XHRlbnRpdGllcyA9IFtdLFxyXG5cdFx0YyBcdFx0ID0gMCxcclxuXHRcdHAgXHRcdCA9IDBcclxuXHJcblx0aWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJ1cGRhdGVcIiApIHtcclxuXHRcdC8vIHVzZXIucHJldlBvcyA9IFt1c2VyLnBvc2l0aW9uWzBdLCB1c2VyLnBvc2l0aW9uWzFdLCB1c2VyLnBvc2l0aW9uWzJdXTtcclxuXHRcdHVzZXIucG9zaXRpb24gPSBkYXRhLnBvc2l0aW9uXHJcblx0XHR1c2VyLnZlbG9jaXR5ID0gZGF0YS52ZWxvY2l0eVxyXG5cdFx0dXNlci52ckhlaWdodCA9IGRhdGEudnJIZWlnaHRcclxuXHRcdC8vc2VsZi5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeShzZWxmLm9ic2VydmVyKSk7XHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwiYWRkIHZveGVsc1wiICkge1xyXG5cdFx0c2VsZi5hZGRWb3hlbHMoIG1lc3NhZ2UsIGRhdGEgKVxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInJlbW92ZSB2b3hlbHNcIiApIHtcclxuXHRcdHNlbGYucmVtb3ZlVm94ZWxzKCBtZXNzYWdlLCBkYXRhIClcclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJhZGQgZW50aXR5XCIgKSB7XHJcblx0XHRzZWxmLmFkZEVudGl0eSgpXHJcbiAgXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJyZW1vdmUgZW50aXR5XCIgKSB7XHJcbiAgICBcdHNlbGYucmVtb3ZlRW50aXR5KCBtZXNzYWdlLCBkYXRhIClcclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJ1cGRhdGUgZW50aXR5XCIgfHwgbWVzc2FnZS5jb21tYW5kID09IFwidXBkYXRlIHRlbGVtZXRyeVwiICkge1xyXG5cdFx0aWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJ1cGRhdGUgZW50aXR5XCIgKSB7XHJcblx0XHRcdHNlbGYudXBkYXRlRW50aXR5KCBtZXNzYWdlLCBkYXRhIClcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHNlbGYudXBkYXRlVGVsZW1ldHJ5KCBtZXNzYWdlLCBkYXRhIClcclxuXHRcdH1cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJjbGVhclwiICkge1xyXG5cdFx0dm94ZWxzID0gW11cclxuXHRcdHZveGVsTGlzdCA9IFtdXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwic3RhcnRcIiApIHtcclxuXHRcdHNlbGYudXBkYXRlKClcclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJzdG9wXCIgKSB7XHJcblx0XHRzZWxmLnN0b3AoKVxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcImxvZ1wiICkge1xyXG5cdFx0aWYgKGRhdGEgPT0gXCJcIikge1xyXG5cdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6XCJsb2dcIixcImRhdGFcIjpbJyArIHVzZXIucG9zaXRpb25bMF0gKyAnLCcgKyB1c2VyLnBvc2l0aW9uWzFdICsgJywnICsgdXNlci5wb3NpdGlvblsyXSArICddfScpO1xyXG5cdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6XCJsb2dcIixcImRhdGFcIjonICsgSlNPTi5zdHJpbmdpZnkodm94ZWxzKSsgJ30nKTtcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5zZWxmLmFkZFZveGVscyA9IChtZXNzYWdlLCBkYXRhKSA9PiB7XHJcblx0dm94ZWxMaXN0ID0gdm94ZWxMaXN0LmNvbmNhdChkYXRhKVxyXG5cdGRhdGEubWFwKCB2ID0+IHtcclxuXHRcdHZveGVsc1sgdi5jZWxsLmpvaW4oXCIuXCIpIF0gPSB2XHJcblx0fSlcclxufVxyXG5cclxuc2VsZi5yZW1vdmVWb3hlbHMgPSAobWVzc2FnZSwgZGF0YSkgPT4ge1xyXG5cdGxldCB0b1JlbW92ZSA9IG51bGwsXHJcblx0XHR2b3hlbCA9IG51bGwsXHJcblx0XHRjIFx0XHQgPSAwLFxyXG5cdFx0cCBcdFx0ID0gZGF0YS5sZW5ndGggLTFcclxuXHJcblx0d2hpbGUgKCBwID49IDAgKSB7XHJcblx0XHR0b1JlbW92ZSA9IGRhdGFbcF1cclxuXHRcdGMgPSB2b3hlbExpc3QubGVuZ3RoLTFcclxuXHJcblx0XHR3aGlsZSAoIGMgPj0gMCApIHtcclxuXHRcdFx0dm94ZWwgPSB2b3hlbExpc3RbIGMgXVxyXG5cdFx0XHRpZiAoIHZveGVsICE9IG51bGwgJiYgdm94ZWwuY2VsbFswXSA9PSB0b1JlbW92ZS5jZWxsWzBdICYmIHZveGVsLmNlbGxbMV0gPT0gdG9SZW1vdmUuY2VsbFsxXVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0JiYgdm94ZWwuY2VsbFsyXSA9PSB0b1JlbW92ZS5jZWxsWzJdICkge1xyXG5cdFx0XHRcdHZveGVsTGlzdC5zcGxpY2UoIGMsIDEgKVxyXG5cdFx0XHRcdHZveGVsc1sgdm94ZWwuY2VsbC5qb2luKFwiLlwiKV0gPSBudWxsXHJcblx0XHRcdH1cclxuXHRcdFx0Yy0tXHJcblx0XHR9XHJcblx0XHRwIC0tXHJcblx0fVxyXG59XHJcblxyXG5zZWxmLmFkZEVudGl0eSA9IChtZXNzYWdlLCBkYXRhKSA9PiB7XHJcblx0aWYgKCFkYXRhKSB7XHJcblx0XHRjb25zb2xlLndhcm4oXCJubyBkYXRhIGZvciBhZGRFbnRpdHlcIilcclxuXHRcdHJldHVyblxyXG5cdH1cclxuXHRpZiAoISEhIHZveGVsc1tkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKV0pIHtcclxuXHRcdHZveGVsc1tkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKV0gPSB7IGVudGl0aWVzOiBbXSwgY2VsbDogZGF0YS5jb29yZHMgfVxyXG5cdH1cclxuXHRsZXQgZW50aXRpZXMgPSB2b3hlbHNbZGF0YS5jb29yZHMuam9pbihcIi5cIildLmVudGl0aWVzO1xyXG5cclxuXHRlbnRpdGllcy5wdXNoKCBkYXRhLmVudGl0eSApXHJcbn1cclxuXHJcbnNlbGYucmVtb3ZlRW50aXR5ID0gKCBtZXNzYWdlLCBkYXRhICkgPT4ge1xyXG5cdGxldCBlbnRpdGllcyA9IHZveGVsc1sgZGF0YS5jb29yZHMuam9pbihcIi5cIikgXS5lbnRpdGllcztcclxuXHJcblx0aWYgKCBlbnRpdGllcyAhPSBudWxsICkge1xyXG5cdFx0bGV0IGMgPSBlbnRpdGllcy5sZW5ndGgtMTtcclxuXHJcblx0XHR3aGlsZSAoIGMgPj0gMCApIHtcclxuXHRcdFx0aWYgKCBlbnRpdGllc1tjXS5pZCA9PSBkYXRhLmVudGl0eUlkICkge1xyXG5cdFx0XHRcdHZveGVsc1sgZGF0YS5jb29yZHMuam9pbihcIi5cIikgXS5lbnRpdGllcy5zcGxpY2UoYywgMSlcclxuXHRcdFx0XHRjID0gLTFcclxuXHRcdFx0fVxyXG5cdFx0XHRjLS1cclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbnNlbGYudXBkYXRlRW50aXR5ID0gKG1lc3NhZ2UsIGRhdGEpID0+IHtcclxuXHRsZXQgY2VsbCA9ICBkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKTtcclxuXHJcblx0aWYgKCFkYXRhIHx8ICFkYXRhLmNvb3Jkcykge1xyXG5cdFx0Y29uc29sZS53YXJuKFwibm8gZGF0YSB0byB1cGRhdGUgZW50aXR5XCIpXHJcblx0XHRyZXR1cm5cclxuXHR9XHJcblx0aWYgKCAhdm94ZWxzW2NlbGxdICkge1xyXG5cdFx0Y29uc29sZS53YXJuKFwiY2FuJ3QgdXBkYXRlIGVudGl0eSB3aXRoIG5vIHZveGVsXCIpXHJcblx0XHRyZXR1cm5cclxuXHR9XHJcblx0bGV0IGVudGl0aWVzID0gdm94ZWxzWyBjZWxsIF0uZW50aXRpZXNcclxuXHJcblx0aWYgKCBlbnRpdGllcyAhPSBudWxsICkge1xyXG5cdFx0bGV0IGMgPSBlbnRpdGllcy5sZW5ndGgtMTtcclxuXHJcblx0XHR3aGlsZSAoIGMgPj0gMCApIHtcclxuXHRcdFx0aWYgKGVudGl0aWVzWyBjIF0uaWQgPT0gZGF0YS5lbnRpdHlJZCkge1xyXG5cdFx0XHRcdGVudGl0aWVzWyBjIF0gPSBkYXRhLmVudGl0eVxyXG5cdFx0XHRcdGMgPSAtMVxyXG5cdFx0XHR9XHJcblx0XHRcdGMtLVxyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuc2VsZi51cGRhdGVUZWxlbWV0cnkgPSAobWVzc2FnZSwgZGF0YSkgPT4ge1xyXG5cdFxyXG5cdGNvbnNvbGUud2FybihcInBoeXNpY3Mgd29ya2VyOiB1cGRhdGVUZWxlbWV0cnkoKVwiLCBtZXNzYWdlLCBkYXRhKVxyXG5cdGlmICghZGF0YSB8fCAhZGF0YS5jb29yZHMpIHtcclxuXHRcdGNvbnNvbGUud2FybihcIm5vIGRhdGEgdG8gdXBkYXRlIGVudGl0eVwiKVxyXG5cdFx0cmV0dXJuXHJcblx0fVxyXG5cdGxldCBjZWxsID0gIGRhdGEuY29vcmRzLmpvaW4oXCIuXCIpO1xyXG5cclxuXHRpZiAoICF2b3hlbHNbY2VsbF0gKSB7XHJcblx0XHRjb25zb2xlLndhcm4oXCJjYW4ndCB1cGRhdGUgZW50aXR5IHdpdGggbm8gdm94ZWxcIilcclxuXHRcdHJldHVyblxyXG5cdH1cclxuXHRsZXQgZW50aXRpZXMgPSB2b3hlbHNbIGNlbGwgXS5lbnRpdGllcyxcclxuXHRcdG9sZENlbGwgPSBtZXNzYWdlLmRhdGEub2xkQ29vcmRzLmpvaW4oXCIuXCIpLFxyXG5cdFx0b2xkRW50aXRpZXMgPSB2b3hlbHNbb2xkQ2VsbF07XHJcblxyXG5cdGlmIChvbGRDZWxsICE9IGNlbGwpIHtcclxuXHRcdGxldCBjID0gb2xkRW50aXRpZXMubGVuZ3RoIC0gMTtcclxuXHJcblx0XHR3aGlsZSAoYyA+PSAwKSB7XHJcblx0XHRcdGxldCBtb3ZlZEVudCA9IG9sZEVudGl0aWVzW2NdXHJcblx0XHRcdGlmIChtb3ZlZEVudC5pZCA9PSBkYXRhLmVudGl0eUlkKSB7XHJcblx0XHRcdFx0b2xkRW50aXRpZXMuc3BsaWNlKG9sZEVudGl0aWVzLmluZGV4T2YobW92ZWRFbnQpLCAxKVxyXG5cdFx0XHRcdGVudGl0aWVzLnB1c2gobW92ZWRFbnQpXHJcblx0XHRcdFx0Y29uc29sZS5sb2coXCJwaHlzaWNzIHdvcmtlcjogdXBkYXRlIHRlbGVtZXRyeTogbW92ZWQgYmV0d2VlbiB2b3hlbHNcIilcclxuXHRcdFx0XHRtb3ZlZEVudC5wb3NpdGlvbiA9IGRhdGEucG9zaXRpb25cclxuXHRcdFx0XHRpZiAoZGF0YS5xdWF0ZXJuaW9uKSB7XHJcblx0XHRcdFx0XHRtb3ZlZEVudC5xdWF0ZXJuaW9uID0gZGF0YS5xdWF0ZXJuaW9uO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjID0gLTFcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHR9IGVsc2Uge1xyXG5cdFx0aWYgKGVudGl0aWVzICE9IG51bGwpIHtcclxuXHRcdFx0bGV0IGMgPSBlbnRpdGllcy5sZW5ndGggLSAxXHJcblx0XHRcdHdoaWxlIChjID49IDApIHtcclxuXHRcdFx0XHRpZiAoZW50aXRpZXNbY10uaWQgPT0gZGF0YS5lbnRpdHlJZCkge1xyXG5cdFx0XHRcdFx0Y29uc29sZS5pbmZvKFwicGh5c2ljcyB3b3JrZXI6IHVwZGF0ZSB0ZWxlbWV0cnlcIilcclxuXHRcdFx0XHRcdGVudGl0aWVzW2NdLnBvc2l0aW9uID0gZGF0YS5wb3NpdGlvblxyXG5cdFx0XHRcdFx0aWYgKGRhdGEucXVhdGVybmlvbikge1xyXG5cdFx0XHRcdFx0XHRlbnRpdGllc1tjXS5xdWF0ZXJuaW9uID0gZGF0YS5xdWF0ZXJuaW9uO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0YyA9IC0xXHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGMtLVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5zZWxmLnN0b3AgPSAoKSA9PiB7XHJcblx0Y2xlYXJUaW1lb3V0KCBzZWxmLnVwZGF0ZUxvb3AgKVxyXG59XHJcbiJdfQ==
