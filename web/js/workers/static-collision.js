(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/*  static collision detection worker */

'use strict';

var distance2d = function distance2d(a, b) {

	return Math.sqrt(Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2));
},
    distance2dCompare = function distance2dCompare(a, b, n) {
	// more efficient version of distance2d()

	return Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2) < n * n;
},
    distance3dCompare = function distance3dCompare(a, b, n) {
	// ..faster than using Math.sqrt()

	return Math.pow(a[0] - b[0], 2) + Math.pow(a[1] - b[1], 2) + Math.pow(a[2] - b[2], 2) < n * n;
};

var observer = {
	position: [0, 0, 0],
	prevPos: [0, 0, 0],
	velocity: [0, 0, 0],
	vrHeight: 0
},
    voxelList = [],
    voxels = [];

self.update = function () {

	var distance = 0,
	    position = observer.position,
	    innerBox = [false, false],
	    velocity = observer.velocity,
	    vrHeight = observer.vrHeight,
	    closeToVenue = false,
	    collision = false,
	    cKey = "",
	    yPos = 0,
	    size = 50000,
	    voxel = null,
	    ent = null,
	    structure = null,
	    bounds = [0, 0],
	    voxel = null,
	    delta = [0, 0],
	    oPos = [],
	    speed = 0,
	    e = 0,
	    i = 0,
	    v = 0;

	for (i = 0; i < voxelList.length; i++) {

		voxel = voxelList[i];

		if (!!!voxel || !!!voxel.position) continue;

		if (!!voxel && distance2dCompare(position, voxel.position, 2500000)) {
			// do collisions on voxels & structures... just walls at first..

			if (voxel.loaded == undefined) {

				voxel.loaded = true;
				self.postMessage('{"command": "load entities", "data":{"coords":"' + voxel.cell[0] + '.' + voxel.cell[1] + '.' + voxel.cell[2] + '"}}');
			}

			if (distance2dCompare(position, voxel.position, 900000)) {

				var alt = voxel.altitude || 0;

				yPos = voxel.position[1];

				if (distance2dCompare(position, voxel.position, 528000)) {

					if (position[1] > yPos - 400000 + vrHeight && position[1] < yPos + 450000 + vrHeight) {

						collision = true;
						self.postMessage('{"command": "platform collision", "data":{"type":"top", "position":[' + voxel.position[0] + ',' + yPos + ',' + voxel.position[2] + '] }}');
					}

					if (!!voxel.entities && voxel.entities.length > 0) {

						e = voxel.entities.length - 1;

						while (e >= 0) {

							ent = voxel.entities[e];

							if (!!!ent || !!!ent.components) {
								console.warn("Problem with entity! ", e, ent);continue;
							}

							if (distance3dCompare(position, ent.position, (ent.boundingRadius || 100000) + 10000)) {

								ent.components.map(function (entComp) {

									if (distance3dCompare(position, entComp.position, entComp.boundingRadius || 28000)) {

										collision = true;

										if (!!entComp.props.floor) {

											self.postMessage(JSON.stringify({ command: "floor collision", data: {
													position: entComp.position,
													floorData: entComp.props.floor
												} }));
										} else {

											self.postMessage(JSON.stringify({ command: "entity-user collision", data: { position: entComp.position } }));
										}
									}
								});
							}

							e -= 1;
						}
					}
				}
			}
		}
	}

	if (!collision) observer.prevPos = [observer.position[0], observer.position[1], observer.position[2]];

	self.postMessage('{"command": "update"}');
	self.updateLoop = setTimeout(function () {
		self.update();
	}, 15);
};

self.onmessage = function (event) {

	var message = JSON.parse(event.data),
	    data = message.data,
	    user = observer,
	    voxel = null,
	    toRemove = null,
	    items = [],
	    entities = [],
	    c = 0,
	    p = 0;

	if (message.command == "update") {
		// user.prevPos = [user.position[0], user.position[1], user.position[2]];
		user.position = data.position;
		user.velocity = data.velocity;
		user.vrHeight = data.vrHeight;
		//self.postMessage(JSON.stringify(self.observer));
	} else if (message.command == "add voxels") {

			voxelList = voxelList.concat(data);

			data.map(function (v) {
				voxels[v.cell.join(".")] = v;
			});
		} else if (message.command == "remove voxels") {

			p = data.length - 1;

			while (p >= 0) {

				toRemove = data[p];
				c = voxelList.length - 1;

				while (c >= 0) {

					voxel = voxelList[c];

					if (voxel != null && voxel.cell[0] == toRemove.cell[0] && voxel.cell[1] == toRemove.cell[1] && voxel.cell[2] == toRemove.cell[2]) {

						voxelList.splice(c, 1);
						voxels[voxel.cell.join(".")] = null;
					}

					c--;
				}

				p--;
			}
		} else if (message.command == "add entity") {

			if (!!!voxels[data.coords.join(".")]) voxels[data.coords.join(".")] = { entities: [], cell: data.coords };

			entities = voxels[data.coords.join(".")].entities;

			entities.push(data.entity);
		} else if (message.command == "remove entity") {

			entities = voxels[data.coords.join(".")].entities;

			if (entities != null) {

				c = entities.length - 1;

				while (c >= 0) {

					if (entities[c].id == data.entityId) {

						voxels[data.coords.join(".")].entities.splice(c, 1);
						c = -1;
					}

					c--;
				}
			}
		} else if (message.command == "update entity") {

			entities = voxels[data.coords.join(".")].entities;

			if (entities != null) {

				c = entities.length - 1;

				while (c >= 0) {

					if (entities[c].id == data.entityId) {

						entities[c] = data.entity;
						c = -1;
					}

					c--;
				}
			}
		} else if (message.command == "clear") {

			voxels = [];
		} else if (message.command == "start") {

			self.update();
		} else if (message.command == "stop") {

			self.stop();
		} else if (message.command == "log") {

			if (data == "") {
				self.postMessage('{"command":"log","data":[' + user.position[0] + ',' + user.position[1] + ',' + user.position[2] + ']}');
				self.postMessage('{"command":"log","data":' + JSON.stringify(voxels) + '}');
			}
		}
};

self.stop = function () {

	clearTimeout(self.updateLoop);
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL1VzZXJzL29wZW5zL0FwcERhdGEvUm9hbWluZy9ucG0vbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIkM6L0NvZGUvc3JjL2dpdGh1Yi5jb20vY29udm9sdnIvY29udm9sdnIvY2xpZW50L3NyYy9qcy93b3JrZXJzL3N0YXRpYy1jb2xsaXNpb25zLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztBQ0VBLElBQUksVUFBVSxHQUFHLFNBQWIsVUFBVSxDQUFLLENBQUMsRUFBRSxDQUFDLEVBQU07O0FBRXpCLFFBQU8sSUFBSSxDQUFDLElBQUksQ0FBRSxJQUFJLENBQUMsR0FBRyxDQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUcsQ0FBQyxDQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFHLENBQUMsQ0FBRSxDQUFFLENBQUE7Q0FFNUU7SUFDRCxpQkFBaUIsR0FBRyxTQUFwQixpQkFBaUIsQ0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBTTs7O0FBRWxDLFFBQU8sSUFBSSxDQUFDLEdBQUcsQ0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFHLENBQUMsQ0FBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRyxDQUFDLENBQUUsR0FBSSxDQUFDLEdBQUMsQ0FBQyxBQUFDLENBQUE7Q0FFdEU7SUFDRCxpQkFBaUIsR0FBRyxTQUFwQixpQkFBaUIsQ0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBTTs7O0FBRWxDLFFBQU8sQUFBQyxJQUFJLENBQUMsR0FB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O0FBRUQsTUFBQyxFQUFFLENBQUE7S0FFSDtJQUVEO0dBRUQsTUFBTSxJQUFLLE9BQU8sQ0FBQyxPQUFPLElBQUksT0FBTyxFQUFHOztBQUV4QyxTQUFNLEdBQUcsRUFBRSxDQUFBO0dBRVgsTUFBTSxJQUFLLE9BQU8sQ0FBQyxPQUFPLElBQUksT0FBTyxFQUFHOztBQUV4QyxPQUFJLENBQUMsTUFBTSxFQUFFLENBQUE7R0FFYixNQUFNLElBQUssT0FBTyxDQUFDLE9BQU8sSUFBSSxNQUFNLEVBQUc7O0FBRXZDLE9BQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQTtHQUVYLE1BQU0sSUFBSyxPQUFPLENBQUMsT0FBTyxJQUFJLEtBQUssRUFBRzs7QUFFdEMsT0FBSSxJQUFJLElBQUksRUFBRSxFQUFFO0FBQ2YsUUFBSSxDQUFDLFdBQVcsQ0FBQywyQkFBMkIsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO0FBQzFILFFBQUksQ0FBQyxXQUFXLENBQUMsMEJBQTBCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsR0FBRSxHQUFHLENBQUMsQ0FBQztJQUMzRTtHQUVEO0NBQ0QsQ0FBQzs7QUFFRixJQUFJLENBQUMsSUFBSSxHQUFHLFlBQU07O0FBRWpCLGFBQVksQ0FBRSxJQUFJLENBQUMsVUFBVSxDQUFFLENBQUE7Q0FFL0IsQ0FBQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKiAgc3RhdGljIGNvbGxpc2lvbiBkZXRlY3Rpb24gd29ya2VyICovXHJcblxyXG5sZXQgZGlzdGFuY2UyZCA9ICggYSwgYiApID0+IHtcclxuXHJcbiAgICByZXR1cm4gTWF0aC5zcXJ0KCBNYXRoLnBvdyggKGFbMF0tYlswXSksIDIgKSArIE1hdGgucG93KCAoYVsyXS1iWzJdKSwgMiApIClcclxuXHJcbiAgfSxcclxuICBkaXN0YW5jZTJkQ29tcGFyZSA9ICggYSwgYiwgbiApID0+IHsgLy8gbW9yZSBlZmZpY2llbnQgdmVyc2lvbiBvZiBkaXN0YW5jZTJkKClcclxuXHJcblx0ICByZXR1cm4gTWF0aC5wb3coIChhWzBdLWJbMF0pLCAyICkgKyBNYXRoLnBvdyggKGFbMl0tYlsyXSksIDIgKSA8IChuKm4pXHJcblxyXG4gIH0sXHJcbiAgZGlzdGFuY2UzZENvbXBhcmUgPSAoIGEsIGIsIG4gKSA9PiB7IC8vIC4uZmFzdGVyIHRoYW4gdXNpbmcgTWF0aC5zcXJ0KClcclxuXHJcblx0ICByZXR1cm4gKE1hdGgucG93KCAoYVswXS1iWzBdKSwgMiApICsgTWF0aC5wb3coIChhWzFdLWJbMV0pLCAyICkgKyBNYXRoLnBvdyggKGFbMl0tYlsyXSksIDIgKSApIDwgKG4qbilcclxuXHJcbiAgfVxyXG5cclxubGV0IG9ic2VydmVyID0ge1xyXG5cdFx0cG9zaXRpb246IFswLCAwLCAwXSxcclxuXHRcdHByZXZQb3M6IFswLCAwLCAwXSxcclxuXHRcdHZlbG9jaXR5OiBbMCwgMCwgMF0sXHJcblx0XHR2ckhlaWdodDogMFxyXG5cdH0sXHJcblx0dm94ZWxMaXN0ID0gW10sXHJcblx0dm94ZWxzID0gW11cclxuXHJcbnNlbGYudXBkYXRlID0gKCApID0+IHtcclxuXHJcblx0dmFyIGRpc3RhbmNlID0gMCxcclxuXHRcdHBvc2l0aW9uIFx0ID0gb2JzZXJ2ZXIucG9zaXRpb24sXHJcblx0XHRpbm5lckJveCBcdCA9IFtmYWxzZSwgZmFsc2VdLFxyXG5cdFx0dmVsb2NpdHkgXHQgPSBvYnNlcnZlci52ZWxvY2l0eSxcclxuXHRcdHZySGVpZ2h0IFx0ID0gb2JzZXJ2ZXIudnJIZWlnaHQsXHJcblx0XHRjbG9zZVRvVmVudWUgPSAgZmFsc2UsXHJcblx0XHRjb2xsaXNpb24gXHQgPSBmYWxzZSxcclxuXHRcdGNLZXkgXHRcdCA9IFwiXCIsXHJcblx0XHR5UG9zIFx0XHQgPSAwLFxyXG5cdFx0c2l6ZSBcdFx0ID0gNTAwMDAsXHJcblx0XHR2b3hlbCBcdFx0ID0gbnVsbCxcclxuXHRcdGVudCBcdFx0ID0gbnVsbCxcclxuXHRcdHN0cnVjdHVyZSBcdCA9IG51bGwsXHJcblx0XHRib3VuZHMgXHRcdCA9IFswLCAwXSxcclxuXHRcdHZveGVsIFx0XHQgPSBudWxsLFxyXG5cdFx0ZGVsdGEgXHRcdCA9IFswLCAwXSxcclxuXHRcdG9Qb3MgXHRcdCA9IFtdLFxyXG5cdFx0c3BlZWQgXHRcdCA9IDAsXHJcblx0XHRlIFx0XHRcdCA9IDAsXHJcblx0XHRpIFx0XHRcdCA9IDAsXHJcblx0XHR2IFx0XHRcdCA9IDBcclxuXHJcblx0Zm9yICggaSA9IDA7IGkgPCB2b3hlbExpc3QubGVuZ3RoOyBpICsrICkge1xyXG5cclxuXHRcdHZveGVsID0gdm94ZWxMaXN0WyBpIF1cclxuXHJcblx0XHRpZiAoICEhIXZveGVsIHx8ICEhIXZveGVsLnBvc2l0aW9uKSBjb250aW51ZVxyXG5cclxuXHRcdGlmICggISF2b3hlbCAmJiBkaXN0YW5jZTJkQ29tcGFyZSggcG9zaXRpb24sIHZveGVsLnBvc2l0aW9uLCAyNTAwMDAwICkgKSB7IFx0Ly8gZG8gY29sbGlzaW9ucyBvbiB2b3hlbHMgJiBzdHJ1Y3R1cmVzLi4uIGp1c3Qgd2FsbHMgYXQgZmlyc3QuLlxyXG5cdFx0XHRcdFx0XHJcblx0XHRcdGlmICggdm94ZWwubG9hZGVkID09IHVuZGVmaW5lZCApIHtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHR2b3hlbC5sb2FkZWQgPSB0cnVlXHJcblx0XHRcdFx0c2VsZi5wb3N0TWVzc2FnZSgne1wiY29tbWFuZFwiOiBcImxvYWQgZW50aXRpZXNcIiwgXCJkYXRhXCI6e1wiY29vcmRzXCI6XCInK3ZveGVsLmNlbGxbMF0rJy4nK3ZveGVsLmNlbGxbMV0rJy4nK3ZveGVsLmNlbGxbMl0rJ1wifX0nKTtcclxuXHRcdFx0XHRcdFx0XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICggZGlzdGFuY2UyZENvbXBhcmUoIHBvc2l0aW9uLCB2b3hlbC5wb3NpdGlvbiwgOTAwMDAwICkgKSB7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRsZXQgYWx0ID0gdm94ZWwuYWx0aXR1ZGUgfHwgMFxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdHlQb3MgPSB2b3hlbC5wb3NpdGlvblsxXVxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGlmICggZGlzdGFuY2UyZENvbXBhcmUoIHBvc2l0aW9uLCB2b3hlbC5wb3NpdGlvbiwgNTI4MDAwICkgKSB7XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0aWYgKCBwb3NpdGlvblsxXSA+IHlQb3MgLSA0MDAwMDAgKyB2ckhlaWdodCAgJiYgcG9zaXRpb25bMV0gPCB5UG9zICsgNDUwMDAwICsgdnJIZWlnaHQgKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRjb2xsaXNpb24gPSB0cnVlXHJcblx0XHRcdFx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoJ3tcImNvbW1hbmRcIjogXCJwbGF0Zm9ybSBjb2xsaXNpb25cIiwgXCJkYXRhXCI6e1widHlwZVwiOlwidG9wXCIsIFwicG9zaXRpb25cIjpbJyArIHZveGVsLnBvc2l0aW9uWzBdICsgJywnICsgeVBvcyArICcsJyArIHZveGVsLnBvc2l0aW9uWzJdICsgJ10gfX0nKTtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmICggISF2b3hlbC5lbnRpdGllcyAmJiB2b3hlbC5lbnRpdGllcy5sZW5ndGggPiAwICkge1xyXG5cclxuXHRcdFx0XHRcdFx0ZSA9IHZveGVsLmVudGl0aWVzLmxlbmd0aCAtIDFcclxuXHJcblx0XHRcdFx0XHRcdHdoaWxlICggZSA+PSAwICkge1xyXG5cclxuXHRcdFx0XHRcdFx0XHRlbnQgPSB2b3hlbC5lbnRpdGllc1sgZSBdXHJcblxyXG5cdFx0XHRcdFx0XHRcdGlmICggISEhIGVudCB8fCAhISFlbnQuY29tcG9uZW50cyApIHsgY29uc29sZS53YXJuKFwiUHJvYmxlbSB3aXRoIGVudGl0eSEgXCIsZSAsZW50KTsgY29udGludWUgfVxyXG5cclxuXHRcdFx0XHRcdFx0XHRpZiAoIGRpc3RhbmNlM2RDb21wYXJlKCBwb3NpdGlvbiwgZW50LnBvc2l0aW9uLCAoZW50LmJvdW5kaW5nUmFkaXVzfHwxMDAwMDApKzEwMDAwKSApIHsgXHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0ZW50LmNvbXBvbmVudHMubWFwKCBlbnRDb21wID0+IHtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmICggZGlzdGFuY2UzZENvbXBhcmUoIHBvc2l0aW9uLCBlbnRDb21wLnBvc2l0aW9uLCBlbnRDb21wLmJvdW5kaW5nUmFkaXVzIHx8IDI4MDAwKSApIHtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y29sbGlzaW9uID0gdHJ1ZVxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoICEhIGVudENvbXAucHJvcHMuZmxvb3IgKSB7IFxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoIEpTT04uc3RyaW5naWZ5KCB7Y29tbWFuZDogXCJmbG9vciBjb2xsaXNpb25cIiwgZGF0YTogeyBcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cG9zaXRpb246IGVudENvbXAucG9zaXRpb24sIFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRmbG9vckRhdGE6IGVudENvbXAucHJvcHMuZmxvb3JcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH19KSlcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCBKU09OLnN0cmluZ2lmeSgge2NvbW1hbmQ6IFwiZW50aXR5LXVzZXIgY29sbGlzaW9uXCIsIGRhdGE6eyBwb3NpdGlvbjogZW50Q29tcC5wb3NpdGlvbiB9fSApIClcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdH0pXHJcblxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0ZSAtPSAxXHJcblxyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0fVxyXG5cclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHRpZiAoICFjb2xsaXNpb24gKVxyXG5cclxuXHRcdG9ic2VydmVyLnByZXZQb3MgPSBbIG9ic2VydmVyLnBvc2l0aW9uWzBdLCBvYnNlcnZlci5wb3NpdGlvblsxXSwgb2JzZXJ2ZXIucG9zaXRpb25bMl0gXVxyXG5cdFxyXG5cclxuXHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6IFwidXBkYXRlXCJ9JylcclxuXHRzZWxmLnVwZGF0ZUxvb3AgPSBzZXRUaW1lb3V0KCAoKSA9PiB7XHJcblx0XHRzZWxmLnVwZGF0ZSgpXHJcblx0fSwgMTUpXHJcblxyXG59XHJcblxyXG5zZWxmLm9ubWVzc2FnZSA9IGZ1bmN0aW9uICggZXZlbnQgKSB7IFxyXG5cclxuXHR2YXIgbWVzc2FnZSAgPSBKU09OLnBhcnNlKCBldmVudC5kYXRhICksXHJcblx0XHRkYXRhIFx0ID0gbWVzc2FnZS5kYXRhLFxyXG5cdFx0dXNlciBcdCA9IG9ic2VydmVyLFxyXG5cdFx0dm94ZWwgXHQgPSBudWxsLFxyXG5cdFx0dG9SZW1vdmUgPSBudWxsLFxyXG5cdFx0aXRlbXMgXHQgPSBbXSxcclxuXHRcdGVudGl0aWVzID0gW10sXHJcblx0XHRjIFx0XHQgPSAwLFxyXG5cdFx0cCBcdFx0ID0gMFxyXG5cdFx0XHJcblx0aWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJ1cGRhdGVcIiApIHtcclxuXHRcdC8vIHVzZXIucHJldlBvcyA9IFt1c2VyLnBvc2l0aW9uWzBdLCB1c2VyLnBvc2l0aW9uWzFdLCB1c2VyLnBvc2l0aW9uWzJdXTtcclxuXHRcdHVzZXIucG9zaXRpb24gPSBkYXRhLnBvc2l0aW9uXHJcblx0XHR1c2VyLnZlbG9jaXR5ID0gZGF0YS52ZWxvY2l0eVxyXG5cdFx0dXNlci52ckhlaWdodCA9IGRhdGEudnJIZWlnaHRcclxuXHRcdC8vc2VsZi5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeShzZWxmLm9ic2VydmVyKSk7XHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwiYWRkIHZveGVsc1wiICkge1xyXG5cclxuXHRcdHZveGVsTGlzdCA9IHZveGVsTGlzdC5jb25jYXQoZGF0YSlcclxuXHJcblx0XHRkYXRhLm1hcCggdiA9PiB7XHJcblx0XHRcdHZveGVsc1sgdi5jZWxsLmpvaW4oXCIuXCIpIF0gPSB2XHJcblx0XHR9KVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJyZW1vdmUgdm94ZWxzXCIgKSB7XHJcblxyXG5cdFx0cCA9IGRhdGEubGVuZ3RoIC0xXHJcblxyXG5cdFx0d2hpbGUgKCBwID49IDAgKSB7XHJcblxyXG5cdFx0XHR0b1JlbW92ZSA9IGRhdGFbcF1cclxuXHRcdFx0YyA9IHZveGVsTGlzdC5sZW5ndGgtMVxyXG5cclxuXHRcdFx0d2hpbGUgKCBjID49IDAgKSB7XHJcblxyXG5cdFx0XHRcdHZveGVsID0gdm94ZWxMaXN0WyBjIF1cclxuXHJcblx0XHRcdFx0aWYgKCB2b3hlbCAhPSBudWxsICYmIHZveGVsLmNlbGxbMF0gPT0gdG9SZW1vdmUuY2VsbFswXSAmJiB2b3hlbC5jZWxsWzFdID09IHRvUmVtb3ZlLmNlbGxbMV0gICYmIHZveGVsLmNlbGxbMl0gPT0gdG9SZW1vdmUuY2VsbFsyXSApIHtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0dm94ZWxMaXN0LnNwbGljZSggYywgMSApXHJcblx0XHRcdFx0XHR2b3hlbHNbIHZveGVsLmNlbGwuam9pbihcIi5cIildID0gbnVsbFxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Yy0tXHJcblxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRwIC0tXHJcblxyXG5cdFx0fVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJhZGQgZW50aXR5XCIgKSB7XHJcblxyXG5cdFx0aWYgKCEhISB2b3hlbHNbZGF0YS5jb29yZHMuam9pbihcIi5cIildKVxyXG5cclxuXHRcdFx0dm94ZWxzW2RhdGEuY29vcmRzLmpvaW4oXCIuXCIpXSA9IHsgZW50aXRpZXM6IFtdLCBjZWxsOiBkYXRhLmNvb3JkcyB9XHJcblxyXG5cclxuICAgIFx0ZW50aXRpZXMgPSB2b3hlbHNbZGF0YS5jb29yZHMuam9pbihcIi5cIildLmVudGl0aWVzXHJcblxyXG4gICAgXHRlbnRpdGllcy5wdXNoKCBkYXRhLmVudGl0eSApXHJcblxyXG4gIH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInJlbW92ZSBlbnRpdHlcIiApIHtcclxuXHJcbiAgICBcdGVudGl0aWVzID0gdm94ZWxzWyBkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKSBdLmVudGl0aWVzXHJcblxyXG5cdFx0aWYgKCBlbnRpdGllcyAhPSBudWxsICkge1xyXG5cclxuXHRcdFx0YyA9IGVudGl0aWVzLmxlbmd0aC0xXHJcblxyXG5cdFx0XHR3aGlsZSAoIGMgPj0gMCApIHtcclxuXHJcblx0XHRcdFx0aWYgKCBlbnRpdGllc1tjXS5pZCA9PSBkYXRhLmVudGl0eUlkICkge1xyXG5cclxuXHRcdFx0XHRcdHZveGVsc1sgZGF0YS5jb29yZHMuam9pbihcIi5cIikgXS5lbnRpdGllcy5zcGxpY2UoYywgMSlcclxuXHRcdFx0XHRcdGMgPSAtMVxyXG5cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGMtLVxyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdH1cclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwidXBkYXRlIGVudGl0eVwiICkge1xyXG5cclxuXHRcdGVudGl0aWVzID0gdm94ZWxzWyBkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKSBdLmVudGl0aWVzXHJcblxyXG5cdFx0aWYgKCBlbnRpdGllcyAhPSBudWxsICkge1xyXG5cclxuXHRcdFx0YyA9IGVudGl0aWVzLmxlbmd0aC0xXHJcblxyXG5cdFx0XHR3aGlsZSAoIGMgPj0gMCApIHtcclxuXHJcblx0XHRcdFx0aWYgKGVudGl0aWVzWyBjIF0uaWQgPT0gZGF0YS5lbnRpdHlJZCkge1xyXG5cclxuXHRcdFx0XHRcdGVudGl0aWVzWyBjIF0gPSBkYXRhLmVudGl0eVxyXG5cdFx0XHRcdFx0YyA9IC0xXHJcblxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Yy0tXHJcblxyXG5cdFx0XHR9XHJcblxyXG5cdFx0fVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJjbGVhclwiICkge1xyXG5cclxuXHRcdHZveGVscyA9IFtdXHJcblxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInN0YXJ0XCIgKSB7XHJcblxyXG5cdFx0c2VsZi51cGRhdGUoKVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJzdG9wXCIgKSB7XHJcblxyXG5cdFx0c2VsZi5zdG9wKClcclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwibG9nXCIgKSB7XHJcblxyXG5cdFx0aWYgKGRhdGEgPT0gXCJcIikge1xyXG5cdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6XCJsb2dcIixcImRhdGFcIjpbJyArIHVzZXIucG9zaXRpb25bMF0gKyAnLCcgKyB1c2VyLnBvc2l0aW9uWzFdICsgJywnICsgdXNlci5wb3NpdGlvblsyXSArICddfScpO1xyXG5cdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6XCJsb2dcIixcImRhdGFcIjonICsgSlNPTi5zdHJpbmdpZnkodm94ZWxzKSsgJ30nKTtcclxuXHRcdH1cclxuXHJcblx0fVxyXG59O1xyXG5cclxuc2VsZi5zdG9wID0gKCkgPT4ge1xyXG5cclxuXHRjbGVhclRpbWVvdXQoIHNlbGYudXBkYXRlTG9vcCApXHJcblxyXG59XHJcbiJdfQ==
