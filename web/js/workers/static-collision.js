(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/*  static collision detection worker */

'use strict';

var distance2d = function distance2d(a, b) {

	return Math.sqrt(Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2));
},
    distance2dCompare = function distance2dCompare(a, b, n) {
	// more efficient version of distance2d()

	return Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2) < n * n;
},
    distance3dCompare = function distance3dCompare(a, b, n) {
	// ..faster than using Math.sqrt()

	return Math.pow(a[0] - b[0], 2) + Math.pow(a[1] - b[1], 2) + Math.pow(a[2] - b[2], 2) < n * n;
};

var observer = {
	position: [0, 0, 0],
	prevPos: [0, 0, 0],
	velocity: [0, 0, 0],
	vrHeight: 0
},
    voxelList = [],
    voxels = [];

self.update = function () {

	var distance = 0,
	    position = observer.position,
	    innerBox = [false, false],
	    velocity = observer.velocity,
	    vrHeight = observer.vrHeight,
	    closeToVenue = false,
	    collision = false,
	    cKey = "",
	    yPos = 0,
	    size = 50000,
	    voxel = null,
	    ent = null,
	    structure = null,
	    bounds = [0, 0],
	    voxel = null,
	    delta = [0, 0],
	    oPos = [],
	    speed = 0,
	    e = 0,
	    i = 0,
	    v = 0;

	for (i = 0; i < voxelList.length; i++) {

		voxel = voxelList[i];

		if (!!!voxel || !!!voxel.position) continue;

		if (!!voxel && distance2dCompare(position, voxel.position, 180)) {
			// do collisions on voxels & structures... just walls at first..

			if (voxel.loaded == undefined) {

				voxel.loaded = true;
				self.postMessage('{"command": "load entities", "data":{"coords":"' + voxel.cell[0] + '.' + voxel.cell[1] + '.' + voxel.cell[2] + '"}}');
			}

			if (distance2dCompare(position, voxel.position, 60)) {

				var alt = voxel.altitude || 0;

				yPos = voxel.position[1];

				if (distance2dCompare(position, voxel.position, 50.110)) {

					if (position[1] > yPos - 400000 + vrHeight && position[1] < yPos + 14 + vrHeight) {

						collision = true;
						self.postMessage('{"command": "platform collision", "data":{"type":"top", "position":[' + voxel.position[0] + ',' + yPos + ',' + voxel.position[2] + '] }}');
					}

					if (!!voxel.entities && voxel.entities.length > 0) {

						e = voxel.entities.length - 1;

						while (e >= 0) {

							ent = voxel.entities[e];

							if (!!!ent || !!!ent.components) {
								console.warn("Problem with entity! ", e, ent);continue;
							}

							if (distance3dCompare(position, ent.position, (ent.boundingRadius || 0.5, 0) + 0.5)) {

								ent.components.map(function (entComp) {

									if (distance3dCompare(position, entComp.position, entComp.boundingRadius || 3)) {

										collision = true;

										if (!!entComp.props.floor) {

											self.postMessage(JSON.stringify({ command: "floor collision", data: {
													position: entComp.position,
													floorData: entComp.props.floor
												} }));
										} else {

											self.postMessage(JSON.stringify({ command: "entity-user collision", data: { position: entComp.position } }));
										}
									}
								});
							}

							e -= 1;
						}
					}
				}
			}
		}
	}

	if (!collision) observer.prevPos = [observer.position[0], observer.position[1], observer.position[2]];

	self.postMessage('{"command": "update"}');
	self.updateLoop = setTimeout(function () {
		self.update();
	}, 15);
};

self.onmessage = function (event) {

	var message = JSON.parse(event.data),
	    data = message.data,
	    user = observer,
	    voxel = null,
	    toRemove = null,
	    items = [],
	    entities = [],
	    c = 0,
	    p = 0;

	if (message.command == "update") {
		// user.prevPos = [user.position[0], user.position[1], user.position[2]];
		user.position = data.position;
		user.velocity = data.velocity;
		user.vrHeight = data.vrHeight;
		//self.postMessage(JSON.stringify(self.observer));
	} else if (message.command == "add voxels") {

			voxelList = voxelList.concat(data);

			data.map(function (v) {
				voxels[v.cell.join(".")] = v;
			});
		} else if (message.command == "remove voxels") {

			p = data.length - 1;

			while (p >= 0) {

				toRemove = data[p];
				c = voxelList.length - 1;

				while (c >= 0) {

					voxel = voxelList[c];

					if (voxel != null && voxel.cell[0] == toRemove.cell[0] && voxel.cell[1] == toRemove.cell[1] && voxel.cell[2] == toRemove.cell[2]) {

						voxelList.splice(c, 1);
						voxels[voxel.cell.join(".")] = null;
					}

					c--;
				}

				p--;
			}
		} else if (message.command == "add entity") {

			if (!!!voxels[data.coords.join(".")]) voxels[data.coords.join(".")] = { entities: [], cell: data.coords };

			entities = voxels[data.coords.join(".")].entities;

			entities.push(data.entity);
		} else if (message.command == "remove entity") {

			entities = voxels[data.coords.join(".")].entities;

			if (entities != null) {

				c = entities.length - 1;

				while (c >= 0) {

					if (entities[c].id == data.entityId) {

						voxels[data.coords.join(".")].entities.splice(c, 1);
						c = -1;
					}

					c--;
				}
			}
		} else if (message.command == "update entity") {

			entities = voxels[data.coords.join(".")].entities;

			if (entities != null) {

				c = entities.length - 1;

				while (c >= 0) {

					if (entities[c].id == data.entityId) {

						entities[c] = data.entity;
						c = -1;
					}

					c--;
				}
			}
		} else if (message.command == "clear") {

			voxels = [];
		} else if (message.command == "start") {

			self.update();
		} else if (message.command == "stop") {

			self.stop();
		} else if (message.command == "log") {

			if (data == "") {
				self.postMessage('{"command":"log","data":[' + user.position[0] + ',' + user.position[1] + ',' + user.position[2] + ']}');
				self.postMessage('{"command":"log","data":' + JSON.stringify(voxels) + '}');
			}
		}
};

self.stop = function () {

	clearTimeout(self.updateLoop);
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJDOi9Db2RlL3NyYy9naXRodWIuY29tL2NvbnZvbHZyL2NvbnZvbHZyL2NsaWVudC9zcmMvanMvd29ya2Vycy9zdGF0aWMtY29sbGlzaW9ucy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7QUNFQSxJQUFJLFVBQVUsR0FBRyxTQUFiLFVBQVUsQ0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFNOztBQUV6QixRQUFPLElBQUksQ0FBQyxJQUFJLENBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFHLENBQUMsQ0FBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRyxDQUFDLENBQUUsQ0FBRSxDQUFBO0NBRTVFO0lBQ0QsaUJBQWlCLEdBQUcsU0FBcEIsaUJBQWlCLENBQUssQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQU07OztBQUVsQyxRQUFPLElBQUksQ0FBQyxHQUFHLENBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRyxDQUFDLENBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUcsQ0FBQyxDQUFFLEdBQUksQ0FBQyxHQUFDLENBQUMsQUFBQyxDQUFBO0NBRXRFO0lBQ0QsaUJBQWlCLEdBQUcsU0FBcEIsaUJBQWlCLENBQUssQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQU07OztBQUVsQyxRQUFPLEFBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFHLENBQUMsQ0FBRSxHQUFHLElB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SSxPQUFPLEVBQUc7O0FBRXhDLFNBQU0sR0FBRyxFQUFFLENBQUE7R0FFWCxNQUFNLElBQUssT0FBTyxDQUFDLE9BQU8sSUFBSSxPQUFPLEVBQUc7O0FBRXhDLE9BQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQTtHQUViLE1BQU0sSUFBSyxPQUFPLENBQUMsT0FBTyxJQUFJLE1BQU0sRUFBRzs7QUFFdkMsT0FBSSxDQUFDLElBQUksRUFBRSxDQUFBO0dBRVgsTUFBTSxJQUFLLE9BQU8sQ0FBQyxPQUFPLElBQUksS0FBSyxFQUFHOztBQUV0QyxPQUFJLElBQUksSUFBSSxFQUFFLEVBQUU7QUFDZixRQUFJLENBQUMsV0FBVyxDQUFDLDJCQUEyQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFDMUgsUUFBSSxDQUFDLFdBQVcsQ0FBQywwQkFBMEIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxHQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQzNFO0dBRUQ7Q0FDRCxDQUFDOztBQUVGLElBQUksQ0FBQyxJQUFJLEdBQUcsWUFBTTs7QUFFakIsYUFBWSxDQUFFLElBQUksQ0FBQyxVQUFVLENBQUUsQ0FBQTtDQUUvQixDQUFBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qICBzdGF0aWMgY29sbGlzaW9uIGRldGVjdGlvbiB3b3JrZXIgKi9cclxuXHJcbmxldCBkaXN0YW5jZTJkID0gKCBhLCBiICkgPT4ge1xyXG5cclxuICAgIHJldHVybiBNYXRoLnNxcnQoIE1hdGgucG93KCAoYVswXS1iWzBdKSwgMiApICsgTWF0aC5wb3coIChhWzJdLWJbMl0pLCAyICkgKVxyXG5cclxuICB9LFxyXG4gIGRpc3RhbmNlMmRDb21wYXJlID0gKCBhLCBiLCBuICkgPT4geyAvLyBtb3JlIGVmZmljaWVudCB2ZXJzaW9uIG9mIGRpc3RhbmNlMmQoKVxyXG5cclxuXHQgIHJldHVybiBNYXRoLnBvdyggKGFbMF0tYlswXSksIDIgKSArIE1hdGgucG93KCAoYVsyXS1iWzJdKSwgMiApIDwgKG4qbilcclxuXHJcbiAgfSxcclxuICBkaXN0YW5jZTNkQ29tcGFyZSA9ICggYSwgYiwgbiApID0+IHsgLy8gLi5mYXN0ZXIgdGhhbiB1c2luZyBNYXRoLnNxcnQoKVxyXG5cclxuXHQgIHJldHVybiAoTWF0aC5wb3coIChhWzBdLWJbMF0pLCAyICkgKyBNYXRoLnBvdyggKGFbMV0tYlsxXSksIDIgKSArIE1hdGgucG93KCAoYVsyXS1iWzJdKSwgMiApICkgPCAobipuKVxyXG5cclxuICB9XHJcblxyXG5sZXQgb2JzZXJ2ZXIgPSB7XHJcblx0XHRwb3NpdGlvbjogWzAsIDAsIDBdLFxyXG5cdFx0cHJldlBvczogWzAsIDAsIDBdLFxyXG5cdFx0dmVsb2NpdHk6IFswLCAwLCAwXSxcclxuXHRcdHZySGVpZ2h0OiAwXHJcblx0fSxcclxuXHR2b3hlbExpc3QgPSBbXSxcclxuXHR2b3hlbHMgPSBbXVxyXG5cclxuc2VsZi51cGRhdGUgPSAoICkgPT4ge1xyXG5cclxuXHR2YXIgZGlzdGFuY2UgPSAwLFxyXG5cdFx0cG9zaXRpb24gXHQgPSBvYnNlcnZlci5wb3NpdGlvbixcclxuXHRcdGlubmVyQm94IFx0ID0gW2ZhbHNlLCBmYWxzZV0sXHJcblx0XHR2ZWxvY2l0eSBcdCA9IG9ic2VydmVyLnZlbG9jaXR5LFxyXG5cdFx0dnJIZWlnaHQgXHQgPSBvYnNlcnZlci52ckhlaWdodCxcclxuXHRcdGNsb3NlVG9WZW51ZSA9ICBmYWxzZSxcclxuXHRcdGNvbGxpc2lvbiBcdCA9IGZhbHNlLFxyXG5cdFx0Y0tleSBcdFx0ID0gXCJcIixcclxuXHRcdHlQb3MgXHRcdCA9IDAsXHJcblx0XHRzaXplIFx0XHQgPSA1MDAwMCxcclxuXHRcdHZveGVsIFx0XHQgPSBudWxsLFxyXG5cdFx0ZW50IFx0XHQgPSBudWxsLFxyXG5cdFx0c3RydWN0dXJlIFx0ID0gbnVsbCxcclxuXHRcdGJvdW5kcyBcdFx0ID0gWzAsIDBdLFxyXG5cdFx0dm94ZWwgXHRcdCA9IG51bGwsXHJcblx0XHRkZWx0YSBcdFx0ID0gWzAsIDBdLFxyXG5cdFx0b1BvcyBcdFx0ID0gW10sXHJcblx0XHRzcGVlZCBcdFx0ID0gMCxcclxuXHRcdGUgXHRcdFx0ID0gMCxcclxuXHRcdGkgXHRcdFx0ID0gMCxcclxuXHRcdHYgXHRcdFx0ID0gMFxyXG5cclxuXHRmb3IgKCBpID0gMDsgaSA8IHZveGVsTGlzdC5sZW5ndGg7IGkgKysgKSB7XHJcblxyXG5cdFx0dm94ZWwgPSB2b3hlbExpc3RbIGkgXVxyXG5cclxuXHRcdGlmICggISEhdm94ZWwgfHwgISEhdm94ZWwucG9zaXRpb24pIGNvbnRpbnVlXHJcblxyXG5cdFx0aWYgKCAhIXZveGVsICYmIGRpc3RhbmNlMmRDb21wYXJlKCBwb3NpdGlvbiwgdm94ZWwucG9zaXRpb24sIDE4MCApICkgeyBcdC8vIGRvIGNvbGxpc2lvbnMgb24gdm94ZWxzICYgc3RydWN0dXJlcy4uLiBqdXN0IHdhbGxzIGF0IGZpcnN0Li5cclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRpZiAoIHZveGVsLmxvYWRlZCA9PSB1bmRlZmluZWQgKSB7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0dm94ZWwubG9hZGVkID0gdHJ1ZVxyXG5cdFx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoJ3tcImNvbW1hbmRcIjogXCJsb2FkIGVudGl0aWVzXCIsIFwiZGF0YVwiOntcImNvb3Jkc1wiOlwiJyt2b3hlbC5jZWxsWzBdKycuJyt2b3hlbC5jZWxsWzFdKycuJyt2b3hlbC5jZWxsWzJdKydcIn19Jyk7XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIGRpc3RhbmNlMmRDb21wYXJlKCBwb3NpdGlvbiwgdm94ZWwucG9zaXRpb24sIDYwICkgKSB7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRsZXQgYWx0ID0gdm94ZWwuYWx0aXR1ZGUgfHwgMFxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdHlQb3MgPSB2b3hlbC5wb3NpdGlvblsxXVxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGlmICggZGlzdGFuY2UyZENvbXBhcmUoIHBvc2l0aW9uLCB2b3hlbC5wb3NpdGlvbiwgNTAuMTEwICkgKSB7XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0aWYgKCBwb3NpdGlvblsxXSA+IHlQb3MgLSA0MDAwMDAgKyB2ckhlaWdodCAgJiYgcG9zaXRpb25bMV0gPCB5UG9zICsgMTQgKyB2ckhlaWdodCApIHtcclxuXHJcblx0XHRcdFx0XHRcdGNvbGxpc2lvbiA9IHRydWVcclxuXHRcdFx0XHRcdFx0c2VsZi5wb3N0TWVzc2FnZSgne1wiY29tbWFuZFwiOiBcInBsYXRmb3JtIGNvbGxpc2lvblwiLCBcImRhdGFcIjp7XCJ0eXBlXCI6XCJ0b3BcIiwgXCJwb3NpdGlvblwiOlsnICsgdm94ZWwucG9zaXRpb25bMF0gKyAnLCcgKyB5UG9zICsgJywnICsgdm94ZWwucG9zaXRpb25bMl0gKyAnXSB9fScpO1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKCAhIXZveGVsLmVudGl0aWVzICYmIHZveGVsLmVudGl0aWVzLmxlbmd0aCA+IDAgKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRlID0gdm94ZWwuZW50aXRpZXMubGVuZ3RoIC0gMVxyXG5cclxuXHRcdFx0XHRcdFx0d2hpbGUgKCBlID49IDAgKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGVudCA9IHZveGVsLmVudGl0aWVzWyBlIF1cclxuXHJcblx0XHRcdFx0XHRcdFx0aWYgKCAhISEgZW50IHx8ICEhIWVudC5jb21wb25lbnRzICkgeyBjb25zb2xlLndhcm4oXCJQcm9ibGVtIHdpdGggZW50aXR5ISBcIixlICxlbnQpOyBjb250aW51ZSB9XHJcblxyXG5cdFx0XHRcdFx0XHRcdGlmICggZGlzdGFuY2UzZENvbXBhcmUoIHBvc2l0aW9uLCBlbnQucG9zaXRpb24sIChlbnQuYm91bmRpbmdSYWRpdXN8fDAuNSwwKSswLjUsKSApIHsgXHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0ZW50LmNvbXBvbmVudHMubWFwKCBlbnRDb21wID0+IHtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmICggZGlzdGFuY2UzZENvbXBhcmUoIHBvc2l0aW9uLCBlbnRDb21wLnBvc2l0aW9uLCBlbnRDb21wLmJvdW5kaW5nUmFkaXVzIHx8IDMpICkge1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjb2xsaXNpb24gPSB0cnVlXHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmICggISEgZW50Q29tcC5wcm9wcy5mbG9vciApIHsgXHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2VsZi5wb3N0TWVzc2FnZSggSlNPTi5zdHJpbmdpZnkoIHtjb21tYW5kOiBcImZsb29yIGNvbGxpc2lvblwiLCBkYXRhOiB7IFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRwb3NpdGlvbjogZW50Q29tcC5wb3NpdGlvbiwgXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGZsb29yRGF0YTogZW50Q29tcC5wcm9wcy5mbG9vclxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fX0pKVxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoIEpTT04uc3RyaW5naWZ5KCB7Y29tbWFuZDogXCJlbnRpdHktdXNlciBjb2xsaXNpb25cIiwgZGF0YTp7IHBvc2l0aW9uOiBlbnRDb21wLnBvc2l0aW9uIH19ICkgKVxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0fSlcclxuXHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHRlIC09IDFcclxuXHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHR9XHJcblxyXG5cdFx0fVxyXG5cclxuXHR9XHJcblxyXG5cdGlmICggIWNvbGxpc2lvbiApXHJcblxyXG5cdFx0b2JzZXJ2ZXIucHJldlBvcyA9IFsgb2JzZXJ2ZXIucG9zaXRpb25bMF0sIG9ic2VydmVyLnBvc2l0aW9uWzFdLCBvYnNlcnZlci5wb3NpdGlvblsyXSBdXHJcblx0XHJcblxyXG5cdHNlbGYucG9zdE1lc3NhZ2UoJ3tcImNvbW1hbmRcIjogXCJ1cGRhdGVcIn0nKVxyXG5cdHNlbGYudXBkYXRlTG9vcCA9IHNldFRpbWVvdXQoICgpID0+IHtcclxuXHRcdHNlbGYudXBkYXRlKClcclxuXHR9LCAxNSlcclxuXHJcbn1cclxuXHJcbnNlbGYub25tZXNzYWdlID0gZnVuY3Rpb24gKCBldmVudCApIHsgXHJcblxyXG5cdHZhciBtZXNzYWdlICA9IEpTT04ucGFyc2UoIGV2ZW50LmRhdGEgKSxcclxuXHRcdGRhdGEgXHQgPSBtZXNzYWdlLmRhdGEsXHJcblx0XHR1c2VyIFx0ID0gb2JzZXJ2ZXIsXHJcblx0XHR2b3hlbCBcdCA9IG51bGwsXHJcblx0XHR0b1JlbW92ZSA9IG51bGwsXHJcblx0XHRpdGVtcyBcdCA9IFtdLFxyXG5cdFx0ZW50aXRpZXMgPSBbXSxcclxuXHRcdGMgXHRcdCA9IDAsXHJcblx0XHRwIFx0XHQgPSAwXHJcblx0XHRcclxuXHRpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInVwZGF0ZVwiICkge1xyXG5cdFx0Ly8gdXNlci5wcmV2UG9zID0gW3VzZXIucG9zaXRpb25bMF0sIHVzZXIucG9zaXRpb25bMV0sIHVzZXIucG9zaXRpb25bMl1dO1xyXG5cdFx0dXNlci5wb3NpdGlvbiA9IGRhdGEucG9zaXRpb25cclxuXHRcdHVzZXIudmVsb2NpdHkgPSBkYXRhLnZlbG9jaXR5XHJcblx0XHR1c2VyLnZySGVpZ2h0ID0gZGF0YS52ckhlaWdodFxyXG5cdFx0Ly9zZWxmLnBvc3RNZXNzYWdlKEpTT04uc3RyaW5naWZ5KHNlbGYub2JzZXJ2ZXIpKTtcclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJhZGQgdm94ZWxzXCIgKSB7XHJcblxyXG5cdFx0dm94ZWxMaXN0ID0gdm94ZWxMaXN0LmNvbmNhdChkYXRhKVxyXG5cclxuXHRcdGRhdGEubWFwKCB2ID0+IHtcclxuXHRcdFx0dm94ZWxzWyB2LmNlbGwuam9pbihcIi5cIikgXSA9IHZcclxuXHRcdH0pXHJcblxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInJlbW92ZSB2b3hlbHNcIiApIHtcclxuXHJcblx0XHRwID0gZGF0YS5sZW5ndGggLTFcclxuXHJcblx0XHR3aGlsZSAoIHAgPj0gMCApIHtcclxuXHJcblx0XHRcdHRvUmVtb3ZlID0gZGF0YVtwXVxyXG5cdFx0XHRjID0gdm94ZWxMaXN0Lmxlbmd0aC0xXHJcblxyXG5cdFx0XHR3aGlsZSAoIGMgPj0gMCApIHtcclxuXHJcblx0XHRcdFx0dm94ZWwgPSB2b3hlbExpc3RbIGMgXVxyXG5cclxuXHRcdFx0XHRpZiAoIHZveGVsICE9IG51bGwgJiYgdm94ZWwuY2VsbFswXSA9PSB0b1JlbW92ZS5jZWxsWzBdICYmIHZveGVsLmNlbGxbMV0gPT0gdG9SZW1vdmUuY2VsbFsxXSAgJiYgdm94ZWwuY2VsbFsyXSA9PSB0b1JlbW92ZS5jZWxsWzJdICkge1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHR2b3hlbExpc3Quc3BsaWNlKCBjLCAxIClcclxuXHRcdFx0XHRcdHZveGVsc1sgdm94ZWwuY2VsbC5qb2luKFwiLlwiKV0gPSBudWxsXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRjLS1cclxuXHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHAgLS1cclxuXHJcblx0XHR9XHJcblxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcImFkZCBlbnRpdHlcIiApIHtcclxuXHJcblx0XHRpZiAoISEhIHZveGVsc1tkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKV0pXHJcblxyXG5cdFx0XHR2b3hlbHNbZGF0YS5jb29yZHMuam9pbihcIi5cIildID0geyBlbnRpdGllczogW10sIGNlbGw6IGRhdGEuY29vcmRzIH1cclxuXHJcblxyXG4gICAgXHRlbnRpdGllcyA9IHZveGVsc1tkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKV0uZW50aXRpZXNcclxuXHJcbiAgICBcdGVudGl0aWVzLnB1c2goIGRhdGEuZW50aXR5IClcclxuXHJcbiAgfSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwicmVtb3ZlIGVudGl0eVwiICkge1xyXG5cclxuICAgIFx0ZW50aXRpZXMgPSB2b3hlbHNbIGRhdGEuY29vcmRzLmpvaW4oXCIuXCIpIF0uZW50aXRpZXNcclxuXHJcblx0XHRpZiAoIGVudGl0aWVzICE9IG51bGwgKSB7XHJcblxyXG5cdFx0XHRjID0gZW50aXRpZXMubGVuZ3RoLTFcclxuXHJcblx0XHRcdHdoaWxlICggYyA+PSAwICkge1xyXG5cclxuXHRcdFx0XHRpZiAoIGVudGl0aWVzW2NdLmlkID09IGRhdGEuZW50aXR5SWQgKSB7XHJcblxyXG5cdFx0XHRcdFx0dm94ZWxzWyBkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKSBdLmVudGl0aWVzLnNwbGljZShjLCAxKVxyXG5cdFx0XHRcdFx0YyA9IC0xXHJcblxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Yy0tXHJcblxyXG5cdFx0XHR9XHJcblxyXG5cdFx0fVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJ1cGRhdGUgZW50aXR5XCIgKSB7XHJcblxyXG5cdFx0ZW50aXRpZXMgPSB2b3hlbHNbIGRhdGEuY29vcmRzLmpvaW4oXCIuXCIpIF0uZW50aXRpZXNcclxuXHJcblx0XHRpZiAoIGVudGl0aWVzICE9IG51bGwgKSB7XHJcblxyXG5cdFx0XHRjID0gZW50aXRpZXMubGVuZ3RoLTFcclxuXHJcblx0XHRcdHdoaWxlICggYyA+PSAwICkge1xyXG5cclxuXHRcdFx0XHRpZiAoZW50aXRpZXNbIGMgXS5pZCA9PSBkYXRhLmVudGl0eUlkKSB7XHJcblxyXG5cdFx0XHRcdFx0ZW50aXRpZXNbIGMgXSA9IGRhdGEuZW50aXR5XHJcblx0XHRcdFx0XHRjID0gLTFcclxuXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRjLS1cclxuXHJcblx0XHRcdH1cclxuXHJcblx0XHR9XHJcblxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcImNsZWFyXCIgKSB7XHJcblxyXG5cdFx0dm94ZWxzID0gW11cclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwic3RhcnRcIiApIHtcclxuXHJcblx0XHRzZWxmLnVwZGF0ZSgpXHJcblxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInN0b3BcIiApIHtcclxuXHJcblx0XHRzZWxmLnN0b3AoKVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJsb2dcIiApIHtcclxuXHJcblx0XHRpZiAoZGF0YSA9PSBcIlwiKSB7XHJcblx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoJ3tcImNvbW1hbmRcIjpcImxvZ1wiLFwiZGF0YVwiOlsnICsgdXNlci5wb3NpdGlvblswXSArICcsJyArIHVzZXIucG9zaXRpb25bMV0gKyAnLCcgKyB1c2VyLnBvc2l0aW9uWzJdICsgJ119Jyk7XHJcblx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoJ3tcImNvbW1hbmRcIjpcImxvZ1wiLFwiZGF0YVwiOicgKyBKU09OLnN0cmluZ2lmeSh2b3hlbHMpKyAnfScpO1xyXG5cdFx0fVxyXG5cclxuXHR9XHJcbn07XHJcblxyXG5zZWxmLnN0b3AgPSAoKSA9PiB7XHJcblxyXG5cdGNsZWFyVGltZW91dCggc2VsZi51cGRhdGVMb29wIClcclxuXHJcbn1cclxuIl19
