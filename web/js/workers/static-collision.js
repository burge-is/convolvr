(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/*  static collision detection worker */

"use strict";

var distance2d = function (a, b) {

	return Math.sqrt(Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2));
},
    distance2dCompare = function (a, b, n) {
	// more efficient version of distance2d()

	return Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2) < n * n;
},
    distance3dCompare = function (a, b, n) {
	// ..faster than using Math.sqrt()

	return Math.pow(a[0] - b[0], 2) + Math.pow(a[1] - b[1], 2) + Math.pow(a[2] - b[2], 2) < n * n;
};

var observer = {
	position: [0, 0, 0],
	prevPos: [0, 0, 0],
	velocity: [0, 0, 0],
	vrHeight: 0
},
    voxelList = [],
    voxels = [];

self.update = function () {

	var distance = 0,
	    objPos = [],
	    position = observer.position,
	    innerBox = [false, false],
	    velocity = observer.velocity,
	    vrHeight = observer.vrHeight,
	    closeToVenue = false,
	    collision = false,
	    cKey = "",
	    yPos = 0,
	    size = 50000,
	    obj = null,
	    ent = null,
	    structure = null,
	    bounds = [0, 0],
	    voxel = null,
	    delta = [0, 0],
	    oPos = [],
	    speed = 0,
	    e = 0,
	    i = 0,
	    v = 0;

	for (i = 0; i < voxelList.length; i++) {

		obj = voxelList[i];
		if (!!!obj) continue;
		if (!!obj && distance2dCompare(position, obj.position, 2500000)) {
			// do collisions on voxels & structures... just walls at first..

			if (obj.loaded == undefined) {

				obj.loaded = true;
				self.postMessage("{\"command\": \"load entities\", \"data\":{\"coords\":\"" + obj.cell[0] + "." + obj.cell[1] + "." + obj.cell[2] + "\"}}");
			}

			if (distance2dCompare(position, obj.position, 900000)) {

				var alt = obj.altitude || 0;

				yPos = obj.position[1];

				if (distance2dCompare(position, obj.position, 528000)) {

					if (position[1] > yPos - 300000 + vrHeight && position[1] < yPos + 452000 + vrHeight) {

						collision = true;
						self.postMessage("{\"command\": \"platform collision\", \"data\":{\"type\":\"top\", \"position\":[" + obj.position[0] + "," + yPos + "," + obj.position[2] + "] }}");
					}

					if (!!obj.entities && obj.entities.length > 0) {

						e = obj.entities.length - 1;

						while (e >= 0) {

							ent = obj.entities[e];

							if (!!!ent || !!!ent.components) {
								console.warn("Problem with entity! ", e, ent);continue;
							}

							if (distance3dCompare(position, ent.position, (ent.boundingRadius || 100000) + 10000)) {

								ent.components.map(function (entComp) {

									if (distance3dCompare(position, entComp.position, entComp.boundingRadius || 28000)) {

										collision = true;

										if (!!entComp.props.floor) {

											self.postMessage(JSON.stringify({ command: "floor collision", data: {
													position: entComp.position,
													floorData: entComp.props.floor
												} }));
										} else {

											self.postMessage(JSON.stringify({ command: "entity-user collision", data: { position: entComp.position } }));
										}
									}
								});
							}

							e--;
						}
					}
				}
			}
		}
	}

	if (!collision) {
		observer.prevPos = [observer.position[0], observer.position[1], observer.position[2]];
	}

	self.postMessage("{\"command\": \"update\"}");
	self.updateLoop = setTimeout(function () {
		self.update();
	}, 15);
};

self.onmessage = function (event) {

	var message = JSON.parse(event.data),
	    data = message.data,
	    user = observer,
	    voxel = null,
	    toRemove = null,
	    items = [],
	    entities = [],
	    c = 0,
	    p = 0;

	if (message.command == "update") {
		// user.prevPos = [user.position[0], user.position[1], user.position[2]];
		user.position = data.position;
		user.velocity = data.velocity;
		user.vrHeight = data.vrHeight
		//self.postMessage(JSON.stringify(self.observer));
		;
	} else if (message.command == "add voxels") {

		voxelList = voxelList.concat(data);

		data.map(function (v) {
			voxels[v.cell.join(".")] = v;
		});
	} else if (message.command == "remove voxels") {

		p = data.length - 1;

		while (p >= 0) {

			toRemove = data[p];
			c = voxelList.length - 1;

			while (c >= 0) {

				voxel = voxelList[c];

				if (voxel != null && voxel.cell[0] == toRemove.cell[0] && voxel.cell[1] == toRemove.cell[1] && voxel.cell[2] == toRemove.cell[2]) {

					voxelList.splice(c, 1);
					voxels[voxel.cell.join(".")] = null;
				}

				c--;
			}

			p--;
		}
	} else if (message.command == "add entity") {

		if (!!!voxels[data.coords.join(".")]) voxels[data.coords.join(".")] = { entities: [], cell: data.coords };

		entities = voxels[data.coords.join(".")].entities;

		entities.push(data.entity);
	} else if (message.command == "remove entity") {

		entities = voxels[data.coords.join(".")].entities;

		if (entities != null) {

			c = entities.length - 1;

			while (c >= 0) {

				if (entities[c].id == data.entityId) {

					voxels[data.coords.join(".")].entities.splice(c, 1);
					c = -1;
				}

				c--;
			}
		}
	} else if (message.command == "update entity") {

		entities = voxels[data.coords.join(".")].entities;

		if (entities != null) {

			c = entities.length - 1;

			while (c >= 0) {

				if (entities[c].id == data.entityId) {

					entities[c] = data.entity;
					c = -1;
				}

				c--;
			}
		}
	} else if (message.command == "clear") {

		voxels = [];
	} else if (message.command == "start") {

		self.update();
	} else if (message.command == "stop") {

		self.stop();
	} else if (message.command == "log") {

		if (data == "") {
			self.postMessage("{\"command\":\"log\",\"data\":[" + user.position[0] + "," + user.position[1] + "," + user.position[2] + "]}");
			self.postMessage("{\"command\":\"log\",\"data\":" + JSON.stringify(voxels) + "}");
		}
	}
};

self.stop = function () {

	clearTimeout(self.updateLoop);
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL1VzZXJzL29wZW5zL0FwcERhdGEvUm9hbWluZy9ucG0vbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIkM6L0NvZGUvc3JjL2dpdGh1Yi5jb20vY29udm9sdnIvY29udm9sdnIvY2xpZW50L3NyYy9qcy93b3JrZXJzL3N0YXRpYy1jb2xsaXNpb25zLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztBQ0VBLElBQUksVUFBVSxHQUFHLFVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBTTs7QUFFekIsUUFBTyxJQUFJLENBQUMsSUFBSSxDQUFFLElBQUksQ0FBQyxHQUFHLENBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRyxDQUFDLENBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUcsQ0FBQyxDQUFFLENBQUUsQ0FBQTtDQUU1RTtJQUNELGlCQUFpQixHQUFHLFVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQU07OztBQUVsQyxRQUFPLElBQUksQ0FBQyxHQUFHLENBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRyxDQUFDLENBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUcsQ0FBQyxDQUFFLEdBQUksQ0FBQyxHQUFDLENBQUMsQUFBQyxDQUFBO0NBRXRFO0lBQ0QsaUJBQWlCLEdBQUcsVUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBTTs7O0FBRWxDLFFBQU8sQUFBQyxJQUFJLENBQUMsR0FBRyxDQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBQyxDQUFD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QU8sSUFBSSxlQUFlLEVBQUc7O0FBRTlDLFVBQVEsR0FBRyxNQUFNLENBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUUsQ0FBQyxRQUFRLENBQUE7O0FBRXRELE1BQUssUUFBUSxJQUFJLElBQUksRUFBRzs7QUFFdkIsSUFBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEdBQUMsQ0FBQyxDQUFBOztBQUVyQixVQUFRLENBQUMsSUFBSSxDQUFDLEVBQUc7O0FBRWhCLFFBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFHOztBQUV0QyxXQUFNLENBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUNyRCxNQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7S0FFTjs7QUFFRCxLQUFDLEVBQUUsQ0FBQTtJQUVIO0dBRUQ7RUFFRCxNQUFNLElBQUssT0FBTyxDQUFDLE9BQU8sSUFBSSxlQUFlLEVBQUc7O0FBRWhELFVBQVEsR0FBRyxNQUFNLENBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUUsQ0FBQyxRQUFRLENBQUE7O0FBRW5ELE1BQUssUUFBUSxJQUFJLElBQUksRUFBRzs7QUFFdkIsSUFBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEdBQUMsQ0FBQyxDQUFBOztBQUVyQixVQUFRLENBQUMsSUFBSSxDQUFDLEVBQUc7O0FBRWhCLFFBQUksUUFBUSxDQUFFLENBQUMsQ0FBRSxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFOztBQUV0QyxhQUFRLENBQUUsQ0FBQyxDQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQTtBQUMzQixNQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7S0FFTjs7QUFFRCxLQUFDLEVBQUUsQ0FBQTtJQUVIO0dBRUQ7RUFFRCxNQUFNLElBQUssT0FBTyxDQUFDLE9BQU8sSUFBSSxPQUFPLEVBQUc7O0FBRXhDLFFBQU0sR0FBRyxFQUFFLENBQUE7RUFFWCxNQUFNLElBQUssT0FBTyxDQUFDLE9BQU8sSUFBSSxPQUFPLEVBQUc7O0FBRXhDLE1BQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQTtFQUViLE1BQU0sSUFBSyxPQUFPLENBQUMsT0FBTyxJQUFJLE1BQU0sRUFBRzs7QUFFdkMsTUFBSSxDQUFDLElBQUksRUFBRSxDQUFBO0VBRVgsTUFBTSxJQUFLLE9BQU8sQ0FBQyxPQUFPLElBQUksS0FBSyxFQUFHOztBQUV0QyxNQUFJLElBQUksSUFBSSxFQUFFLEVBQUU7QUFDZixPQUFJLENBQUMsV0FBVyxDQUFDLGlDQUEyQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFDMUgsT0FBSSxDQUFDLFdBQVcsQ0FBQyxnQ0FBMEIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxHQUFFLEdBQUcsQ0FBQyxDQUFDO0dBQzNFO0VBRUQ7Q0FDRCxDQUFDOztBQUVGLElBQUksQ0FBQyxJQUFJLEdBQUcsWUFBTTs7QUFFakIsYUFBWSxDQUFFLElBQUksQ0FBQyxVQUFVLENBQUUsQ0FBQTtDQUUvQixDQUFBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qICBzdGF0aWMgY29sbGlzaW9uIGRldGVjdGlvbiB3b3JrZXIgKi9cclxuXHJcbmxldCBkaXN0YW5jZTJkID0gKCBhLCBiICkgPT4ge1xyXG5cclxuICAgIHJldHVybiBNYXRoLnNxcnQoIE1hdGgucG93KCAoYVswXS1iWzBdKSwgMiApICsgTWF0aC5wb3coIChhWzJdLWJbMl0pLCAyICkgKVxyXG5cclxuICB9LFxyXG4gIGRpc3RhbmNlMmRDb21wYXJlID0gKCBhLCBiLCBuICkgPT4geyAvLyBtb3JlIGVmZmljaWVudCB2ZXJzaW9uIG9mIGRpc3RhbmNlMmQoKVxyXG5cclxuXHQgIHJldHVybiBNYXRoLnBvdyggKGFbMF0tYlswXSksIDIgKSArIE1hdGgucG93KCAoYVsyXS1iWzJdKSwgMiApIDwgKG4qbilcclxuXHJcbiAgfSxcclxuICBkaXN0YW5jZTNkQ29tcGFyZSA9ICggYSwgYiwgbiApID0+IHsgLy8gLi5mYXN0ZXIgdGhhbiB1c2luZyBNYXRoLnNxcnQoKVxyXG5cclxuXHQgIHJldHVybiAoTWF0aC5wb3coIChhWzBdLWJbMF0pLCAyICkgKyBNYXRoLnBvdyggKGFbMV0tYlsxXSksIDIgKSArIE1hdGgucG93KCAoYVsyXS1iWzJdKSwgMiApICkgPCAobipuKVxyXG5cclxuICB9XHJcblxyXG5sZXQgb2JzZXJ2ZXIgPSB7XHJcblx0XHRwb3NpdGlvbjogWzAsIDAsIDBdLFxyXG5cdFx0cHJldlBvczogWzAsIDAsIDBdLFxyXG5cdFx0dmVsb2NpdHk6IFswLCAwLCAwXSxcclxuXHRcdHZySGVpZ2h0OiAwXHJcblx0fSxcclxuXHR2b3hlbExpc3QgPSBbXSxcclxuXHR2b3hlbHMgPSBbXVxyXG5cclxuc2VsZi51cGRhdGUgPSAoICkgPT4ge1xyXG5cclxuXHR2YXIgZGlzdGFuY2UgPSAwLFxyXG5cdFx0b2JqUG9zID0gW10sXHJcblx0XHRwb3NpdGlvbiA9IG9ic2VydmVyLnBvc2l0aW9uLFxyXG5cdFx0aW5uZXJCb3ggPSBbZmFsc2UsIGZhbHNlXSxcclxuXHRcdHZlbG9jaXR5ID0gb2JzZXJ2ZXIudmVsb2NpdHksXHJcblx0XHR2ckhlaWdodCA9IG9ic2VydmVyLnZySGVpZ2h0LFxyXG5cdFx0Y2xvc2VUb1ZlbnVlID0gIGZhbHNlLFxyXG5cdFx0Y29sbGlzaW9uID0gZmFsc2UsXHJcblx0XHRjS2V5ID0gXCJcIixcclxuXHRcdHlQb3MgPSAwLFxyXG5cdFx0c2l6ZSA9IDUwMDAwLFxyXG5cdFx0b2JqID0gbnVsbCxcclxuXHRcdGVudCA9IG51bGwsXHJcblx0XHRzdHJ1Y3R1cmUgPSBudWxsLFxyXG5cdFx0Ym91bmRzID0gWzAsIDBdLFxyXG5cdFx0dm94ZWwgPSBudWxsLFxyXG5cdFx0ZGVsdGEgPSBbMCwgMF0sXHJcblx0XHRvUG9zID0gW10sXHJcblx0XHRzcGVlZCA9IDAsXHJcblx0XHRlID0gMCxcclxuXHRcdGkgPSAwLFxyXG5cdFx0diA9IDBcclxuXHJcblx0Zm9yICggaSA9IDA7IGkgPCB2b3hlbExpc3QubGVuZ3RoOyBpICsrICkge1xyXG5cclxuXHRcdG9iaiA9IHZveGVsTGlzdFsgaSBdXHJcblx0XHRpZiAoICEhIW9iaiApIGNvbnRpbnVlXHJcblx0XHRpZiAoICEhb2JqICAmJiBkaXN0YW5jZTJkQ29tcGFyZSggcG9zaXRpb24sIG9iai5wb3NpdGlvbiwgMjUwMDAwMCApICkgeyBcdC8vIGRvIGNvbGxpc2lvbnMgb24gdm94ZWxzICYgc3RydWN0dXJlcy4uLiBqdXN0IHdhbGxzIGF0IGZpcnN0Li5cclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRpZiAoIG9iai5sb2FkZWQgPT0gdW5kZWZpbmVkICkge1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdG9iai5sb2FkZWQgPSB0cnVlXHJcblx0XHRcdFx0c2VsZi5wb3N0TWVzc2FnZSgne1wiY29tbWFuZFwiOiBcImxvYWQgZW50aXRpZXNcIiwgXCJkYXRhXCI6e1wiY29vcmRzXCI6XCInK29iai5jZWxsWzBdKycuJytvYmouY2VsbFsxXSsnLicrb2JqLmNlbGxbMl0rJ1wifX0nKTtcclxuXHRcdFx0XHRcdFx0XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICggZGlzdGFuY2UyZENvbXBhcmUoIHBvc2l0aW9uLCBvYmoucG9zaXRpb24sIDkwMDAwMCApICkge1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0bGV0IGFsdCA9IG9iai5hbHRpdHVkZSB8fCAwXHJcblx0XHRcdFx0XHJcblx0XHRcdFx0eVBvcyA9IG9iai5wb3NpdGlvblsxXVxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGlmICggZGlzdGFuY2UyZENvbXBhcmUoIHBvc2l0aW9uLCBvYmoucG9zaXRpb24sIDUyODAwMCApICkge1xyXG5cdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdGlmICggcG9zaXRpb25bMV0gPiB5UG9zIC0gMzAwMDAwICsgdnJIZWlnaHQgICYmIHBvc2l0aW9uWzFdIDwgeVBvcyArIDQ1MjAwMCArIHZySGVpZ2h0ICkge1xyXG5cclxuXHRcdFx0XHRcdFx0Y29sbGlzaW9uID0gdHJ1ZVxyXG5cdFx0XHRcdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6IFwicGxhdGZvcm0gY29sbGlzaW9uXCIsIFwiZGF0YVwiOntcInR5cGVcIjpcInRvcFwiLCBcInBvc2l0aW9uXCI6WycgKyBvYmoucG9zaXRpb25bMF0gKyAnLCcgKyAoeVBvcyApICsgJywnICsgb2JqLnBvc2l0aW9uWzJdICsgJ10gfX0nKTtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmICggISFvYmouZW50aXRpZXMgJiYgb2JqLmVudGl0aWVzLmxlbmd0aCA+IDAgKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRlID0gb2JqLmVudGl0aWVzLmxlbmd0aCAtIDFcclxuXHJcblx0XHRcdFx0XHRcdHdoaWxlICggZSA+PSAwICkge1xyXG5cclxuXHRcdFx0XHRcdFx0XHRlbnQgPSBvYmouZW50aXRpZXNbIGUgXVxyXG5cclxuXHRcdFx0XHRcdFx0XHRpZiAoICEhISBlbnQgfHwgISEhZW50LmNvbXBvbmVudHMgKSB7IGNvbnNvbGUud2FybihcIlByb2JsZW0gd2l0aCBlbnRpdHkhIFwiLGUgLGVudCk7IGNvbnRpbnVlIH1cclxuXHJcblx0XHRcdFx0XHRcdFx0aWYgKCBkaXN0YW5jZTNkQ29tcGFyZSggcG9zaXRpb24sIGVudC5wb3NpdGlvbiwgKGVudC5ib3VuZGluZ1JhZGl1c3x8MTAwMDAwKSsxMDAwMCkgKSB7IFxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdGVudC5jb21wb25lbnRzLm1hcCggZW50Q29tcCA9PiB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoIGRpc3RhbmNlM2RDb21wYXJlKCBwb3NpdGlvbiwgZW50Q29tcC5wb3NpdGlvbiwgZW50Q29tcC5ib3VuZGluZ1JhZGl1cyB8fCAyODAwMCkgKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNvbGxpc2lvbiA9IHRydWVcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKCAhISBlbnRDb21wLnByb3BzLmZsb29yICkgeyBcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCBKU09OLnN0cmluZ2lmeSgge2NvbW1hbmQ6IFwiZmxvb3IgY29sbGlzaW9uXCIsIGRhdGE6IHsgXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHBvc2l0aW9uOiBlbnRDb21wLnBvc2l0aW9uLCBcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Zmxvb3JEYXRhOiBlbnRDb21wLnByb3BzLmZsb29yXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9fSkpXHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2VsZi5wb3N0TWVzc2FnZSggSlNPTi5zdHJpbmdpZnkoIHtjb21tYW5kOiBcImVudGl0eS11c2VyIGNvbGxpc2lvblwiLCBkYXRhOnsgcG9zaXRpb246IGVudENvbXAucG9zaXRpb24gfX0gKSApXHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdFx0XHR9KVxyXG5cclxuXHRcdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRcdGUgLS1cclxuXHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHR9XHJcblxyXG5cdFx0fVxyXG5cclxuXHR9XHJcblxyXG5cdGlmICggIWNvbGxpc2lvbiApIHtcclxuXHRcdG9ic2VydmVyLnByZXZQb3MgPSBbIG9ic2VydmVyLnBvc2l0aW9uWzBdLCBvYnNlcnZlci5wb3NpdGlvblsxXSwgb2JzZXJ2ZXIucG9zaXRpb25bMl0gXVxyXG5cdH1cclxuXHJcblx0c2VsZi5wb3N0TWVzc2FnZSgne1wiY29tbWFuZFwiOiBcInVwZGF0ZVwifScpO1xyXG5cdHNlbGYudXBkYXRlTG9vcCA9IHNldFRpbWVvdXQoICgpID0+IHtcclxuXHRcdHNlbGYudXBkYXRlKCk7XHJcblx0fSwgMTUpO1xyXG59XHJcblxyXG5zZWxmLm9ubWVzc2FnZSA9IGZ1bmN0aW9uICggZXZlbnQgKSB7IFxyXG5cclxuXHR2YXIgbWVzc2FnZSA9IEpTT04ucGFyc2UoIGV2ZW50LmRhdGEgKSxcclxuXHRcdGRhdGEgPSBtZXNzYWdlLmRhdGEsXHJcblx0XHR1c2VyID0gb2JzZXJ2ZXIsXHJcblx0XHR2b3hlbCA9IG51bGwsXHJcblx0XHR0b1JlbW92ZSA9IG51bGwsXHJcblx0XHRpdGVtcyA9IFtdLFxyXG5cdFx0ZW50aXRpZXMgPSBbXSxcclxuXHRcdGMgPSAwLFxyXG5cdFx0cCA9IDBcclxuXHRcdFxyXG5cdGlmICggbWVzc2FnZS5jb21tYW5kID09IFwidXBkYXRlXCIgKSB7XHJcblx0XHQvLyB1c2VyLnByZXZQb3MgPSBbdXNlci5wb3NpdGlvblswXSwgdXNlci5wb3NpdGlvblsxXSwgdXNlci5wb3NpdGlvblsyXV07XHJcblx0XHR1c2VyLnBvc2l0aW9uID0gZGF0YS5wb3NpdGlvblxyXG5cdFx0dXNlci52ZWxvY2l0eSA9IGRhdGEudmVsb2NpdHlcclxuXHRcdHVzZXIudnJIZWlnaHQgPSBkYXRhLnZySGVpZ2h0XHJcblx0XHQvL3NlbGYucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkoc2VsZi5vYnNlcnZlcikpO1xyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcImFkZCB2b3hlbHNcIiApIHtcclxuXHJcblx0XHR2b3hlbExpc3QgPSB2b3hlbExpc3QuY29uY2F0KGRhdGEpXHJcblxyXG5cdFx0ZGF0YS5tYXAoIHYgPT4ge1xyXG5cdFx0XHR2b3hlbHNbIHYuY2VsbC5qb2luKFwiLlwiKSBdID0gdlxyXG5cdFx0fSlcclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwicmVtb3ZlIHZveGVsc1wiICkge1xyXG5cclxuXHRcdHAgPSBkYXRhLmxlbmd0aCAtMVxyXG5cclxuXHRcdHdoaWxlICggcCA+PSAwICkge1xyXG5cclxuXHRcdFx0dG9SZW1vdmUgPSBkYXRhW3BdXHJcblx0XHRcdGMgPSB2b3hlbExpc3QubGVuZ3RoLTFcclxuXHJcblx0XHRcdHdoaWxlICggYyA+PSAwICkge1xyXG5cclxuXHRcdFx0XHR2b3hlbCA9IHZveGVsTGlzdFsgYyBdXHJcblxyXG5cdFx0XHRcdGlmICggdm94ZWwgIT0gbnVsbCAmJiB2b3hlbC5jZWxsWzBdID09IHRvUmVtb3ZlLmNlbGxbMF0gJiYgdm94ZWwuY2VsbFsxXSA9PSB0b1JlbW92ZS5jZWxsWzFdICAmJiB2b3hlbC5jZWxsWzJdID09IHRvUmVtb3ZlLmNlbGxbMl0gKSB7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdHZveGVsTGlzdC5zcGxpY2UoIGMsIDEgKVxyXG5cdFx0XHRcdFx0dm94ZWxzWyB2b3hlbC5jZWxsLmpvaW4oXCIuXCIpXSA9IG51bGxcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGMtLVxyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cCAtLVxyXG5cclxuXHRcdH1cclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwiYWRkIGVudGl0eVwiICkge1xyXG5cclxuXHRcdGlmICghISEgdm94ZWxzW2RhdGEuY29vcmRzLmpvaW4oXCIuXCIpXSlcclxuXHJcblx0XHRcdHZveGVsc1tkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKV0gPSB7IGVudGl0aWVzOiBbXSwgY2VsbDogZGF0YS5jb29yZHMgfVxyXG5cclxuXHJcbiAgICBcdGVudGl0aWVzID0gdm94ZWxzW2RhdGEuY29vcmRzLmpvaW4oXCIuXCIpXS5lbnRpdGllc1xyXG5cclxuICAgIFx0ZW50aXRpZXMucHVzaCggZGF0YS5lbnRpdHkgKVxyXG5cclxuICB9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJyZW1vdmUgZW50aXR5XCIgKSB7XHJcblxyXG4gICAgXHRlbnRpdGllcyA9IHZveGVsc1sgZGF0YS5jb29yZHMuam9pbihcIi5cIikgXS5lbnRpdGllc1xyXG5cclxuXHRcdGlmICggZW50aXRpZXMgIT0gbnVsbCApIHtcclxuXHJcblx0XHRcdGMgPSBlbnRpdGllcy5sZW5ndGgtMVxyXG5cclxuXHRcdFx0d2hpbGUgKCBjID49IDAgKSB7XHJcblxyXG5cdFx0XHRcdGlmICggZW50aXRpZXNbY10uaWQgPT0gZGF0YS5lbnRpdHlJZCApIHtcclxuXHJcblx0XHRcdFx0XHR2b3hlbHNbIGRhdGEuY29vcmRzLmpvaW4oXCIuXCIpIF0uZW50aXRpZXMuc3BsaWNlKGMsIDEpXHJcblx0XHRcdFx0XHRjID0gLTFcclxuXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRjLS1cclxuXHJcblx0XHRcdH1cclxuXHJcblx0XHR9XHJcblxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInVwZGF0ZSBlbnRpdHlcIiApIHtcclxuXHJcblx0XHRlbnRpdGllcyA9IHZveGVsc1sgZGF0YS5jb29yZHMuam9pbihcIi5cIikgXS5lbnRpdGllc1xyXG5cclxuXHRcdGlmICggZW50aXRpZXMgIT0gbnVsbCApIHtcclxuXHJcblx0XHRcdGMgPSBlbnRpdGllcy5sZW5ndGgtMVxyXG5cclxuXHRcdFx0d2hpbGUgKCBjID49IDAgKSB7XHJcblxyXG5cdFx0XHRcdGlmIChlbnRpdGllc1sgYyBdLmlkID09IGRhdGEuZW50aXR5SWQpIHtcclxuXHJcblx0XHRcdFx0XHRlbnRpdGllc1sgYyBdID0gZGF0YS5lbnRpdHlcclxuXHRcdFx0XHRcdGMgPSAtMVxyXG5cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGMtLVxyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdH1cclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwiY2xlYXJcIiApIHtcclxuXHJcblx0XHR2b3hlbHMgPSBbXVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJzdGFydFwiICkge1xyXG5cclxuXHRcdHNlbGYudXBkYXRlKClcclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwic3RvcFwiICkge1xyXG5cclxuXHRcdHNlbGYuc3RvcCgpXHJcblxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcImxvZ1wiICkge1xyXG5cclxuXHRcdGlmIChkYXRhID09IFwiXCIpIHtcclxuXHRcdFx0c2VsZi5wb3N0TWVzc2FnZSgne1wiY29tbWFuZFwiOlwibG9nXCIsXCJkYXRhXCI6WycgKyB1c2VyLnBvc2l0aW9uWzBdICsgJywnICsgdXNlci5wb3NpdGlvblsxXSArICcsJyArIHVzZXIucG9zaXRpb25bMl0gKyAnXX0nKTtcclxuXHRcdFx0c2VsZi5wb3N0TWVzc2FnZSgne1wiY29tbWFuZFwiOlwibG9nXCIsXCJkYXRhXCI6JyArIEpTT04uc3RyaW5naWZ5KHZveGVscykrICd9Jyk7XHJcblx0XHR9XHJcblxyXG5cdH1cclxufTtcclxuXHJcbnNlbGYuc3RvcCA9ICgpID0+IHtcclxuXHJcblx0Y2xlYXJUaW1lb3V0KCBzZWxmLnVwZGF0ZUxvb3AgKVxyXG5cclxufVxyXG4iXX0=
