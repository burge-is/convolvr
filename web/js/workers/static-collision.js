(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

/*  static collision detection worker */

var distance2d = function distance2d(a, b) {
	return Math.sqrt(Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2));
},
    distance2dCompare = function distance2dCompare(a, b, n) {
	// more efficient version of distance2d()
	return Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2) < n * n;
},
    distance3dCompare = function distance3dCompare(a, b, n) {
	// ..faster than using Math.sqrt()
	return Math.pow(a[0] - b[0], 2) + Math.pow(a[1] - b[1], 2) + Math.pow(a[2] - b[2], 2) < n * n;
};

var observer = {
	position: [0, 0, 0],
	prevPos: [0, 0, 0],
	velocity: [0, 0, 0],
	vrHeight: 1.66
},
    voxelList = [],
    voxels = [];

self.update = function () {

	var distance = 0,
	    position = observer.position,
	    innerBox = [false, false],
	    velocity = observer.velocity,
	    vrHeight = observer.vrHeight,
	    collision = false,
	    yPos = 0,
	    voxel = null,
	    ent = null,
	    entRadius = 10,
	    structure = null,
	    bounds = [0, 0],
	    voxel = null,
	    delta = [0, 0],
	    oPos = [],
	    speed = 0,
	    e = 0,
	    i = 0,
	    v = 0;

	for (i = 0; i < voxelList.length; i++) {
		voxel = voxelList[i];

		if (!!!voxel || !!!voxel.position) continue;
		if (!!voxel && distance2dCompare(position, voxel.position, 180)) {
			// do collisions on voxels & structures... just walls at first..		
			if (voxel.loaded == undefined) {
				voxel.loaded = true;
				self.postMessage('{"command": "load entities", "data":{"coords":"' + voxel.cell[0] + '.' + voxel.cell[1] + '.' + voxel.cell[2] + '"}}');
			}
			if (distance2dCompare(position, voxel.position, 60)) {

				var alt = voxel.altitude || 0;

				yPos = voxel.position[1];
				if (distance2dCompare(position, voxel.position, 24.5)) {
					if (position[1] > yPos - 21 + vrHeight && position[1] < 14.25 + yPos + (vrHeight != 0 ? vrHeight + 0.25 : 0)) {
						collision = true;
						self.postMessage('{"command": "platform collision", "data":{"type":"top", "position":[' + voxel.position[0] + ',' + yPos + ',' + voxel.position[2] + '] }}');
					}
				}
				if (!!voxel.entities && voxel.entities.length > 0) {
					collision = self.checkStaticCollisions(voxel, position);
				}
			}
		}
	}

	if (!collision) observer.prevPos = [observer.position[0], observer.position[1], observer.position[2]];

	self.postMessage('{"command": "update"}');
	self.updateLoop = setTimeout(function () {
		self.update();
	}, 15);
};

self.checkStaticCollisions = function (voxel, position) {
	var e = voxel.entities.length - 1,
	    ent = null,
	    entRadius = 10,
	    collision = false;

	while (e >= 0) {
		ent = voxel.entities[e];
		entRadius = ent.boundingRadius;
		if (!!!ent || !!!ent.components) {
			console.warn("Problem with entity! ", e, ent);continue;
		}
		if (distance3dCompare(position, [ent.position[0] - entRadius / 2.0, ent.position[1], ent.position[2] - entRadius / 2.0], (entRadius * 1.6 || 3) + 2.5)) {

			ent.components.map(function (entComp) {
				var boundingRadius = entComp.boundingRadius * 1.2 || Math.max(entComp.props.geometry.size[0], entComp.props.geometry.size[2]) * 1.2;

				if (!!entComp.props.floor) {
					var rootPos = ent.position.map(function (v) {
						return v - ent.boundingRadius / 2.0;
					});
					if (distance2dCompare(position, [rootPos[0] + entComp.position[0], 0, rootPos[2] + entComp.position[2]], boundingRadius * 1.7)) {
						var verticalOffset = position[1] + 2 - (entComp.position[1] + ent.position[1]); //  + entComp.geometry ? entComp.geometry.size[1] : 1
						if (verticalOffset > 0 && verticalOffset < 5) {
							self.postMessage(JSON.stringify({
								command: "floor collision", data: {
									position: entComp.position,
									floorData: entComp.props.floor
								}
							}));
							collision = true;
						}
					}
				} else if (distance3dCompare(position, [ent.position[0] + entComp.position[0], ent.position[1] + entComp.position[1], ent.position[2] + entComp.position[2]], boundingRadius)) {
					collision = true;
					self.postMessage(JSON.stringify({ command: "entity-user collision", data: { position: entComp.position } }));
				}
			});
		}
		e -= 1;
	}
	return collision;
};

self.onmessage = function (event) {

	var message = JSON.parse(event.data),
	    data = message.data,
	    user = observer,
	    voxel = null,
	    toRemove = null,
	    items = [],
	    entities = [],
	    c = 0,
	    p = 0;

	if (message.command == "update") {
		// user.prevPos = [user.position[0], user.position[1], user.position[2]];
		user.position = data.position;
		user.velocity = data.velocity;
		user.vrHeight = data.vrHeight;
		//self.postMessage(JSON.stringify(self.observer));
	} else if (message.command == "add voxels") {
		self.addVoxels(message, data);
	} else if (message.command == "remove voxels") {
		self.removeVoxels(message, data);
	} else if (message.command == "add entity") {
		self.addEntity();
	} else if (message.command == "remove entity") {
		self.removeEntity(message, data);
	} else if (message.command == "update entity" || message.command == "update telemetry") {
		if (message.command == "update entity") {
			self.updateEntity(message, data);
		} else {
			self.updateTelemetry(message, data);
		}
	} else if (message.command == "clear") {
		voxels = [];
		voxelList = [];
	} else if (message.command == "start") {
		self.update();
	} else if (message.command == "stop") {
		self.stop();
	} else if (message.command == "log") {
		if (data == "") {
			self.postMessage('{"command":"log","data":[' + user.position[0] + ',' + user.position[1] + ',' + user.position[2] + ']}');
			self.postMessage('{"command":"log","data":' + JSON.stringify(voxels) + '}');
		}
	}
};

self.addVoxels = function (message, data) {
	voxelList = voxelList.concat(data);
	data.map(function (v) {
		voxels[v.cell.join(".")] = v;
	});
};

self.removeVoxels = function (message, data) {
	var toRemove = null,
	    voxel = null,
	    c = 0,
	    p = data.length - 1;

	while (p >= 0) {
		toRemove = data[p];
		c = voxelList.length - 1;

		while (c >= 0) {
			voxel = voxelList[c];
			if (voxel != null && voxel.cell[0] == toRemove.cell[0] && voxel.cell[1] == toRemove.cell[1] && voxel.cell[2] == toRemove.cell[2]) {
				voxelList.splice(c, 1);
				voxels[voxel.cell.join(".")] = null;
			}
			c--;
		}
		p--;
	}
};

self.addEntity = function (message, data) {
	if (!data) {
		console.warn("no data for addEntity");
		return;
	}
	if (!!!voxels[data.coords.join(".")]) {
		voxels[data.coords.join(".")] = { entities: [], cell: data.coords };
	}
	var entities = voxels[data.coords.join(".")].entities;
	entities.push(data.entity);
};

self.removeEntity = function (message, data) {
	var entities = voxels[data.coords.join(".")].entities;
	if (entities != null) {
		var _c = entities.length - 1;

		while (_c >= 0) {
			if (entities[_c].id == data.entityId) {
				voxels[data.coords.join(".")].entities.splice(_c, 1);
				_c = -1;
			}
			_c--;
		}
	}
};

self.updateEntity = function (message, data) {
	var cell = data.coords.join(".");

	if (!data || !data.coords) {
		console.warn("no data to update entity");
		return;
	}
	if (!voxels[cell]) {
		console.warn("can't update entity with no voxel");
		return;
	}
	var entities = voxels[cell].entities;

	if (entities != null) {
		var _c2 = entities.length - 1;
		while (_c2 >= 0) {
			if (entities[_c2].id == data.entityId) {
				entities[_c2] = data.entity;
				_c2 = -1;
			}
			_c2--;
		}
	}
};

self.updateTelemetry = function (message, data) {
	if (!data || !data.coords) {
		console.warn("no data to update entity");
		return;
	}
	var cell = data.coords.join(".");
	if (!voxels[cell]) {
		console.warn("can't update entity with no voxel");
		return;
	}
	var entities = voxels[cell].entities,
	    oldCell = message.data.oldCoords.join("."),
	    oldEntities = voxels[oldCell];

	if (oldCell != cell) {
		c = oldEntities.length - 1;
		while (c >= 0) {
			var movedEnt = oldEntities[c];
			if (movedEnt.id == data.entityId) {
				oldEntities.splice(oldEntities.indedOf(movedEnt), 1);
				entities.push(movedEnt);
				console.log("update telemetry: moved between voxels");
				movedEnt.position = data.position;
				if (data.quaternion) {
					movedEnt.quaternion = data.quaternion;
				}
				c = -1;
			}
		}
	} else {
		if (entities != null) {
			c = entities.length - 1;
			while (c >= 0) {
				if (entities[c].id == data.entityId) {
					console.info("update telemetry");
					entities[c].position = data.position;
					if (data.quaternion) {
						entities[c].quaternion = data.quaternion;
					}
					c = -1;
				}
				c--;
			}
		}
	}
};

self.stop = function () {
	clearTimeout(self.updateLoop);
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvd29ya2Vycy9zdGF0aWMtY29sbGlzaW9ucy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUE7O0FBRUEsSUFBSSxhQUFhLFNBQWIsVUFBYSxDQUFFLENBQUYsRUFBSyxDQUFMLEVBQVk7QUFDekIsUUFBTyxLQUFLLElBQUwsQ0FBVyxLQUFLLEdBQUwsQ0FBVyxFQUFFLENBQUYsSUFBSyxFQUFFLENBQUYsQ0FBaEIsRUFBdUIsQ0FBdkIsSUFBNkIsS0FBSyxHQUFMLENBQVcsRUFBRSxDQUFGLElBQUssRUFBRSxDQUFGLENBQWhCLEVBQXVCLENBQXZCLENBQXhDLENBQVA7QUFDRCxDQUZIO0FBQUEsSUFHRSxvQkFBb0IsU0FBcEIsaUJBQW9CLENBQUUsQ0FBRixFQUFLLENBQUwsRUFBUSxDQUFSLEVBQWU7QUFBRTtBQUNwQyxRQUFPLEtBQUssR0FBTCxDQUFXLEVBQUUsQ0FBRixJQUFLLEVBQUUsQ0FBRixDQUFoQixFQUF1QixDQUF2QixJQUE2QixLQUFLLEdBQUwsQ0FBVyxFQUFFLENBQUYsSUFBSyxFQUFFLENBQUYsQ0FBaEIsRUFBdUIsQ0FBdkIsQ0FBN0IsR0FBMkQsSUFBRSxDQUFwRTtBQUNBLENBTEg7QUFBQSxJQU1FLG9CQUFvQixTQUFwQixpQkFBb0IsQ0FBRSxDQUFGLEVBQUssQ0FBTCxFQUFRLENBQVIsRUFBZTtBQUFFO0FBQ3BDLFFBQVEsS0FBSyxHQUFMLENBQVcsRUFBRSxDQUFGLElBQUssRUFBRSxDQUFGLENBQWhCLEVBQXVCLENBQXZCLElBQTZCLEtBQUssR0FBTCxDQUFXLEVBQUUsQ0FBRixJQUFLLEVBQUUsQ0FBRixDQUFoQixFQUF1QixDQUF2QixDQUE3QixHQUEwRCxLQUFLLEdBQUwsQ0FBVyxFQUFFLENBQUYsSUFBSyxFQUFFLENBQUYsQ0FBaEIsRUFBdUIsQ0FBdkIsQ0FBM0QsR0FBMkYsSUFBRSxDQUFwRztBQUNBLENBUkg7O0FB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QVksT0FBWixDQUFvQixRQUFwQixDQUFuQixFQUFrRCxDQUFsRDtBQUNBLGFBQVMsSUFBVCxDQUFjLFFBQWQ7QUFDQSxZQUFRLEdBQVIsQ0FBWSx3Q0FBWjtBQUNBLGFBQVMsUUFBVCxHQUFvQixLQUFLLFFBQXpCO0FBQ0EsUUFBSSxLQUFLLFVBQVQsRUFBcUI7QUFDcEIsY0FBUyxVQUFULEdBQXNCLEtBQUssVUFBM0I7QUFDQTtBQUNELFFBQUksQ0FBQyxDQUFMO0FBQ0E7QUFDRDtBQUVELEVBaEJELE1BZ0JPO0FBQ04sTUFBSSxZQUFZLElBQWhCLEVBQXNCO0FBQ3JCLE9BQUksU0FBUyxNQUFULEdBQWtCLENBQXRCO0FBQ0EsVUFBTyxLQUFLLENBQVosRUFBZTtBQUNkLFFBQUksU0FBUyxDQUFULEVBQVksRUFBWixJQUFrQixLQUFLLFFBQTNCLEVBQXFDO0FBQ3BDLGFBQVEsSUFBUixDQUFhLGtCQUFiO0FBQ0EsY0FBUyxDQUFULEVBQVksUUFBWixHQUF1QixLQUFLLFFBQTVCO0FBQ0EsU0FBSSxLQUFLLFVBQVQsRUFBcUI7QUFDcEIsZUFBUyxDQUFULEVBQVksVUFBWixHQUF5QixLQUFLLFVBQTlCO0FBQ0E7QUFDRCxTQUFJLENBQUMsQ0FBTDtBQUNBO0FBQ0Q7QUFDQTtBQUNEO0FBQ0Q7QUFDRCxDQTlDRDs7QUFnREEsS0FBSyxJQUFMLEdBQVksWUFBTTtBQUNqQixjQUFjLEtBQUssVUFBbkI7QUFDQSxDQUZEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qICBzdGF0aWMgY29sbGlzaW9uIGRldGVjdGlvbiB3b3JrZXIgKi9cblxubGV0IGRpc3RhbmNlMmQgPSAoIGEsIGIgKSA9PiB7XG4gICAgcmV0dXJuIE1hdGguc3FydCggTWF0aC5wb3coIChhWzBdLWJbMF0pLCAyICkgKyBNYXRoLnBvdyggKGFbMl0tYlsyXSksIDIgKSApXG4gIH0sXG4gIGRpc3RhbmNlMmRDb21wYXJlID0gKCBhLCBiLCBuICkgPT4geyAvLyBtb3JlIGVmZmljaWVudCB2ZXJzaW9uIG9mIGRpc3RhbmNlMmQoKVxuXHQgIHJldHVybiBNYXRoLnBvdyggKGFbMF0tYlswXSksIDIgKSArIE1hdGgucG93KCAoYVsyXS1iWzJdKSwgMiApIDwgKG4qbilcbiAgfSxcbiAgZGlzdGFuY2UzZENvbXBhcmUgPSAoIGEsIGIsIG4gKSA9PiB7IC8vIC4uZmFzdGVyIHRoYW4gdXNpbmcgTWF0aC5zcXJ0KClcblx0ICByZXR1cm4gKE1hdGgucG93KCAoYVswXS1iWzBdKSwgMiApICsgTWF0aC5wb3coIChhWzFdLWJbMV0pLCAyICkgKyBNYXRoLnBvdyggKGFbMl0tYlsyXSksIDIgKSApIDwgKG4qbilcbiAgfVxuXG5sZXQgb2JzZXJ2ZXIgPSB7XG5cdFx0cG9zaXRpb246IFswLCAwLCAwXSxcblx0XHRwcmV2UG9zOiBbMCwgMCwgMF0sXG5cdFx0dmVsb2NpdHk6IFswLCAwLCAwXSxcblx0XHR2ckhlaWdodDogMS42NlxuXHR9LFxuXHR2b3hlbExpc3QgPSBbXSxcblx0dm94ZWxzID0gW11cblxuc2VsZi51cGRhdGUgPSAoICkgPT4ge1xuXG5cdHZhciBkaXN0YW5jZSA9IDAsXG5cdFx0cG9zaXRpb24gXHQgPSBvYnNlcnZlci5wb3NpdGlvbixcblx0XHRpbm5lckJveCBcdCA9IFtmYWxzZSwgZmFsc2VdLFxuXHRcdHZlbG9jaXR5IFx0ID0gb2JzZXJ2ZXIudmVsb2NpdHksXG5cdFx0dnJIZWlnaHQgXHQgPSBvYnNlcnZlci52ckhlaWdodCxcblx0XHRjb2xsaXNpb24gXHQgPSBmYWxzZSxcblx0XHR5UG9zIFx0XHQgPSAwLFxuXHRcdHZveGVsIFx0XHQgPSBudWxsLFxuXHRcdGVudCBcdFx0ID0gbnVsbCxcblx0XHRlbnRSYWRpdXMgICAgPSAxMCxcblx0XHRzdHJ1Y3R1cmUgXHQgPSBudWxsLFxuXHRcdGJvdW5kcyBcdFx0ID0gWzAsIDBdLFxuXHRcdHZveGVsIFx0XHQgPSBudWxsLFxuXHRcdGRlbHRhIFx0XHQgPSBbMCwgMF0sXG5cdFx0b1BvcyBcdFx0ID0gW10sXG5cdFx0c3BlZWQgXHRcdCA9IDAsXG5cdFx0ZSBcdFx0XHQgPSAwLFxuXHRcdGkgXHRcdFx0ID0gMCxcblx0XHR2IFx0XHRcdCA9IDBcblxuXHRmb3IgKCBpID0gMDsgaSA8IHZveGVsTGlzdC5sZW5ndGg7IGkgKysgKSB7XG5cdFx0dm94ZWwgPSB2b3hlbExpc3RbIGkgXVxuXG5cdFx0aWYgKCAhISF2b3hlbCB8fCAhISF2b3hlbC5wb3NpdGlvbikgY29udGludWVcblx0XHRpZiAoICEhdm94ZWwgJiYgZGlzdGFuY2UyZENvbXBhcmUoIHBvc2l0aW9uLCB2b3hlbC5wb3NpdGlvbiwgMTgwICkgKSB7IFx0Ly8gZG8gY29sbGlzaW9ucyBvbiB2b3hlbHMgJiBzdHJ1Y3R1cmVzLi4uIGp1c3Qgd2FsbHMgYXQgZmlyc3QuLlx0XHRcblx0XHRcdGlmICggdm94ZWwubG9hZGVkID09IHVuZGVmaW5lZCApIHtcblx0XHRcdFx0dm94ZWwubG9hZGVkID0gdHJ1ZVxuXHRcdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6IFwibG9hZCBlbnRpdGllc1wiLCBcImRhdGFcIjp7XCJjb29yZHNcIjpcIicrdm94ZWwuY2VsbFswXSsnLicrdm94ZWwuY2VsbFsxXSsnLicrdm94ZWwuY2VsbFsyXSsnXCJ9fScpO1xuXHRcdFx0fVxuXHRcdFx0aWYgKCBkaXN0YW5jZTJkQ29tcGFyZSggcG9zaXRpb24sIHZveGVsLnBvc2l0aW9uLCA2MCApICkge1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRsZXQgYWx0ID0gdm94ZWwuYWx0aXR1ZGUgfHwgMFxuXHRcdFx0XHRcblx0XHRcdFx0eVBvcyA9IHZveGVsLnBvc2l0aW9uWzFdXG5cdFx0XHRcdGlmICggZGlzdGFuY2UyZENvbXBhcmUoIHBvc2l0aW9uLCB2b3hlbC5wb3NpdGlvbiwgMjQuNSApICkge1xuXHRcdFx0XHRcdGlmICggcG9zaXRpb25bMV0gPiB5UG9zIC0gMjEgKyB2ckhlaWdodCAgJiYgcG9zaXRpb25bMV0gPCAxNC4yNSt5UG9zICsgKHZySGVpZ2h0ICE9IDAgPyB2ckhlaWdodCswLjI1IDogMCkgKSB7XG5cdFx0XHRcdFx0XHRjb2xsaXNpb24gPSB0cnVlXG5cdFx0XHRcdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6IFwicGxhdGZvcm0gY29sbGlzaW9uXCIsIFwiZGF0YVwiOntcInR5cGVcIjpcInRvcFwiLCBcInBvc2l0aW9uXCI6WycgKyB2b3hlbC5wb3NpdGlvblswXSArICcsJyArIHlQb3MgKyAnLCcgKyB2b3hlbC5wb3NpdGlvblsyXSArICddIH19Jyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XHRcblx0XHRcdFx0aWYgKCAhIXZveGVsLmVudGl0aWVzICYmIHZveGVsLmVudGl0aWVzLmxlbmd0aCA+IDAgKSB7XG5cdFx0XHRcdFx0Y29sbGlzaW9uID0gc2VsZi5jaGVja1N0YXRpY0NvbGxpc2lvbnMoIHZveGVsLCBwb3NpdGlvbiApXG5cdFx0XHRcdH1cdFxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmICggIWNvbGxpc2lvbiApXG5cdFx0b2JzZXJ2ZXIucHJldlBvcyA9IFsgb2JzZXJ2ZXIucG9zaXRpb25bMF0sIG9ic2VydmVyLnBvc2l0aW9uWzFdLCBvYnNlcnZlci5wb3NpdGlvblsyXSBdXG5cdFxuXHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6IFwidXBkYXRlXCJ9Jylcblx0c2VsZi51cGRhdGVMb29wID0gc2V0VGltZW91dCggKCkgPT4ge1xuXHRcdHNlbGYudXBkYXRlKClcblx0fSwgMTUpXG59XG5cbnNlbGYuY2hlY2tTdGF0aWNDb2xsaXNpb25zID0gKCB2b3hlbCwgcG9zaXRpb24gKSA9PiB7XG5cdGxldCBlID0gdm94ZWwuZW50aXRpZXMubGVuZ3RoIC0gMSxcblx0XHRlbnQgPSBudWxsLFxuXHRcdGVudFJhZGl1cyA9IDEwLFxuXHRcdGNvbGxpc2lvbiA9IGZhbHNlXG5cblx0d2hpbGUgKGUgPj0gMCkge1xuXHRcdGVudCA9IHZveGVsLmVudGl0aWVzW2VdXG5cdFx0ZW50UmFkaXVzID0gZW50LmJvdW5kaW5nUmFkaXVzXG5cdFx0aWYgKCEhIWVudCB8fCAhISFlbnQuY29tcG9uZW50cykge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiUHJvYmxlbSB3aXRoIGVudGl0eSEgXCIsIGUsIGVudCk7IGNvbnRpbnVlXG5cdFx0fVxuXHRcdGlmIChkaXN0YW5jZTNkQ29tcGFyZShcblx0XHRcdHBvc2l0aW9uLFxuXHRcdFx0W2VudC5wb3NpdGlvblswXSAtIGVudFJhZGl1cy8yLjAsIGVudC5wb3NpdGlvblsxXSxcblx0XHRcdGVudC5wb3NpdGlvblsyXSAtIGVudFJhZGl1cy8yLjBdLCAoZW50UmFkaXVzICogMS42IHx8IDMpICsgMi41XG5cdFx0KSkge1xuXG5cdFx0XHRlbnQuY29tcG9uZW50cy5tYXAoZW50Q29tcCA9PiB7XG5cdFx0XHRcdGxldCBib3VuZGluZ1JhZGl1cyA9IGVudENvbXAuYm91bmRpbmdSYWRpdXMgKiAxLjIgfHxcblx0XHRcdFx0ICAgIE1hdGgubWF4KGVudENvbXAucHJvcHMuZ2VvbWV0cnkuc2l6ZVswXSwgZW50Q29tcC5wcm9wcy5nZW9tZXRyeS5zaXplWzJdKSAqIDEuMlxuXG5cdFx0XHRcdGlmICghIWVudENvbXAucHJvcHMuZmxvb3IpIHtcblx0XHRcdFx0XHRsZXQgcm9vdFBvcyA9IGVudC5wb3NpdGlvbi5tYXAoIHYgPT4gdi1lbnQuYm91bmRpbmdSYWRpdXMgLyAyLjAgKVxuXHRcdFx0XHRcdGlmIChkaXN0YW5jZTJkQ29tcGFyZShcblx0XHRcdFx0XHRcdHBvc2l0aW9uLFxuXHRcdFx0XHRcdFx0W3Jvb3RQb3NbMF0gKyBlbnRDb21wLnBvc2l0aW9uWzBdLCAwLCByb290UG9zWzJdICsgZW50Q29tcC5wb3NpdGlvblsyXV0sXG5cdFx0XHRcdFx0XHRib3VuZGluZ1JhZGl1cyAqIDEuN1xuXHRcdFx0XHRcdCkpIHtcblx0XHRcdFx0XHRcdGxldCB2ZXJ0aWNhbE9mZnNldCA9IChwb3NpdGlvblsxXSArIDIgLSAoZW50Q29tcC5wb3NpdGlvblsxXSArIGVudC5wb3NpdGlvblsxXSApKSAvLyAgKyBlbnRDb21wLmdlb21ldHJ5ID8gZW50Q29tcC5nZW9tZXRyeS5zaXplWzFdIDogMVxuXHRcdFx0XHRcdFx0aWYgKHZlcnRpY2FsT2Zmc2V0ID4gMCAmJiB2ZXJ0aWNhbE9mZnNldCA8IDUpIHtcblx0XHRcdFx0XHRcdFx0c2VsZi5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeSh7XG5cdFx0XHRcdFx0XHRcdFx0Y29tbWFuZDogXCJmbG9vciBjb2xsaXNpb25cIiwgZGF0YToge1xuXHRcdFx0XHRcdFx0XHRcdFx0cG9zaXRpb246IGVudENvbXAucG9zaXRpb24sXG5cdFx0XHRcdFx0XHRcdFx0XHRmbG9vckRhdGE6IGVudENvbXAucHJvcHMuZmxvb3Jcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pKVxuXHRcdFx0XHRcdFx0XHRjb2xsaXNpb24gPSB0cnVlXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2UgaWYgKGRpc3RhbmNlM2RDb21wYXJlKFxuXHRcdFx0XHRcdHBvc2l0aW9uLFxuXHRcdFx0XHRcdFtlbnQucG9zaXRpb25bMF0gKyBlbnRDb21wLnBvc2l0aW9uWzBdLCBlbnQucG9zaXRpb25bMV0gKyBlbnRDb21wLnBvc2l0aW9uWzFdLCBlbnQucG9zaXRpb25bMl0gKyBlbnRDb21wLnBvc2l0aW9uWzJdXSxcblx0XHRcdFx0XHRib3VuZGluZ1JhZGl1c1xuXHRcdFx0XHQpKSB7XG5cdFx0XHRcdFx0Y29sbGlzaW9uID0gdHJ1ZVxuXHRcdFx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkoeyBjb21tYW5kOiBcImVudGl0eS11c2VyIGNvbGxpc2lvblwiLCBkYXRhOiB7IHBvc2l0aW9uOiBlbnRDb21wLnBvc2l0aW9uIH0gfSkpXG5cdFx0XHRcdH1cblxuXHRcdFx0fSlcblx0XHR9XG5cdFx0ZSAtPSAxXG5cdH1cblx0cmV0dXJuIGNvbGxpc2lvblxufVxuXG5zZWxmLm9ubWVzc2FnZSA9ICggZXZlbnQgKSA9PiB7IFxuXG5cdHZhciBtZXNzYWdlICA9IEpTT04ucGFyc2UoIGV2ZW50LmRhdGEgKSxcblx0XHRkYXRhIFx0ID0gbWVzc2FnZS5kYXRhLFxuXHRcdHVzZXIgXHQgPSBvYnNlcnZlcixcblx0XHR2b3hlbCBcdCA9IG51bGwsXG5cdFx0dG9SZW1vdmUgPSBudWxsLFxuXHRcdGl0ZW1zIFx0ID0gW10sXG5cdFx0ZW50aXRpZXMgPSBbXSxcblx0XHRjIFx0XHQgPSAwLFxuXHRcdHAgXHRcdCA9IDBcblx0XHRcblx0aWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJ1cGRhdGVcIiApIHtcblx0XHQvLyB1c2VyLnByZXZQb3MgPSBbdXNlci5wb3NpdGlvblswXSwgdXNlci5wb3NpdGlvblsxXSwgdXNlci5wb3NpdGlvblsyXV07XG5cdFx0dXNlci5wb3NpdGlvbiA9IGRhdGEucG9zaXRpb25cblx0XHR1c2VyLnZlbG9jaXR5ID0gZGF0YS52ZWxvY2l0eVxuXHRcdHVzZXIudnJIZWlnaHQgPSBkYXRhLnZySGVpZ2h0XG5cdFx0Ly9zZWxmLnBvc3RNZXNzYWdlKEpTT04uc3RyaW5naWZ5KHNlbGYub2JzZXJ2ZXIpKTtcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwiYWRkIHZveGVsc1wiICkge1xuXHRcdHNlbGYuYWRkVm94ZWxzKCBtZXNzYWdlLCBkYXRhIClcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwicmVtb3ZlIHZveGVsc1wiICkge1xuXHRcdHNlbGYucmVtb3ZlVm94ZWxzKCBtZXNzYWdlLCBkYXRhIClcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwiYWRkIGVudGl0eVwiICkge1xuXHRcdHNlbGYuYWRkRW50aXR5KClcbiAgXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJyZW1vdmUgZW50aXR5XCIgKSB7XG4gICAgXHRzZWxmLnJlbW92ZUVudGl0eSggbWVzc2FnZSwgZGF0YSApXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInVwZGF0ZSBlbnRpdHlcIiB8fCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJ1cGRhdGUgdGVsZW1ldHJ5XCIgKSB7XG5cdFx0aWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJ1cGRhdGUgZW50aXR5XCIgKSB7XG5cdFx0XHRzZWxmLnVwZGF0ZUVudGl0eSggbWVzc2FnZSwgZGF0YSApXG5cdFx0fSBlbHNlIHtcblx0XHRcdHNlbGYudXBkYXRlVGVsZW1ldHJ5KCBtZXNzYWdlLCBkYXRhIClcblx0XHR9XG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcImNsZWFyXCIgKSB7XG5cdFx0dm94ZWxzID0gW11cblx0XHR2b3hlbExpc3QgPSBbXVxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJzdGFydFwiICkge1xuXHRcdHNlbGYudXBkYXRlKClcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwic3RvcFwiICkge1xuXHRcdHNlbGYuc3RvcCgpXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcImxvZ1wiICkge1xuXHRcdGlmIChkYXRhID09IFwiXCIpIHtcblx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoJ3tcImNvbW1hbmRcIjpcImxvZ1wiLFwiZGF0YVwiOlsnICsgdXNlci5wb3NpdGlvblswXSArICcsJyArIHVzZXIucG9zaXRpb25bMV0gKyAnLCcgKyB1c2VyLnBvc2l0aW9uWzJdICsgJ119Jyk7XG5cdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6XCJsb2dcIixcImRhdGFcIjonICsgSlNPTi5zdHJpbmdpZnkodm94ZWxzKSsgJ30nKTtcblx0XHR9XG5cdH1cbn07XG5cbnNlbGYuYWRkVm94ZWxzID0gKCBtZXNzYWdlLCBkYXRhICkgPT4ge1xuXHR2b3hlbExpc3QgPSB2b3hlbExpc3QuY29uY2F0KGRhdGEpXG5cdGRhdGEubWFwKCB2ID0+IHtcblx0XHR2b3hlbHNbIHYuY2VsbC5qb2luKFwiLlwiKSBdID0gdlxuXHR9KVxufVxuXG5zZWxmLnJlbW92ZVZveGVscyA9ICggbWVzc2FnZSwgZGF0YSApID0+IHtcblx0bGV0IHRvUmVtb3ZlID0gbnVsbCxcblx0XHR2b3hlbCA9IG51bGwsXG5cdFx0YyBcdFx0ID0gMCxcblx0XHRwIFx0XHQgPSBkYXRhLmxlbmd0aCAtMVxuXHRcblx0d2hpbGUgKCBwID49IDAgKSB7XG5cdFx0dG9SZW1vdmUgPSBkYXRhW3BdXG5cdFx0YyA9IHZveGVsTGlzdC5sZW5ndGgtMVxuXHRcdFxuXHRcdHdoaWxlICggYyA+PSAwICkge1xuXHRcdFx0dm94ZWwgPSB2b3hlbExpc3RbIGMgXVxuXHRcdFx0aWYgKCB2b3hlbCAhPSBudWxsICYmIHZveGVsLmNlbGxbMF0gPT0gdG9SZW1vdmUuY2VsbFswXSAmJiB2b3hlbC5jZWxsWzFdID09IHRvUmVtb3ZlLmNlbGxbMV0gIFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCYmIHZveGVsLmNlbGxbMl0gPT0gdG9SZW1vdmUuY2VsbFsyXSApIHtcdFxuXHRcdFx0XHR2b3hlbExpc3Quc3BsaWNlKCBjLCAxIClcblx0XHRcdFx0dm94ZWxzWyB2b3hlbC5jZWxsLmpvaW4oXCIuXCIpXSA9IG51bGxcblx0XHRcdH1cblx0XHRcdGMtLVxuXHRcdH1cblx0XHRwIC0tXG5cdH1cbn1cblxuc2VsZi5hZGRFbnRpdHkgPSAoIG1lc3NhZ2UsIGRhdGEgKSA9PiB7XG5cdGlmICghZGF0YSkge1xuXHRcdGNvbnNvbGUud2FybihcIm5vIGRhdGEgZm9yIGFkZEVudGl0eVwiKVxuXHRcdHJldHVyblxuXHR9XG5cdGlmICghISEgdm94ZWxzW2RhdGEuY29vcmRzLmpvaW4oXCIuXCIpXSkge1xuXHRcdHZveGVsc1tkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKV0gPSB7IGVudGl0aWVzOiBbXSwgY2VsbDogZGF0YS5jb29yZHMgfVxuXHR9XG5cdGxldCBlbnRpdGllcyA9IHZveGVsc1tkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKV0uZW50aXRpZXNcblx0ZW50aXRpZXMucHVzaCggZGF0YS5lbnRpdHkgKVxufVxuXG5zZWxmLnJlbW92ZUVudGl0eSA9ICggbWVzc2FnZSwgZGF0YSApID0+IHtcblx0bGV0IGVudGl0aWVzID0gdm94ZWxzWyBkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKSBdLmVudGl0aWVzXG5cdGlmICggZW50aXRpZXMgIT0gbnVsbCApIHtcblx0XHRsZXQgYyA9IGVudGl0aWVzLmxlbmd0aC0xXG5cdFx0XG5cdFx0d2hpbGUgKCBjID49IDAgKSB7XG5cdFx0XHRpZiAoIGVudGl0aWVzW2NdLmlkID09IGRhdGEuZW50aXR5SWQgKSB7XG5cdFx0XHRcdHZveGVsc1sgZGF0YS5jb29yZHMuam9pbihcIi5cIikgXS5lbnRpdGllcy5zcGxpY2UoYywgMSlcblx0XHRcdFx0YyA9IC0xXG5cdFx0XHR9XG5cdFx0XHRjLS1cblx0XHR9XG5cdH1cbn1cblxuc2VsZi51cGRhdGVFbnRpdHkgPSAoIG1lc3NhZ2UsIGRhdGEgKSA9PiB7XG5cdGxldCBjZWxsID0gIGRhdGEuY29vcmRzLmpvaW4oXCIuXCIpXG5cblx0aWYgKCFkYXRhIHx8ICFkYXRhLmNvb3Jkcykge1xuXHRcdGNvbnNvbGUud2FybihcIm5vIGRhdGEgdG8gdXBkYXRlIGVudGl0eVwiKVxuXHRcdHJldHVyblxuXHR9XG5cdGlmICggIXZveGVsc1tjZWxsXSApIHtcblx0XHRjb25zb2xlLndhcm4oXCJjYW4ndCB1cGRhdGUgZW50aXR5IHdpdGggbm8gdm94ZWxcIilcblx0XHRyZXR1cm5cblx0fVxuXHRsZXQgZW50aXRpZXMgPSB2b3hlbHNbIGNlbGwgXS5lbnRpdGllc1xuXG5cdGlmICggZW50aXRpZXMgIT0gbnVsbCApIHtcblx0XHRsZXQgYyA9IGVudGl0aWVzLmxlbmd0aC0xXG5cdFx0d2hpbGUgKCBjID49IDAgKSB7XG5cdFx0XHRpZiAoZW50aXRpZXNbIGMgXS5pZCA9PSBkYXRhLmVudGl0eUlkKSB7XG5cdFx0XHRcdGVudGl0aWVzWyBjIF0gPSBkYXRhLmVudGl0eVx0XHRcdFxuXHRcdFx0XHRjID0gLTFcblx0XHRcdH1cblx0XHRcdGMtLVxuXHRcdH1cblx0fVxufVxuXG5zZWxmLnVwZGF0ZVRlbGVtZXRyeSA9ICggbWVzc2FnZSwgZGF0YSApID0+IHtcblx0aWYgKCFkYXRhIHx8ICFkYXRhLmNvb3Jkcykge1xuXHRcdGNvbnNvbGUud2FybihcIm5vIGRhdGEgdG8gdXBkYXRlIGVudGl0eVwiKVxuXHRcdHJldHVyblxuXHR9XG5cdGxldCBjZWxsID0gIGRhdGEuY29vcmRzLmpvaW4oXCIuXCIpXG5cdGlmICggIXZveGVsc1tjZWxsXSApIHtcblx0XHRjb25zb2xlLndhcm4oXCJjYW4ndCB1cGRhdGUgZW50aXR5IHdpdGggbm8gdm94ZWxcIilcblx0XHRyZXR1cm5cblx0fVxuXHRsZXQgZW50aXRpZXMgPSB2b3hlbHNbIGNlbGwgXS5lbnRpdGllcyxcblx0XHRvbGRDZWxsID0gbWVzc2FnZS5kYXRhLm9sZENvb3Jkcy5qb2luKFwiLlwiKSxcblx0XHRvbGRFbnRpdGllcyA9IHZveGVsc1tvbGRDZWxsXTtcblxuXHRpZiAob2xkQ2VsbCAhPSBjZWxsKSB7XG5cdFx0YyA9IG9sZEVudGl0aWVzLmxlbmd0aCAtIDFcblx0XHR3aGlsZSAoYyA+PSAwKSB7XG5cdFx0XHRsZXQgbW92ZWRFbnQgPSBvbGRFbnRpdGllc1tjXVxuXHRcdFx0aWYgKG1vdmVkRW50LmlkID09IGRhdGEuZW50aXR5SWQpIHtcblx0XHRcdFx0b2xkRW50aXRpZXMuc3BsaWNlKG9sZEVudGl0aWVzLmluZGVkT2YobW92ZWRFbnQpLCAxKVxuXHRcdFx0XHRlbnRpdGllcy5wdXNoKG1vdmVkRW50KVxuXHRcdFx0XHRjb25zb2xlLmxvZyhcInVwZGF0ZSB0ZWxlbWV0cnk6IG1vdmVkIGJldHdlZW4gdm94ZWxzXCIpXG5cdFx0XHRcdG1vdmVkRW50LnBvc2l0aW9uID0gZGF0YS5wb3NpdGlvblxuXHRcdFx0XHRpZiAoZGF0YS5xdWF0ZXJuaW9uKSB7XG5cdFx0XHRcdFx0bW92ZWRFbnQucXVhdGVybmlvbiA9IGRhdGEucXVhdGVybmlvbjtcblx0XHRcdFx0fVxuXHRcdFx0XHRjID0gLTFcblx0XHRcdH1cblx0XHR9XG5cblx0fSBlbHNlIHtcblx0XHRpZiAoZW50aXRpZXMgIT0gbnVsbCkge1xuXHRcdFx0YyA9IGVudGl0aWVzLmxlbmd0aCAtIDFcblx0XHRcdHdoaWxlIChjID49IDApIHtcblx0XHRcdFx0aWYgKGVudGl0aWVzW2NdLmlkID09IGRhdGEuZW50aXR5SWQpIHtcblx0XHRcdFx0XHRjb25zb2xlLmluZm8oXCJ1cGRhdGUgdGVsZW1ldHJ5XCIpXG5cdFx0XHRcdFx0ZW50aXRpZXNbY10ucG9zaXRpb24gPSBkYXRhLnBvc2l0aW9uXG5cdFx0XHRcdFx0aWYgKGRhdGEucXVhdGVybmlvbikge1xuXHRcdFx0XHRcdFx0ZW50aXRpZXNbY10ucXVhdGVybmlvbiA9IGRhdGEucXVhdGVybmlvbjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YyA9IC0xXG5cdFx0XHRcdH1cblx0XHRcdFx0Yy0tXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG59XG5cbnNlbGYuc3RvcCA9ICgpID0+IHtcblx0Y2xlYXJUaW1lb3V0KCBzZWxmLnVwZGF0ZUxvb3AgKVxufVxuIl19
