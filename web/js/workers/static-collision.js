(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

/*  static collision detection worker */

var distance2d = function distance2d(a, b) {
	return Math.sqrt(Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2));
},
    distance2dCompare = function distance2dCompare(a, b, n) {
	// more efficient version of distance2d()
	return Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2) < n * n;
},
    distance3dCompare = function distance3dCompare(a, b, n) {
	// ..faster than using Math.sqrt()
	return Math.pow(a[0] - b[0], 2) + Math.pow(a[1] - b[1], 2) + Math.pow(a[2] - b[2], 2) < n * n;
};

var observer = {
	position: [0, 0, 0],
	prevPos: [0, 0, 0],
	velocity: [0, 0, 0],
	vrHeight: 0
},
    voxelList = [],
    voxels = [];

self.update = function () {

	var distance = 0,
	    position = observer.position,
	    innerBox = [false, false],
	    velocity = observer.velocity,
	    vrHeight = observer.vrHeight,
	    closeToVenue = false,
	    collision = false,
	    yPos = 0,
	    voxel = null,
	    ent = null,
	    entRadius = 10,
	    structure = null,
	    bounds = [0, 0],
	    voxel = null,
	    delta = [0, 0],
	    oPos = [],
	    speed = 0,
	    e = 0,
	    i = 0,
	    v = 0;

	for (i = 0; i < voxelList.length; i++) {
		voxel = voxelList[i];

		if (!!!voxel || !!!voxel.position) continue;

		if (!!voxel && distance2dCompare(position, voxel.position, 180)) {
			// do collisions on voxels & structures... just walls at first..		
			if (voxel.loaded == undefined) {
				voxel.loaded = true;
				self.postMessage('{"command": "load entities", "data":{"coords":"' + voxel.cell[0] + '.' + voxel.cell[1] + '.' + voxel.cell[2] + '"}}');
			}

			if (distance2dCompare(position, voxel.position, 60)) {

				var alt = voxel.altitude || 0;

				yPos = voxel.position[1];

				if (distance2dCompare(position, voxel.position, 24.5)) {
					if (position[1] > yPos - 21 + vrHeight && position[1] < yPos + 14.25 + (vrHeight != 0 ? vrHeight - 1 : 0)) {
						collision = true;
						self.postMessage('{"command": "platform collision", "data":{"type":"top", "position":[' + voxel.position[0] + ',' + yPos + ',' + voxel.position[2] + '] }}');
					}
				}
				if (!!voxel.entities && voxel.entities.length > 0) {
					e = voxel.entities.length - 1;

					while (e >= 0) {
						ent = voxel.entities[e];
						entRadius = ent.boundingRadius;

						if (!!!ent || !!!ent.components) {
							console.warn("Problem with entity! ", e, ent);continue;
						}
						if (distance3dCompare(position, [ent.position[0] - entRadius, ent.position[1], ent.position[2] - entRadius], (entRadius * 1.6 || 3) + 2.5)) {
							ent.components.map(function (entComp) {
								var boundingRadius = entComp.boundingRadius * 1.2 || Math.max(entComp.props.geometry.size[0], entComp.props.geometry.size[2]) * 1.4;
								if (distance2dCompare(position, [ent.position[0] + entComp.position[0], 0, ent.position[2] + entComp.position[2]], boundingRadius * 1.5)) {
									if (!!entComp.props.floor) {
										var verticalOffset = position[1] + 2 - (entComp.position[1] + ent.position[1]);
										if (verticalOffset > 0 && verticalOffset < 5) {
											self.postMessage(JSON.stringify({ command: "floor collision", data: {
													position: entComp.position,
													floorData: entComp.props.floor
												} }));
											collision = true;
										}
									} else if (distance3dCompare(position, [ent.position[0] + entComp.position[0], ent.position[1] + entComp.position[1], ent.position[2] + entComp.position[2]], boundingRadius)) {
										collision = true;
										self.postMessage(JSON.stringify({ command: "entity-user collision", data: { position: entComp.position } }));
									}
								}
							});
						}
						e -= 1;
					}
				}
			}
		}
	}

	if (!collision) observer.prevPos = [observer.position[0], observer.position[1], observer.position[2]];

	self.postMessage('{"command": "update"}');
	self.updateLoop = setTimeout(function () {
		self.update();
	}, 15);
};

self.onmessage = function (event) {

	var message = JSON.parse(event.data),
	    data = message.data,
	    user = observer,
	    voxel = null,
	    toRemove = null,
	    items = [],
	    entities = [],
	    c = 0,
	    p = 0;

	if (message.command == "update") {
		// user.prevPos = [user.position[0], user.position[1], user.position[2]];
		user.position = data.position;
		user.velocity = data.velocity;
		user.vrHeight = data.vrHeight;
		//self.postMessage(JSON.stringify(self.observer));
	} else if (message.command == "add voxels") {

		voxelList = voxelList.concat(data);
		data.map(function (v) {
			voxels[v.cell.join(".")] = v;
		});
	} else if (message.command == "remove voxels") {

		p = data.length - 1;

		while (p >= 0) {

			toRemove = data[p];
			c = voxelList.length - 1;

			while (c >= 0) {

				voxel = voxelList[c];
				if (voxel != null && voxel.cell[0] == toRemove.cell[0] && voxel.cell[1] == toRemove.cell[1] && voxel.cell[2] == toRemove.cell[2]) {
					voxelList.splice(c, 1);
					voxels[voxel.cell.join(".")] = null;
				}
				c--;
			}
			p--;
		}
	} else if (message.command == "add entity") {

		if (!!!voxels[data.coords.join(".")]) voxels[data.coords.join(".")] = { entities: [], cell: data.coords };

		entities = voxels[data.coords.join(".")].entities;
		entities.push(data.entity);
	} else if (message.command == "remove entity") {

		entities = voxels[data.coords.join(".")].entities;

		if (entities != null) {

			c = entities.length - 1;
			while (c >= 0) {
				if (entities[c].id == data.entityId) {
					voxels[data.coords.join(".")].entities.splice(c, 1);
					c = -1;
				}
				c--;
			}
		}
	} else if (message.command == "update entity") {

		entities = voxels[data.coords.join(".")].entities;

		if (entities != null) {
			c = entities.length - 1;

			while (c >= 0) {
				if (entities[c].id == data.entityId) {
					entities[c] = data.entity;
					c = -1;
				}
				c--;
			}
		}
	} else if (message.command == "clear") {

		voxels = [];
		voxelList = [];
	} else if (message.command == "start") {

		self.update();
	} else if (message.command == "stop") {

		self.stop();
	} else if (message.command == "log") {
		if (data == "") {
			self.postMessage('{"command":"log","data":[' + user.position[0] + ',' + user.position[1] + ',' + user.position[2] + ']}');
			self.postMessage('{"command":"log","data":' + JSON.stringify(voxels) + '}');
		}
	}
};

self.stop = function () {
	clearTimeout(self.updateLoop);
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmNcXHdvcmtlcnNcXHN0YXRpYy1jb2xsaXNpb25zLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQTs7QUFFQSxJQUFJLGFBQWEsU0FBYixVQUFhLENBQUUsQ0FBRixFQUFLLENBQUwsRUFBWTtBQUN6QixRQUFPLEtBQUssSUFBTCxDQUFXLEtBQUssR0FBTCxDQUFXLEVBQUUsQ0FBRixJQUFLLEVBQUUsQ0FBRixDQUFoQixFQUF1QixDQUF2QixJQUE2QixLQUFLLEdBQUwsQ0FBVyxFQUFFLENBQUYsSUFBSyxFQUFFLENBQUYsQ0FBaEIsRUFBdUIsQ0FBdkIsQ0FBeEMsQ0FBUDtBQUNELENBRkg7QUFBQSxJQUdFLG9CQUFvQixTQUFwQixpQkFBb0IsQ0FBRSxDQUFGLEVBQUssQ0FBTCxFQUFRLENBQVIsRUFBZTtBQUFFO0FBQ3BDLFFBQU8sS0FBSyxHQUFMLENBQVcsRUFBRSxDQUFGLElBQUssRUFBRSxDQUFGLENBQWhCLEVBQXVCLENBQXZCLElBQTZCLEtBQUssR0FBTCxDQUFXLEVBQUUsQ0FBRixJQUFLLEVBQUUsQ0FBRixDQUFoQixFQUF1QixDQUF2QixDQUE3QixHQUEyRCxJQUFFLENBQXBFO0FBQ0EsQ0FMSDtBQUFBLElBTUUsb0JBQW9CLFNBQXBCLGlCQUFvQixDQUFFLENBQUYsRUFBSyxDQUFMLEVBQVEsQ0FBUixFQUFlO0FBQUU7QUFDcEMsUUFBUSxLQUFLLEdBQUwsQ0FBVyxFQUFFLENBQUYsSUFBSyxFQUFFLENBQUYsQ0FBaEIsRUFBdUIsQ0FBdkIsSUFBNkIsS0FBSyxHQUFMLENBQVcsRUFBRSxDQUFGLElBQUssRUFBRSxDQUFGLENBQWhCLEVBQXVCLENBQXZCLENBQTdCLEdBQTBELEtBQUssR0FBTCxDQUFXLEVBQUUsQ0FBRixJQUFLLEVBQUUsQ0FBRixDQUFoQixFQUF1QixDQUF2QixDQUEzRCxHQUEyRixJQUFFLENBQXBHO0FBQ0EsQ0FSSDs7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aUIsNkJBQTZCLEtBQUssU0FBTCxDQUFlLE1BQWYsQ0FBN0IsR0FBcUQsR0FBdEU7QUFDQTtBQUNEO0FBQ0QsQ0F6R0Q7O0FBMkdBLEtBQUssSUFBTCxHQUFZLFlBQU07QUFDakIsY0FBYyxLQUFLLFVBQW5CO0FBQ0EsQ0FGRCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKiAgc3RhdGljIGNvbGxpc2lvbiBkZXRlY3Rpb24gd29ya2VyICovXHJcblxyXG5sZXQgZGlzdGFuY2UyZCA9ICggYSwgYiApID0+IHtcclxuICAgIHJldHVybiBNYXRoLnNxcnQoIE1hdGgucG93KCAoYVswXS1iWzBdKSwgMiApICsgTWF0aC5wb3coIChhWzJdLWJbMl0pLCAyICkgKVxyXG4gIH0sXHJcbiAgZGlzdGFuY2UyZENvbXBhcmUgPSAoIGEsIGIsIG4gKSA9PiB7IC8vIG1vcmUgZWZmaWNpZW50IHZlcnNpb24gb2YgZGlzdGFuY2UyZCgpXHJcblx0ICByZXR1cm4gTWF0aC5wb3coIChhWzBdLWJbMF0pLCAyICkgKyBNYXRoLnBvdyggKGFbMl0tYlsyXSksIDIgKSA8IChuKm4pXHJcbiAgfSxcclxuICBkaXN0YW5jZTNkQ29tcGFyZSA9ICggYSwgYiwgbiApID0+IHsgLy8gLi5mYXN0ZXIgdGhhbiB1c2luZyBNYXRoLnNxcnQoKVxyXG5cdCAgcmV0dXJuIChNYXRoLnBvdyggKGFbMF0tYlswXSksIDIgKSArIE1hdGgucG93KCAoYVsxXS1iWzFdKSwgMiApICsgTWF0aC5wb3coIChhWzJdLWJbMl0pLCAyICkgKSA8IChuKm4pXHJcbiAgfVxyXG5cclxubGV0IG9ic2VydmVyID0ge1xyXG5cdFx0cG9zaXRpb246IFswLCAwLCAwXSxcclxuXHRcdHByZXZQb3M6IFswLCAwLCAwXSxcclxuXHRcdHZlbG9jaXR5OiBbMCwgMCwgMF0sXHJcblx0XHR2ckhlaWdodDogMFxyXG5cdH0sXHJcblx0dm94ZWxMaXN0ID0gW10sXHJcblx0dm94ZWxzID0gW11cclxuXHJcbnNlbGYudXBkYXRlID0gKCApID0+IHtcclxuXHJcblx0dmFyIGRpc3RhbmNlID0gMCxcclxuXHRcdHBvc2l0aW9uIFx0ID0gb2JzZXJ2ZXIucG9zaXRpb24sXHJcblx0XHRpbm5lckJveCBcdCA9IFtmYWxzZSwgZmFsc2VdLFxyXG5cdFx0dmVsb2NpdHkgXHQgPSBvYnNlcnZlci52ZWxvY2l0eSxcclxuXHRcdHZySGVpZ2h0IFx0ID0gb2JzZXJ2ZXIudnJIZWlnaHQsXHJcblx0XHRjbG9zZVRvVmVudWUgPSBmYWxzZSxcclxuXHRcdGNvbGxpc2lvbiBcdCA9IGZhbHNlLFxyXG5cdFx0eVBvcyBcdFx0ID0gMCxcclxuXHRcdHZveGVsIFx0XHQgPSBudWxsLFxyXG5cdFx0ZW50IFx0XHQgPSBudWxsLFxyXG5cdFx0ZW50UmFkaXVzICAgID0gMTAsXHJcblx0XHRzdHJ1Y3R1cmUgXHQgPSBudWxsLFxyXG5cdFx0Ym91bmRzIFx0XHQgPSBbMCwgMF0sXHJcblx0XHR2b3hlbCBcdFx0ID0gbnVsbCxcclxuXHRcdGRlbHRhIFx0XHQgPSBbMCwgMF0sXHJcblx0XHRvUG9zIFx0XHQgPSBbXSxcclxuXHRcdHNwZWVkIFx0XHQgPSAwLFxyXG5cdFx0ZSBcdFx0XHQgPSAwLFxyXG5cdFx0aSBcdFx0XHQgPSAwLFxyXG5cdFx0diBcdFx0XHQgPSAwXHJcblxyXG5cdGZvciAoIGkgPSAwOyBpIDwgdm94ZWxMaXN0Lmxlbmd0aDsgaSArKyApIHtcclxuXHRcdHZveGVsID0gdm94ZWxMaXN0WyBpIF1cclxuXHJcblx0XHRpZiAoICEhIXZveGVsIHx8ICEhIXZveGVsLnBvc2l0aW9uKSBjb250aW51ZVxyXG5cclxuXHRcdGlmICggISF2b3hlbCAmJiBkaXN0YW5jZTJkQ29tcGFyZSggcG9zaXRpb24sIHZveGVsLnBvc2l0aW9uLCAxODAgKSApIHsgXHQvLyBkbyBjb2xsaXNpb25zIG9uIHZveGVscyAmIHN0cnVjdHVyZXMuLi4ganVzdCB3YWxscyBhdCBmaXJzdC4uXHRcdFxyXG5cdFx0XHRpZiAoIHZveGVsLmxvYWRlZCA9PSB1bmRlZmluZWQgKSB7XHJcblx0XHRcdFx0dm94ZWwubG9hZGVkID0gdHJ1ZVxyXG5cdFx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoJ3tcImNvbW1hbmRcIjogXCJsb2FkIGVudGl0aWVzXCIsIFwiZGF0YVwiOntcImNvb3Jkc1wiOlwiJyt2b3hlbC5jZWxsWzBdKycuJyt2b3hlbC5jZWxsWzFdKycuJyt2b3hlbC5jZWxsWzJdKydcIn19Jyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICggZGlzdGFuY2UyZENvbXBhcmUoIHBvc2l0aW9uLCB2b3hlbC5wb3NpdGlvbiwgNjAgKSApIHtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdGxldCBhbHQgPSB2b3hlbC5hbHRpdHVkZSB8fCAwXHJcblx0XHRcdFx0XHJcblx0XHRcdFx0eVBvcyA9IHZveGVsLnBvc2l0aW9uWzFdXHJcblx0XHRcdFx0XHJcblx0XHRcdFx0aWYgKCBkaXN0YW5jZTJkQ29tcGFyZSggcG9zaXRpb24sIHZveGVsLnBvc2l0aW9uLCAyNC41ICkgKSB7XHJcblx0XHRcdFx0XHRpZiAoIHBvc2l0aW9uWzFdID4geVBvcyAtIDIxICsgdnJIZWlnaHQgICYmIHBvc2l0aW9uWzFdIDwgeVBvcyArIDE0LjI1ICsgKHZySGVpZ2h0ICE9IDAgPyB2ckhlaWdodC0xIDogMCkgKSB7XHJcblx0XHRcdFx0XHRcdGNvbGxpc2lvbiA9IHRydWVcclxuXHRcdFx0XHRcdFx0c2VsZi5wb3N0TWVzc2FnZSgne1wiY29tbWFuZFwiOiBcInBsYXRmb3JtIGNvbGxpc2lvblwiLCBcImRhdGFcIjp7XCJ0eXBlXCI6XCJ0b3BcIiwgXCJwb3NpdGlvblwiOlsnICsgdm94ZWwucG9zaXRpb25bMF0gKyAnLCcgKyB5UG9zICsgJywnICsgdm94ZWwucG9zaXRpb25bMl0gKyAnXSB9fScpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cdFxyXG5cdFx0XHRcdGlmICggISF2b3hlbC5lbnRpdGllcyAmJiB2b3hlbC5lbnRpdGllcy5sZW5ndGggPiAwICkge1xyXG5cdFx0XHRcdFx0ZSA9IHZveGVsLmVudGl0aWVzLmxlbmd0aCAtIDFcclxuXHJcblx0XHRcdFx0XHR3aGlsZSAoIGUgPj0gMCApIHtcclxuXHRcdFx0XHRcdFx0ZW50ID0gdm94ZWwuZW50aXRpZXNbIGUgXVxyXG5cdFx0XHRcdFx0XHRlbnRSYWRpdXMgPSBlbnQuYm91bmRpbmdSYWRpdXMgXHJcblxyXG5cdFx0XHRcdFx0XHRpZiAoICEhISBlbnQgfHwgISEhZW50LmNvbXBvbmVudHMgKSB7IGNvbnNvbGUud2FybihcIlByb2JsZW0gd2l0aCBlbnRpdHkhIFwiLGUgLGVudCk7IGNvbnRpbnVlIH1cclxuXHRcdFx0XHRcdFx0aWYgKCBkaXN0YW5jZTNkQ29tcGFyZSggcG9zaXRpb24sIFtlbnQucG9zaXRpb25bMF0tZW50UmFkaXVzLCBlbnQucG9zaXRpb25bMV0sIGVudC5wb3NpdGlvblsyXS1lbnRSYWRpdXNdLCAoZW50UmFkaXVzKjEuNnx8MykrMi41KSApIHsgXHJcblx0XHRcdFx0XHRcdFx0ZW50LmNvbXBvbmVudHMubWFwKCBlbnRDb21wID0+IHtcclxuXHRcdFx0XHRcdFx0XHRcdGxldCBib3VuZGluZ1JhZGl1cyA9IGVudENvbXAuYm91bmRpbmdSYWRpdXMqMS4yIHx8IE1hdGgubWF4KGVudENvbXAucHJvcHMuZ2VvbWV0cnkuc2l6ZVswXSwgZW50Q29tcC5wcm9wcy5nZW9tZXRyeS5zaXplWzJdKSoxLjRcclxuXHRcdFx0XHRcdFx0XHRcdGlmICggZGlzdGFuY2UyZENvbXBhcmUoIFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRwb3NpdGlvbiwgXHJcblx0XHRcdFx0XHRcdFx0XHRcdFsgZW50LnBvc2l0aW9uWzBdICsgZW50Q29tcC5wb3NpdGlvblswXSwgMCwgZW50LnBvc2l0aW9uWzJdICsgZW50Q29tcC5wb3NpdGlvblsyXV0sXHJcblx0XHRcdFx0XHRcdFx0XHRcdGJvdW5kaW5nUmFkaXVzICogMS41XHJcblx0XHRcdFx0XHRcdFx0XHQpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGlmICggISEgZW50Q29tcC5wcm9wcy5mbG9vciApIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRsZXQgdmVydGljYWxPZmZzZXQgPSAocG9zaXRpb25bMV0gKyAyIC0gKGVudENvbXAucG9zaXRpb25bMV0rZW50LnBvc2l0aW9uWzFdKSkgXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKCB2ZXJ0aWNhbE9mZnNldCA+IDAgJiYgdmVydGljYWxPZmZzZXQgPCA1ICkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2VsZi5wb3N0TWVzc2FnZSggSlNPTi5zdHJpbmdpZnkoIHtjb21tYW5kOiBcImZsb29yIGNvbGxpc2lvblwiLCBkYXRhOiB7IFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRwb3NpdGlvbjogZW50Q29tcC5wb3NpdGlvbiwgXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGZsb29yRGF0YTogZW50Q29tcC5wcm9wcy5mbG9vclxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fX0pKVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Y29sbGlzaW9uID0gdHJ1ZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICggZGlzdGFuY2UzZENvbXBhcmUoIFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHBvc2l0aW9uLCBcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRbIGVudC5wb3NpdGlvblswXSArIGVudENvbXAucG9zaXRpb25bMF0sIGVudC5wb3NpdGlvblsxXSArIGVudENvbXAucG9zaXRpb25bMV0sIGVudC5wb3NpdGlvblsyXSArIGVudENvbXAucG9zaXRpb25bMl1dLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGJvdW5kaW5nUmFkaXVzXHJcblx0XHRcdFx0XHRcdFx0XHRcdCkpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjb2xsaXNpb24gPSB0cnVlXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0c2VsZi5wb3N0TWVzc2FnZSggSlNPTi5zdHJpbmdpZnkoIHtjb21tYW5kOiBcImVudGl0eS11c2VyIGNvbGxpc2lvblwiLCBkYXRhOnsgcG9zaXRpb246IGVudENvbXAucG9zaXRpb24gfX0gKSApXHJcblx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGUgLT0gMVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cdFxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRpZiAoICFjb2xsaXNpb24gKVxyXG5cclxuXHRcdG9ic2VydmVyLnByZXZQb3MgPSBbIG9ic2VydmVyLnBvc2l0aW9uWzBdLCBvYnNlcnZlci5wb3NpdGlvblsxXSwgb2JzZXJ2ZXIucG9zaXRpb25bMl0gXVxyXG5cdFxyXG5cclxuXHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6IFwidXBkYXRlXCJ9JylcclxuXHRzZWxmLnVwZGF0ZUxvb3AgPSBzZXRUaW1lb3V0KCAoKSA9PiB7XHJcblx0XHRzZWxmLnVwZGF0ZSgpXHJcblx0fSwgMTUpXHJcblxyXG59XHJcblxyXG5zZWxmLm9ubWVzc2FnZSA9IGZ1bmN0aW9uICggZXZlbnQgKSB7IFxyXG5cclxuXHR2YXIgbWVzc2FnZSAgPSBKU09OLnBhcnNlKCBldmVudC5kYXRhICksXHJcblx0XHRkYXRhIFx0ID0gbWVzc2FnZS5kYXRhLFxyXG5cdFx0dXNlciBcdCA9IG9ic2VydmVyLFxyXG5cdFx0dm94ZWwgXHQgPSBudWxsLFxyXG5cdFx0dG9SZW1vdmUgPSBudWxsLFxyXG5cdFx0aXRlbXMgXHQgPSBbXSxcclxuXHRcdGVudGl0aWVzID0gW10sXHJcblx0XHRjIFx0XHQgPSAwLFxyXG5cdFx0cCBcdFx0ID0gMFxyXG5cdFx0XHJcblx0aWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJ1cGRhdGVcIiApIHtcclxuXHRcdC8vIHVzZXIucHJldlBvcyA9IFt1c2VyLnBvc2l0aW9uWzBdLCB1c2VyLnBvc2l0aW9uWzFdLCB1c2VyLnBvc2l0aW9uWzJdXTtcclxuXHRcdHVzZXIucG9zaXRpb24gPSBkYXRhLnBvc2l0aW9uXHJcblx0XHR1c2VyLnZlbG9jaXR5ID0gZGF0YS52ZWxvY2l0eVxyXG5cdFx0dXNlci52ckhlaWdodCA9IGRhdGEudnJIZWlnaHRcclxuXHRcdC8vc2VsZi5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeShzZWxmLm9ic2VydmVyKSk7XHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwiYWRkIHZveGVsc1wiICkge1xyXG5cclxuXHRcdHZveGVsTGlzdCA9IHZveGVsTGlzdC5jb25jYXQoZGF0YSlcclxuXHRcdGRhdGEubWFwKCB2ID0+IHtcclxuXHRcdFx0dm94ZWxzWyB2LmNlbGwuam9pbihcIi5cIikgXSA9IHZcclxuXHRcdH0pXHJcblxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInJlbW92ZSB2b3hlbHNcIiApIHtcclxuXHJcblx0XHRwID0gZGF0YS5sZW5ndGggLTFcclxuXHJcblx0XHR3aGlsZSAoIHAgPj0gMCApIHtcclxuXHJcblx0XHRcdHRvUmVtb3ZlID0gZGF0YVtwXVxyXG5cdFx0XHRjID0gdm94ZWxMaXN0Lmxlbmd0aC0xXHJcblxyXG5cdFx0XHR3aGlsZSAoIGMgPj0gMCApIHtcclxuXHJcblx0XHRcdFx0dm94ZWwgPSB2b3hlbExpc3RbIGMgXVxyXG5cdFx0XHRcdGlmICggdm94ZWwgIT0gbnVsbCAmJiB2b3hlbC5jZWxsWzBdID09IHRvUmVtb3ZlLmNlbGxbMF0gJiYgdm94ZWwuY2VsbFsxXSA9PSB0b1JlbW92ZS5jZWxsWzFdICAmJiB2b3hlbC5jZWxsWzJdID09IHRvUmVtb3ZlLmNlbGxbMl0gKSB7XHRcclxuXHRcdFx0XHRcdHZveGVsTGlzdC5zcGxpY2UoIGMsIDEgKVxyXG5cdFx0XHRcdFx0dm94ZWxzWyB2b3hlbC5jZWxsLmpvaW4oXCIuXCIpXSA9IG51bGxcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Yy0tXHJcblx0XHRcdH1cclxuXHRcdFx0cCAtLVxyXG5cdFx0fVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJhZGQgZW50aXR5XCIgKSB7XHJcblxyXG5cdFx0aWYgKCEhISB2b3hlbHNbZGF0YS5jb29yZHMuam9pbihcIi5cIildKVxyXG5cdFx0XHR2b3hlbHNbZGF0YS5jb29yZHMuam9pbihcIi5cIildID0geyBlbnRpdGllczogW10sIGNlbGw6IGRhdGEuY29vcmRzIH1cclxuXHJcbiAgICBcdGVudGl0aWVzID0gdm94ZWxzW2RhdGEuY29vcmRzLmpvaW4oXCIuXCIpXS5lbnRpdGllc1xyXG4gICAgXHRlbnRpdGllcy5wdXNoKCBkYXRhLmVudGl0eSApXHJcblxyXG4gIH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInJlbW92ZSBlbnRpdHlcIiApIHtcclxuXHJcbiAgICBcdGVudGl0aWVzID0gdm94ZWxzWyBkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKSBdLmVudGl0aWVzXHJcblxyXG5cdFx0aWYgKCBlbnRpdGllcyAhPSBudWxsICkge1xyXG5cclxuXHRcdFx0YyA9IGVudGl0aWVzLmxlbmd0aC0xXHJcblx0XHRcdHdoaWxlICggYyA+PSAwICkge1xyXG5cdFx0XHRcdGlmICggZW50aXRpZXNbY10uaWQgPT0gZGF0YS5lbnRpdHlJZCApIHtcclxuXHRcdFx0XHRcdHZveGVsc1sgZGF0YS5jb29yZHMuam9pbihcIi5cIikgXS5lbnRpdGllcy5zcGxpY2UoYywgMSlcclxuXHRcdFx0XHRcdGMgPSAtMVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjLS1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJ1cGRhdGUgZW50aXR5XCIgKSB7XHJcblxyXG5cdFx0ZW50aXRpZXMgPSB2b3hlbHNbIGRhdGEuY29vcmRzLmpvaW4oXCIuXCIpIF0uZW50aXRpZXNcclxuXHJcblx0XHRpZiAoIGVudGl0aWVzICE9IG51bGwgKSB7XHJcblx0XHRcdGMgPSBlbnRpdGllcy5sZW5ndGgtMVxyXG5cclxuXHRcdFx0d2hpbGUgKCBjID49IDAgKSB7XHJcblx0XHRcdFx0aWYgKGVudGl0aWVzWyBjIF0uaWQgPT0gZGF0YS5lbnRpdHlJZCkge1xyXG5cdFx0XHRcdFx0ZW50aXRpZXNbIGMgXSA9IGRhdGEuZW50aXR5XHJcblx0XHRcdFx0XHRjID0gLTFcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Yy0tXHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwiY2xlYXJcIiApIHtcclxuXHJcblx0XHR2b3hlbHMgPSBbXVxyXG5cdFx0dm94ZWxMaXN0ID0gW11cclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwic3RhcnRcIiApIHtcclxuXHJcblx0XHRzZWxmLnVwZGF0ZSgpXHJcblxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInN0b3BcIiApIHtcclxuXHJcblx0XHRzZWxmLnN0b3AoKVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJsb2dcIiApIHtcclxuXHRcdGlmIChkYXRhID09IFwiXCIpIHtcclxuXHRcdFx0c2VsZi5wb3N0TWVzc2FnZSgne1wiY29tbWFuZFwiOlwibG9nXCIsXCJkYXRhXCI6WycgKyB1c2VyLnBvc2l0aW9uWzBdICsgJywnICsgdXNlci5wb3NpdGlvblsxXSArICcsJyArIHVzZXIucG9zaXRpb25bMl0gKyAnXX0nKTtcclxuXHRcdFx0c2VsZi5wb3N0TWVzc2FnZSgne1wiY29tbWFuZFwiOlwibG9nXCIsXCJkYXRhXCI6JyArIEpTT04uc3RyaW5naWZ5KHZveGVscykrICd9Jyk7XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxuc2VsZi5zdG9wID0gKCkgPT4ge1xyXG5cdGNsZWFyVGltZW91dCggc2VsZi51cGRhdGVMb29wIClcclxufVxyXG4iXX0=
