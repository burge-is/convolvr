(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

/*  static collision detection worker */

var distance2d = function distance2d(a, b) {
	return Math.sqrt(Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2));
},
    distance2dCompare = function distance2dCompare(a, b, n) {
	// more efficient version of distance2d()
	return Math.pow(a[0] - b[0], 2) + Math.pow(a[2] - b[2], 2) < n * n;
},
    distance3dCompare = function distance3dCompare(a, b, n) {
	// ..faster than using Math.sqrt()
	return Math.pow(a[0] - b[0], 2) + Math.pow(a[1] - b[1], 2) + Math.pow(a[2] - b[2], 2) < n * n;
};

var observer = {
	position: [0, 0, 0],
	prevPos: [0, 0, 0],
	velocity: [0, 0, 0],
	vrHeight: 0
},
    voxelList = [],
    voxels = [];

self.update = function () {

	var distance = 0,
	    position = observer.position,
	    innerBox = [false, false],
	    velocity = observer.velocity,
	    vrHeight = observer.vrHeight,
	    closeToVenue = false,
	    collision = false,
	    yPos = 0,
	    voxel = null,
	    ent = null,
	    entRadius = 10,
	    structure = null,
	    bounds = [0, 0],
	    voxel = null,
	    delta = [0, 0],
	    oPos = [],
	    speed = 0,
	    e = 0,
	    i = 0,
	    v = 0;

	for (i = 0; i < voxelList.length; i++) {
		voxel = voxelList[i];

		if (!!!voxel || !!!voxel.position) continue;

		if (!!voxel && distance2dCompare(position, voxel.position, 180)) {
			// do collisions on voxels & structures... just walls at first..		
			if (voxel.loaded == undefined) {
				voxel.loaded = true;
				self.postMessage('{"command": "load entities", "data":{"coords":"' + voxel.cell[0] + '.' + voxel.cell[1] + '.' + voxel.cell[2] + '"}}');
			}

			if (distance2dCompare(position, voxel.position, 60)) {

				var alt = voxel.altitude || 0;

				yPos = voxel.position[1];

				if (distance2dCompare(position, voxel.position, 24.5)) {
					if (position[1] > yPos - 21 + vrHeight && position[1] < yPos + 14.25 + (vrHeight != 0 ? vrHeight - 1 : 0)) {
						collision = true;
						self.postMessage('{"command": "platform collision", "data":{"type":"top", "position":[' + voxel.position[0] + ',' + yPos + ',' + voxel.position[2] + '] }}');
					}
				}
				if (!!voxel.entities && voxel.entities.length > 0) {
					e = voxel.entities.length - 1;

					while (e >= 0) {
						ent = voxel.entities[e];
						entRadius = ent.boundingRadius;

						if (!!!ent || !!!ent.components) {
							console.warn("Problem with entity! ", e, ent);continue;
						}
						if (distance3dCompare(position, [ent.position[0] - entRadius, ent.position[1], ent.position[2] - entRadius], (entRadius * 1.6 || 3) + 2.5)) {
							ent.components.map(function (entComp) {
								var boundingRadius = entComp.boundingRadius * 1.2 || Math.max(entComp.props.geometry.size[0], entComp.props.geometry.size[2]) * 1.4;
								if (distance2dCompare(position, [ent.position[0] + entComp.position[0], 0, ent.position[2] + entComp.position[2]], boundingRadius * 1.5)) {
									if (!!entComp.props.floor) {
										var verticalOffset = position[1] + 2 - (entComp.position[1] + ent.position[1]);
										if (verticalOffset > 0 && verticalOffset < 5) {
											self.postMessage(JSON.stringify({ command: "floor collision", data: {
													position: entComp.position,
													floorData: entComp.props.floor
												} }));
											collision = true;
										}
									} else if (distance3dCompare(position, [ent.position[0] + entComp.position[0], ent.position[1] + entComp.position[1], ent.position[2] + entComp.position[2]], boundingRadius)) {
										collision = true;
										self.postMessage(JSON.stringify({ command: "entity-user collision", data: { position: entComp.position } }));
									}
								}
							});
						}
						e -= 1;
					}
				}
			}
		}
	}

	if (!collision) observer.prevPos = [observer.position[0], observer.position[1], observer.position[2]];

	self.postMessage('{"command": "update"}');
	self.updateLoop = setTimeout(function () {
		self.update();
	}, 15);
};

self.onmessage = function (event) {

	var message = JSON.parse(event.data),
	    data = message.data,
	    user = observer,
	    voxel = null,
	    toRemove = null,
	    items = [],
	    entities = [],
	    c = 0,
	    p = 0;

	if (message.command == "update") {
		// user.prevPos = [user.position[0], user.position[1], user.position[2]];
		user.position = data.position;
		user.velocity = data.velocity;
		user.vrHeight = data.vrHeight;
		//self.postMessage(JSON.stringify(self.observer));
	} else if (message.command == "add voxels") {

		voxelList = voxelList.concat(data);
		data.map(function (v) {
			voxels[v.cell.join(".")] = v;
		});
	} else if (message.command == "remove voxels") {

		p = data.length - 1;

		while (p >= 0) {

			toRemove = data[p];
			c = voxelList.length - 1;

			while (c >= 0) {

				voxel = voxelList[c];
				if (voxel != null && voxel.cell[0] == toRemove.cell[0] && voxel.cell[1] == toRemove.cell[1] && voxel.cell[2] == toRemove.cell[2]) {
					voxelList.splice(c, 1);
					voxels[voxel.cell.join(".")] = null;
				}
				c--;
			}
			p--;
		}
	} else if (message.command == "add entity") {

		if (!!!voxels[data.coords.join(".")]) voxels[data.coords.join(".")] = { entities: [], cell: data.coords };

		entities = voxels[data.coords.join(".")].entities;
		entities.push(data.entity);
	} else if (message.command == "remove entity") {

		entities = voxels[data.coords.join(".")].entities;

		if (entities != null) {

			c = entities.length - 1;
			while (c >= 0) {
				if (entities[c].id == data.entityId) {
					voxels[data.coords.join(".")].entities.splice(c, 1);
					c = -1;
				}
				c--;
			}
		}
	} else if (message.command == "update entity") {

		entities = voxels[data.coords.join(".")].entities;

		if (entities != null) {
			c = entities.length - 1;

			while (c >= 0) {
				if (entities[c].id == data.entityId) {
					entities[c] = data.entity;
					c = -1;
				}
				c--;
			}
		}
	} else if (message.command == "clear") {

		voxels = [];
		voxelList = [];
	} else if (message.command == "start") {

		self.update();
	} else if (message.command == "stop") {

		self.stop();
	} else if (message.command == "log") {
		if (data == "") {
			self.postMessage('{"command":"log","data":[' + user.position[0] + ',' + user.position[1] + ',' + user.position[2] + ']}');
			self.postMessage('{"command":"log","data":' + JSON.stringify(voxels) + '}');
		}
	}
};

self.stop = function () {
	clearTimeout(self.updateLoop);
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmNcXGpzXFx3b3JrZXJzXFxzdGF0aWMtY29sbGlzaW9ucy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUE7O0FBRUEsSUFBSSxhQUFhLFNBQWIsVUFBYSxDQUFFLENBQUYsRUFBSyxDQUFMLEVBQVk7QUFDekIsUUFBTyxLQUFLLElBQUwsQ0FBVyxLQUFLLEdBQUwsQ0FBVyxFQUFFLENBQUYsSUFBSyxFQUFFLENBQUYsQ0FBaEIsRUFBdUIsQ0FBdkIsSUFBNkIsS0FBSyxHQUFMLENBQVcsRUFBRSxDQUFGLElBQUssRUFBRSxDQUFGLENBQWhCLEVBQXVCLENBQXZCLENBQXhDLENBQVA7QUFDRCxDQUZIO0FBQUEsSUFHRSxvQkFBb0IsU0FBcEIsaUJBQW9CLENBQUUsQ0FBRixFQUFLLENBQUwsRUFBUSxDQUFSLEVBQWU7QUFBRTtBQUNwQyxRQUFPLEtBQUssR0FBTCxDQUFXLEVBQUUsQ0FBRixJQUFLLEVBQUUsQ0FBRixDQUFoQixFQUF1QixDQUF2QixJQUE2QixLQUFLLEdBQUwsQ0FBVyxFQUFFLENBQUYsSUFBSyxFQUFFLENBQUYsQ0FBaEIsRUFBdUIsQ0FBdkIsQ0FBN0IsR0FBMkQsSUFBRSxDQUFwRTtBQUNBLENBTEg7QUFBQSxJQU1FLG9CQUFvQixTQUFwQixpQkFBb0IsQ0FBRSxDQUFGLEVBQUssQ0FBTCxFQUFRLENBQVIsRUFBZTtBQUFFO0FBQ3BDLFFBQVEsS0FBSyxHQUFMLENBQVcsRUFBRSxDQUFGLElBQUssRUFBRSxDQUFGLENBQWhCLEVBQXVCLENBQXZCLElBQTZCLEtBQUssR0FBTCxDQUFXLEVBQUUsQ0FBRixJQUFLLEVBQUUsQ0FBRixDQUFoQixFQUF1QixDQUF2QixDQUE3QixHQUEwRCxLQUFLLEdBQUwsQ0FBVyxFQUFFLENBQUYsSUFBSyxFQUFFLENBQUYsQ0FBaEIsRUFBdUIsQ0FBdkIsQ0FBM0QsR0FBMkYsSUFBRSxDQUFwRztBQUNBLENBUkg7O0FBVUEsSUFBSSxXQUFXO0FBQ2IsV0FBVSxDQUFDLENBQUQsRUFBSSxDQUFKLEVBQU8sQ0FBUCxDQURHO0FBRWIsVUFBUyxDQUFDLENBQUQsRUFBSSxDQUFKLEVBQU8sQ0FBUCxDQUZJO0FBR2IsV0FBVSxDQUFDLENBQUQsRUFBSSxDQUFKLEVBQU8sQ0FBUCxDQUhHO0FBSWIsV0FBVTtBQUpHLENBQWY7QUFBQSxJQU1DLFlBQVksRUFOYjtBQUFBLElBT0MsU0FBUyxFQVBWOztBQVNBLEtBQUssTUFBTCxHQUFjLFlBQU87O0FBRXBCLEtBQUksV0FBVyxDQUFmO0FBQUEsS0FDQyxXQUFhLFNBQVMsUUFEdkI7QUFBQSxLQUVDLFdBQWEsQ0FBQyxLQUFELEVBQVEsS0FBUixDQUZkO0FBQUEsS0FHQyxXQUFhLFNBQVMsUUFIdkI7QUFBQSxLQUlDLFdBQWEsU0FBUyxRQUp2QjtBQUFBLEtBS0MsZUFBZSxLQUxoQjtBQUFBLEtBTUMsWUFBYyxLQU5mO0FBQUEsS0FPQyxPQUFVLENBUFg7QUFBQSxLQVFDLFFBQVcsSUFSWjtBQUFBLEtBU0MsTUFBUyxJQVRWO0FBQUEsS0FVQyxZQUFlLEVBVmhCO0FBQUEsS0FXQyxZQUFjLElBWGY7QUFBQSxLQVlDLFNBQVksQ0FBQyxDQUFELEVBQUksQ0FBSixDQVpiO0FBQUEsS0FhQyxRQUFXLElBYlo7QUFBQSxLQWNDLFFBQVcsQ0FBQyxDQUFELEVBQUksQ0FBSixDQWRaO0FBQUEsS0FlQyxPQUFVLEVBZlg7QUFBQSxLQWdCQyxRQUFXLENBaEJaO0FBQUEsS0FpQkMsSUFBUSxDQWpCVDtBQUFBLEtBa0JDLElBQVEsQ0FsQlQ7QUFBQSxLQW1CQyxJQUFRLENBbkJUOztBQXFCQSxNQUFNLElBQUksQ0FBVixFQUFhLElBQUksVUFBVSxNQUEzQixFQUFtQyxHQUFuQyxFQUEwQztBQUN6QyxVQUFRLFVBQVcsQ0FBWCxDQUFSOztBQUVBLE1BQUssQ0FBQyxDQUFDLENBQUMsS0FBSCxJQUFZLENBQUMsQ0FBQyxDQUFDLE1BQU0sUUFBMUIsRUFBb0M7O0FBRXBDLE1BQUssQ0FBQyxDQUFDLEtBQUYsSUFBVyxrQkFBbUIsUUFBbkIsRUFBNkIsTUFBTSxRQUFuQyxFQUE2QyxHQUE3QyxDQUFoQixFQUFxRTtBQUFHO0FBQ3ZFLE9BQUssTUFBTSxNQUFOLElBQWdCLFNBQXJCLEVBQWlDO0FBQ2hDLFVBQU0sTUFBTixHQUFlLElBQWY7QUFDQSxTQUFLLFdBQUwsQ0FBaUIsb0RBQWtELE1BQU0sSUFBTixDQUFXLENBQVgsQ0FBbEQsR0FBZ0UsR0FBaEUsR0FBb0UsTUFBTSxJQUFOLENBQVcsQ0FBWCxDQUFwRSxHQUFrRixHQUFsRixHQUFzRixNQUFNLElBQU4sQ0FBVyxDQUFYLENBQXRGLEdBQW9HLEtBQXJIO0FBQ0E7O0FBRUQsT0FBSyxrQkFBbUIsUUFBbkIsRUFBNkIsTUFBTSxRQUFuQyxFQUE2QyxFQUE3QyxDQUFMLEVBQXlEOztBQUV4RCxRQUFJLE1BQU0sTUFBTSxRQUFOLElBQWtCLENBQTVCOztBQUVBLFdBQU8sTUFBTSxRQUFOLENBQWUsQ0FBZixDQUFQOztBQUVBLFFBQUssa0JBQW1CLFFBQW5CLEVBQTZCLE1BQU0sUUFBbkMsRUFBNkMsSUFBN0MsQ0FBTCxFQUEyRDtBQUMxRCxTQUFLLFNBQVMsQ0FBVCxJQUFjLE9BQU8sRUFBUCxHQUFZLFFBQTFCLElBQXVDLFNBQVMsQ0FBVCxJQUFjLE9BQU8sS0FBUCxJQUFnQixZQUFZLENBQVosR0FBZ0IsV0FBUyxDQUF6QixHQUE2QixDQUE3QyxDQUExRCxFQUE0RztBQUMzRyxrQkFBWSxJQUFaO0FBQ0EsV0FBSyxXQUFMLENBQWlCLHlFQUF5RSxNQUFNLFFBQU4sQ0FBZSxDQUFmLENBQXpFLEdBQTZGLEdBQTdGLEdBQW1HLElBQW5HLEdBQTBHLEdBQTFHLEdBQWdILE1BQU0sUUFBTixDQUFlLENBQWYsQ0FBaEgsR0FBb0ksTUFBcko7QUFDQTtBQUNEO0FBQ0QsUUFBSyxDQUFDLENBQUMsTUFBTSxRQUFSLElBQW9CLE1BQU0sUUFBTixDQUFlLE1BQWYsR0FBd0IsQ0FBakQsRUFBcUQ7QUFDcEQsU0FBSSxNQUFNLFFBQU4sQ0FBZSxNQUFmLEdBQXdCLENBQTVCOztBQUVBLFlBQVEsS0FBSyxDQUFiLEVBQWlCO0FBQ2hCLFlBQU0sTUFBTSxRQUFOLENBQWdCLENBQWhCLENBQU47QUFDQSxrQkFBWSxJQUFJLGNBQWhCOztBQUVBLFVBQUssQ0FBQyxDQUFDLENBQUUsR0FBSixJQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksVUFBdkIsRUFBb0M7QUFBRSxlQUFRLElBQVIsQ0FBYSx1QkFBYixFQUFxQyxDQUFyQyxFQUF3QyxHQUF4QyxFQUE4QztBQUFVO0FBQzlGLFVBQUssa0JBQW1CLFFBQW5CLEVBQTZCLENBQUMsSUFBSSxRQUFKLENBQWEsQ0FBYixJQUFnQixTQUFqQixFQUE0QixJQUFJLFFBQUosQ0FBYSxDQUFiLENBQTVCLEVBQTZDLElBQUksUUFBSixDQUFhLENBQWIsSUFBZ0IsU0FBN0QsQ0FBN0IsRUFBc0csQ0FBQyxZQUFVLEdBQVYsSUFBZSxDQUFoQixJQUFtQixHQUF6SCxDQUFMLEVBQXFJO0FBQ3BJLFdBQUksVUFBSixDQUFlLEdBQWYsQ0FBb0IsbUJBQVc7QUFDOUIsWUFBSSxpQkFBaUIsUUFBUSxjQUFSLEdBQXVCLEdBQXZCLElBQThCLEtBQUssR0FBTCxDQUFTLFFBQVEsS0FBUixDQUFjLFFBQWQsQ0FBdUIsSUFBdkIsQ0FBNEIsQ0FBNUIsQ0FBVCxFQUF5QyxRQUFRLEtBQVIsQ0FBYyxRQUFkLENBQXVCLElBQXZCLENBQTRCLENBQTVCLENBQXpDLElBQXlFLEdBQTVIO0FBQ0EsWUFBSyxrQkFDSixRQURJLEVBRUosQ0FBRSxJQUFJLFFBQUosQ0FBYSxDQUFiLElBQWtCLFFBQVEsUUFBUixDQUFpQixDQUFqQixDQUFwQixFQUF5QyxDQUF6QyxFQUE0QyxJQUFJLFFBQUosQ0FBYSxDQUFiLElBQWtCLFFBQVEsUUFBUixDQUFpQixDQUFqQixDQUE5RCxDQUZJLEVBR0osaUJBQWlCLEdBSGIsQ0FBTCxFQUlHO0FBQ0YsYUFBSyxDQUFDLENBQUUsUUFBUSxLQUFSLENBQWMsS0FBdEIsRUFBOEI7QUFDN0IsY0FBSSxpQkFBa0IsU0FBUyxDQUFULElBQWMsQ0FBZCxJQUFtQixRQUFRLFFBQVIsQ0FBaUIsQ0FBakIsSUFBb0IsSUFBSSxRQUFKLENBQWEsQ0FBYixDQUF2QyxDQUF0QjtBQUNBLGNBQUssaUJBQWlCLENBQWpCLElBQXNCLGlCQUFpQixDQUE1QyxFQUFnRDtBQUMvQyxnQkFBSyxXQUFMLENBQWtCLEtBQUssU0FBTCxDQUFnQixFQUFDLFNBQVMsaUJBQVYsRUFBNkIsTUFBTTtBQUNwRSx1QkFBVSxRQUFRLFFBRGtEO0FBRXBFLHdCQUFXLFFBQVEsS0FBUixDQUFjO0FBRjJDLGFBQW5DLEVBQWhCLENBQWxCO0FBSUEsdUJBQVksSUFBWjtBQUNBO0FBQ0QsVUFURCxNQVNPLElBQUssa0JBQ1gsUUFEVyxFQUVYLENBQUUsSUFBSSxRQUFKLENBQWEsQ0FBYixJQUFrQixRQUFRLFFBQVIsQ0FBaUIsQ0FBakIsQ0FBcEIsRUFBeUMsSUFBSSxRQUFKLENBQWEsQ0FBYixJQUFrQixRQUFRLFFBQVIsQ0FBaUIsQ0FBakIsQ0FBM0QsRUFBZ0YsSUFBSSxRQUFKLENBQWEsQ0FBYixJQUFrQixRQUFRLFFBQVIsQ0FBaUIsQ0FBakIsQ0FBbEcsQ0FGVyxFQUdYLGNBSFcsQ0FBTCxFQUlKO0FBQ0Ysc0JBQVksSUFBWjtBQUNBLGVBQUssV0FBTCxDQUFrQixLQUFLLFNBQUwsQ0FBZ0IsRUFBQyxTQUFTLHVCQUFWLEVBQW1DLE1BQUssRUFBRSxVQUFVLFFBQVEsUUFBcEIsRUFBeEMsRUFBaEIsQ0FBbEI7QUFDQTtBQUNEO0FBQ0QsUUF6QkQ7QUEwQkE7QUFDRCxXQUFLLENBQUw7QUFDQTtBQUNEO0FBQ0Q7QUFDRDtBQUNEOztBQUVELEtBQUssQ0FBQyxTQUFOLEVBRUMsU0FBUyxPQUFULEdBQW1CLENBQUUsU0FBUyxRQUFULENBQWtCLENBQWxCLENBQUYsRUFBd0IsU0FBUyxRQUFULENBQWtCLENBQWxCLENBQXhCLEVBQThDLFNBQVMsUUFBVCxDQUFrQixDQUFsQixDQUE5QyxDQUFuQjs7QUFHRCxNQUFLLFdBQUwsQ0FBaUIsdUJBQWpCO0FBQ0EsTUFBSyxVQUFMLEdBQWtCLFdBQVksWUFBTTtBQUNuQyxPQUFLLE1BQUw7QUFDQSxFQUZpQixFQUVmLEVBRmUsQ0FBbEI7QUFJQSxDQW5HRDs7QUFxR0EsS0FBSyxTQUFMLEdBQWlCLFVBQVcsS0FBWCxFQUFtQjs7QUFFbkMsS0FBSSxVQUFXLEtBQUssS0FBTCxDQUFZLE1BQU0sSUFBbEIsQ0FBZjtBQUFBLEtBQ0MsT0FBUyxRQUFRLElBRGxCO0FBQUEsS0FFQyxPQUFTLFFBRlY7QUFBQSxLQUdDLFFBQVUsSUFIWDtBQUFBLEtBSUMsV0FBVyxJQUpaO0FBQUEsS0FLQyxRQUFVLEVBTFg7QUFBQSxLQU1DLFdBQVcsRUFOWjtBQUFBLEtBT0MsSUFBTyxDQVBSO0FBQUEsS0FRQyxJQUFPLENBUlI7O0FBVUEsS0FBSyxRQUFRLE9BQVIsSUFBbUIsUUFBeEIsRUFBbUM7QUFDbEM7QUFDQSxPQUFLLFFBQUwsR0FBZ0IsS0FBSyxRQUFyQjtBQUNBLE9BQUssUUFBTCxHQUFnQixLQUFLLFFBQXJCO0FBQ0EsT0FBSyxRQUFMLEdBQWdCLEtBQUssUUFBckI7QUFDQTtBQUNBLEVBTkQsTUFNTyxJQUFLLFFBQVEsT0FBUixJQUFtQixZQUF4QixFQUF1Qzs7QUFFN0MsY0FBWSxVQUFVLE1BQVYsQ0FBaUIsSUFBakIsQ0FBWjtBQUNBLE9BQUssR0FBTCxDQUFVLGFBQUs7QUFDZCxVQUFRLEVBQUUsSUFBRixDQUFPLElBQVAsQ0FBWSxHQUFaLENBQVIsSUFBNkIsQ0FBN0I7QUFDQSxHQUZEO0FBSUEsRUFQTSxNQU9BLElBQUssUUFBUSxPQUFSLElBQW1CLGVBQXhCLEVBQTBDOztBQUVoRCxNQUFJLEtBQUssTUFBTCxHQUFhLENBQWpCOztBQUVBLFNBQVEsS0FBSyxDQUFiLEVBQWlCOztBQUVoQixjQUFXLEtBQUssQ0FBTCxDQUFYO0FBQ0EsT0FBSSxVQUFVLE1BQVYsR0FBaUIsQ0FBckI7O0FBRUEsVUFBUSxLQUFLLENBQWIsRUFBaUI7O0FBRWhCLFlBQVEsVUFBVyxDQUFYLENBQVI7QUFDQSxRQUFLLFNBQVMsSUFBVCxJQUFpQixNQUFNLElBQU4sQ0FBVyxDQUFYLEtBQWlCLFNBQVMsSUFBVCxDQUFjLENBQWQsQ0FBbEMsSUFBc0QsTUFBTSxJQUFOLENBQVcsQ0FBWCxLQUFpQixTQUFTLElBQVQsQ0FBYyxDQUFkLENBQXZFLElBQTRGLE1BQU0sSUFBTixDQUFXLENBQVgsS0FBaUIsU0FBUyxJQUFULENBQWMsQ0FBZCxDQUFsSCxFQUFxSTtBQUNwSSxlQUFVLE1BQVYsQ0FBa0IsQ0FBbEIsRUFBcUIsQ0FBckI7QUFDQSxZQUFRLE1BQU0sSUFBTixDQUFXLElBQVgsQ0FBZ0IsR0FBaEIsQ0FBUixJQUFnQyxJQUFoQztBQUNBO0FBQ0Q7QUFDQTtBQUNEO0FBQ0E7QUFFRCxFQXJCTSxNQXFCQSxJQUFLLFFBQVEsT0FBUixJQUFtQixZQUF4QixFQUF1Qzs7QUFFN0MsTUFBSSxDQUFDLENBQUMsQ0FBRSxPQUFPLEtBQUssTUFBTCxDQUFZLElBQVosQ0FBaUIsR0FBakIsQ0FBUCxDQUFSLEVBQ0MsT0FBTyxLQUFLLE1BQUwsQ0FBWSxJQUFaLENBQWlCLEdBQWpCLENBQVAsSUFBZ0MsRUFBRSxVQUFVLEVBQVosRUFBZ0IsTUFBTSxLQUFLLE1BQTNCLEVBQWhDOztBQUVFLGFBQVcsT0FBTyxLQUFLLE1BQUwsQ0FBWSxJQUFaLENBQWlCLEdBQWpCLENBQVAsRUFBOEIsUUFBekM7QUFDQSxXQUFTLElBQVQsQ0FBZSxLQUFLLE1BQXBCO0FBRUYsRUFSSyxNQVFDLElBQUssUUFBUSxPQUFSLElBQW1CLGVBQXhCLEVBQTBDOztBQUU5QyxhQUFXLE9BQVEsS0FBSyxNQUFMLENBQVksSUFBWixDQUFpQixHQUFqQixDQUFSLEVBQWdDLFFBQTNDOztBQUVILE1BQUssWUFBWSxJQUFqQixFQUF3Qjs7QUFFdkIsT0FBSSxTQUFTLE1BQVQsR0FBZ0IsQ0FBcEI7QUFDQSxVQUFRLEtBQUssQ0FBYixFQUFpQjtBQUNoQixRQUFLLFNBQVMsQ0FBVCxFQUFZLEVBQVosSUFBa0IsS0FBSyxRQUE1QixFQUF1QztBQUN0QyxZQUFRLEtBQUssTUFBTCxDQUFZLElBQVosQ0FBaUIsR0FBakIsQ0FBUixFQUFnQyxRQUFoQyxDQUF5QyxNQUF6QyxDQUFnRCxDQUFoRCxFQUFtRCxDQUFuRDtBQUNBLFNBQUksQ0FBQyxDQUFMO0FBQ0E7QUFDRDtBQUNBO0FBQ0Q7QUFFRCxFQWhCTyxNQWdCRCxJQUFLLFFBQVEsT0FBUixJQUFtQixlQUF4QixFQUEwQzs7QUFFaEQsYUFBVyxPQUFRLEtBQUssTUFBTCxDQUFZLElBQVosQ0FBaUIsR0FBakIsQ0FBUixFQUFnQyxRQUEzQzs7QUFFQSxNQUFLLFlBQVksSUFBakIsRUFBd0I7QUFDdkIsT0FBSSxTQUFTLE1BQVQsR0FBZ0IsQ0FBcEI7O0FBRUEsVUFBUSxLQUFLLENBQWIsRUFBaUI7QUFDaEIsUUFBSSxTQUFVLENBQVYsRUFBYyxFQUFkLElBQW9CLEtBQUssUUFBN0IsRUFBdUM7QUFDdEMsY0FBVSxDQUFWLElBQWdCLEtBQUssTUFBckI7QUFDQSxTQUFJLENBQUMsQ0FBTDtBQUNBO0FBQ0Q7QUFDQTtBQUNEO0FBRUQsRUFoQk0sTUFnQkEsSUFBSyxRQUFRLE9BQVIsSUFBbUIsT0FBeEIsRUFBa0M7O0FBRXhDLFdBQVMsRUFBVDtBQUNBLGNBQVksRUFBWjtBQUVBLEVBTE0sTUFLQSxJQUFLLFFBQVEsT0FBUixJQUFtQixPQUF4QixFQUFrQzs7QUFFeEMsT0FBSyxNQUFMO0FBRUEsRUFKTSxNQUlBLElBQUssUUFBUSxPQUFSLElBQW1CLE1BQXhCLEVBQWlDOztBQUV2QyxPQUFLLElBQUw7QUFFQSxFQUpNLE1BSUEsSUFBSyxRQUFRLE9BQVIsSUFBbUIsS0FBeEIsRUFBZ0M7QUFDdEMsTUFBSSxRQUFRLEVBQVosRUFBZ0I7QUFDZixRQUFLLFdBQUwsQ0FBaUIsOEJBQThCLEtBQUssUUFBTCxDQUFjLENBQWQsQ0FBOUIsR0FBaUQsR0FBakQsR0FBdUQsS0FBSyxRQUFMLENBQWMsQ0FBZCxDQUF2RCxHQUEwRSxHQUExRSxHQUFnRixLQUFLLFFBQUwsQ0FBYyxDQUFkLENBQWhGLEdBQW1HLElBQXBIO0FBQ0EsUUFBSyxXQUFMLENBQWlCLDZCQUE2QixLQUFLLFNBQUwsQ0FBZSxNQUFmLENBQTdCLEdBQXFELEdBQXRFO0FBQ0E7QUFDRDtBQUNELENBekdEOztBQTJHQSxLQUFLLElBQUwsR0FBWSxZQUFNO0FBQ2pCLGNBQWMsS0FBSyxVQUFuQjtBQUNBLENBRkQiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyogIHN0YXRpYyBjb2xsaXNpb24gZGV0ZWN0aW9uIHdvcmtlciAqL1xyXG5cclxubGV0IGRpc3RhbmNlMmQgPSAoIGEsIGIgKSA9PiB7XHJcbiAgICByZXR1cm4gTWF0aC5zcXJ0KCBNYXRoLnBvdyggKGFbMF0tYlswXSksIDIgKSArIE1hdGgucG93KCAoYVsyXS1iWzJdKSwgMiApIClcclxuICB9LFxyXG4gIGRpc3RhbmNlMmRDb21wYXJlID0gKCBhLCBiLCBuICkgPT4geyAvLyBtb3JlIGVmZmljaWVudCB2ZXJzaW9uIG9mIGRpc3RhbmNlMmQoKVxyXG5cdCAgcmV0dXJuIE1hdGgucG93KCAoYVswXS1iWzBdKSwgMiApICsgTWF0aC5wb3coIChhWzJdLWJbMl0pLCAyICkgPCAobipuKVxyXG4gIH0sXHJcbiAgZGlzdGFuY2UzZENvbXBhcmUgPSAoIGEsIGIsIG4gKSA9PiB7IC8vIC4uZmFzdGVyIHRoYW4gdXNpbmcgTWF0aC5zcXJ0KClcclxuXHQgIHJldHVybiAoTWF0aC5wb3coIChhWzBdLWJbMF0pLCAyICkgKyBNYXRoLnBvdyggKGFbMV0tYlsxXSksIDIgKSArIE1hdGgucG93KCAoYVsyXS1iWzJdKSwgMiApICkgPCAobipuKVxyXG4gIH1cclxuXHJcbmxldCBvYnNlcnZlciA9IHtcclxuXHRcdHBvc2l0aW9uOiBbMCwgMCwgMF0sXHJcblx0XHRwcmV2UG9zOiBbMCwgMCwgMF0sXHJcblx0XHR2ZWxvY2l0eTogWzAsIDAsIDBdLFxyXG5cdFx0dnJIZWlnaHQ6IDBcclxuXHR9LFxyXG5cdHZveGVsTGlzdCA9IFtdLFxyXG5cdHZveGVscyA9IFtdXHJcblxyXG5zZWxmLnVwZGF0ZSA9ICggKSA9PiB7XHJcblxyXG5cdHZhciBkaXN0YW5jZSA9IDAsXHJcblx0XHRwb3NpdGlvbiBcdCA9IG9ic2VydmVyLnBvc2l0aW9uLFxyXG5cdFx0aW5uZXJCb3ggXHQgPSBbZmFsc2UsIGZhbHNlXSxcclxuXHRcdHZlbG9jaXR5IFx0ID0gb2JzZXJ2ZXIudmVsb2NpdHksXHJcblx0XHR2ckhlaWdodCBcdCA9IG9ic2VydmVyLnZySGVpZ2h0LFxyXG5cdFx0Y2xvc2VUb1ZlbnVlID0gZmFsc2UsXHJcblx0XHRjb2xsaXNpb24gXHQgPSBmYWxzZSxcclxuXHRcdHlQb3MgXHRcdCA9IDAsXHJcblx0XHR2b3hlbCBcdFx0ID0gbnVsbCxcclxuXHRcdGVudCBcdFx0ID0gbnVsbCxcclxuXHRcdGVudFJhZGl1cyAgICA9IDEwLFxyXG5cdFx0c3RydWN0dXJlIFx0ID0gbnVsbCxcclxuXHRcdGJvdW5kcyBcdFx0ID0gWzAsIDBdLFxyXG5cdFx0dm94ZWwgXHRcdCA9IG51bGwsXHJcblx0XHRkZWx0YSBcdFx0ID0gWzAsIDBdLFxyXG5cdFx0b1BvcyBcdFx0ID0gW10sXHJcblx0XHRzcGVlZCBcdFx0ID0gMCxcclxuXHRcdGUgXHRcdFx0ID0gMCxcclxuXHRcdGkgXHRcdFx0ID0gMCxcclxuXHRcdHYgXHRcdFx0ID0gMFxyXG5cclxuXHRmb3IgKCBpID0gMDsgaSA8IHZveGVsTGlzdC5sZW5ndGg7IGkgKysgKSB7XHJcblx0XHR2b3hlbCA9IHZveGVsTGlzdFsgaSBdXHJcblxyXG5cdFx0aWYgKCAhISF2b3hlbCB8fCAhISF2b3hlbC5wb3NpdGlvbikgY29udGludWVcclxuXHJcblx0XHRpZiAoICEhdm94ZWwgJiYgZGlzdGFuY2UyZENvbXBhcmUoIHBvc2l0aW9uLCB2b3hlbC5wb3NpdGlvbiwgMTgwICkgKSB7IFx0Ly8gZG8gY29sbGlzaW9ucyBvbiB2b3hlbHMgJiBzdHJ1Y3R1cmVzLi4uIGp1c3Qgd2FsbHMgYXQgZmlyc3QuLlx0XHRcclxuXHRcdFx0aWYgKCB2b3hlbC5sb2FkZWQgPT0gdW5kZWZpbmVkICkge1xyXG5cdFx0XHRcdHZveGVsLmxvYWRlZCA9IHRydWVcclxuXHRcdFx0XHRzZWxmLnBvc3RNZXNzYWdlKCd7XCJjb21tYW5kXCI6IFwibG9hZCBlbnRpdGllc1wiLCBcImRhdGFcIjp7XCJjb29yZHNcIjpcIicrdm94ZWwuY2VsbFswXSsnLicrdm94ZWwuY2VsbFsxXSsnLicrdm94ZWwuY2VsbFsyXSsnXCJ9fScpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIGRpc3RhbmNlMmRDb21wYXJlKCBwb3NpdGlvbiwgdm94ZWwucG9zaXRpb24sIDYwICkgKSB7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRsZXQgYWx0ID0gdm94ZWwuYWx0aXR1ZGUgfHwgMFxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdHlQb3MgPSB2b3hlbC5wb3NpdGlvblsxXVxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGlmICggZGlzdGFuY2UyZENvbXBhcmUoIHBvc2l0aW9uLCB2b3hlbC5wb3NpdGlvbiwgMjQuNSApICkge1xyXG5cdFx0XHRcdFx0aWYgKCBwb3NpdGlvblsxXSA+IHlQb3MgLSAyMSArIHZySGVpZ2h0ICAmJiBwb3NpdGlvblsxXSA8IHlQb3MgKyAxNC4yNSArICh2ckhlaWdodCAhPSAwID8gdnJIZWlnaHQtMSA6IDApICkge1xyXG5cdFx0XHRcdFx0XHRjb2xsaXNpb24gPSB0cnVlXHJcblx0XHRcdFx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoJ3tcImNvbW1hbmRcIjogXCJwbGF0Zm9ybSBjb2xsaXNpb25cIiwgXCJkYXRhXCI6e1widHlwZVwiOlwidG9wXCIsIFwicG9zaXRpb25cIjpbJyArIHZveGVsLnBvc2l0aW9uWzBdICsgJywnICsgeVBvcyArICcsJyArIHZveGVsLnBvc2l0aW9uWzJdICsgJ10gfX0nKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHRcclxuXHRcdFx0XHRpZiAoICEhdm94ZWwuZW50aXRpZXMgJiYgdm94ZWwuZW50aXRpZXMubGVuZ3RoID4gMCApIHtcclxuXHRcdFx0XHRcdGUgPSB2b3hlbC5lbnRpdGllcy5sZW5ndGggLSAxXHJcblxyXG5cdFx0XHRcdFx0d2hpbGUgKCBlID49IDAgKSB7XHJcblx0XHRcdFx0XHRcdGVudCA9IHZveGVsLmVudGl0aWVzWyBlIF1cclxuXHRcdFx0XHRcdFx0ZW50UmFkaXVzID0gZW50LmJvdW5kaW5nUmFkaXVzIFxyXG5cclxuXHRcdFx0XHRcdFx0aWYgKCAhISEgZW50IHx8ICEhIWVudC5jb21wb25lbnRzICkgeyBjb25zb2xlLndhcm4oXCJQcm9ibGVtIHdpdGggZW50aXR5ISBcIixlICxlbnQpOyBjb250aW51ZSB9XHJcblx0XHRcdFx0XHRcdGlmICggZGlzdGFuY2UzZENvbXBhcmUoIHBvc2l0aW9uLCBbZW50LnBvc2l0aW9uWzBdLWVudFJhZGl1cywgZW50LnBvc2l0aW9uWzFdLCBlbnQucG9zaXRpb25bMl0tZW50UmFkaXVzXSwgKGVudFJhZGl1cyoxLjZ8fDMpKzIuNSkgKSB7IFxyXG5cdFx0XHRcdFx0XHRcdGVudC5jb21wb25lbnRzLm1hcCggZW50Q29tcCA9PiB7XHJcblx0XHRcdFx0XHRcdFx0XHRsZXQgYm91bmRpbmdSYWRpdXMgPSBlbnRDb21wLmJvdW5kaW5nUmFkaXVzKjEuMiB8fCBNYXRoLm1heChlbnRDb21wLnByb3BzLmdlb21ldHJ5LnNpemVbMF0sIGVudENvbXAucHJvcHMuZ2VvbWV0cnkuc2l6ZVsyXSkqMS40XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoIGRpc3RhbmNlMmRDb21wYXJlKCBcclxuXHRcdFx0XHRcdFx0XHRcdFx0cG9zaXRpb24sIFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRbIGVudC5wb3NpdGlvblswXSArIGVudENvbXAucG9zaXRpb25bMF0sIDAsIGVudC5wb3NpdGlvblsyXSArIGVudENvbXAucG9zaXRpb25bMl1dLFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRib3VuZGluZ1JhZGl1cyAqIDEuNVxyXG5cdFx0XHRcdFx0XHRcdFx0KSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoICEhIGVudENvbXAucHJvcHMuZmxvb3IgKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0bGV0IHZlcnRpY2FsT2Zmc2V0ID0gKHBvc2l0aW9uWzFdICsgMiAtIChlbnRDb21wLnBvc2l0aW9uWzFdK2VudC5wb3NpdGlvblsxXSkpIFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmICggdmVydGljYWxPZmZzZXQgPiAwICYmIHZlcnRpY2FsT2Zmc2V0IDwgNSApIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoIEpTT04uc3RyaW5naWZ5KCB7Y29tbWFuZDogXCJmbG9vciBjb2xsaXNpb25cIiwgZGF0YTogeyBcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cG9zaXRpb246IGVudENvbXAucG9zaXRpb24sIFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRmbG9vckRhdGE6IGVudENvbXAucHJvcHMuZmxvb3JcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH19KSlcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGNvbGxpc2lvbiA9IHRydWVcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoIGRpc3RhbmNlM2RDb21wYXJlKCBcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRwb3NpdGlvbiwgXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0WyBlbnQucG9zaXRpb25bMF0gKyBlbnRDb21wLnBvc2l0aW9uWzBdLCBlbnQucG9zaXRpb25bMV0gKyBlbnRDb21wLnBvc2l0aW9uWzFdLCBlbnQucG9zaXRpb25bMl0gKyBlbnRDb21wLnBvc2l0aW9uWzJdXSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRib3VuZGluZ1JhZGl1c1xyXG5cdFx0XHRcdFx0XHRcdFx0XHQpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y29sbGlzaW9uID0gdHJ1ZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoIEpTT04uc3RyaW5naWZ5KCB7Y29tbWFuZDogXCJlbnRpdHktdXNlciBjb2xsaXNpb25cIiwgZGF0YTp7IHBvc2l0aW9uOiBlbnRDb21wLnBvc2l0aW9uIH19ICkgKVxyXG5cdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0fSlcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRlIC09IDFcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHRcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0aWYgKCAhY29sbGlzaW9uIClcclxuXHJcblx0XHRvYnNlcnZlci5wcmV2UG9zID0gWyBvYnNlcnZlci5wb3NpdGlvblswXSwgb2JzZXJ2ZXIucG9zaXRpb25bMV0sIG9ic2VydmVyLnBvc2l0aW9uWzJdIF1cclxuXHRcclxuXHJcblx0c2VsZi5wb3N0TWVzc2FnZSgne1wiY29tbWFuZFwiOiBcInVwZGF0ZVwifScpXHJcblx0c2VsZi51cGRhdGVMb29wID0gc2V0VGltZW91dCggKCkgPT4ge1xyXG5cdFx0c2VsZi51cGRhdGUoKVxyXG5cdH0sIDE1KVxyXG5cclxufVxyXG5cclxuc2VsZi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoIGV2ZW50ICkgeyBcclxuXHJcblx0dmFyIG1lc3NhZ2UgID0gSlNPTi5wYXJzZSggZXZlbnQuZGF0YSApLFxyXG5cdFx0ZGF0YSBcdCA9IG1lc3NhZ2UuZGF0YSxcclxuXHRcdHVzZXIgXHQgPSBvYnNlcnZlcixcclxuXHRcdHZveGVsIFx0ID0gbnVsbCxcclxuXHRcdHRvUmVtb3ZlID0gbnVsbCxcclxuXHRcdGl0ZW1zIFx0ID0gW10sXHJcblx0XHRlbnRpdGllcyA9IFtdLFxyXG5cdFx0YyBcdFx0ID0gMCxcclxuXHRcdHAgXHRcdCA9IDBcclxuXHRcdFxyXG5cdGlmICggbWVzc2FnZS5jb21tYW5kID09IFwidXBkYXRlXCIgKSB7XHJcblx0XHQvLyB1c2VyLnByZXZQb3MgPSBbdXNlci5wb3NpdGlvblswXSwgdXNlci5wb3NpdGlvblsxXSwgdXNlci5wb3NpdGlvblsyXV07XHJcblx0XHR1c2VyLnBvc2l0aW9uID0gZGF0YS5wb3NpdGlvblxyXG5cdFx0dXNlci52ZWxvY2l0eSA9IGRhdGEudmVsb2NpdHlcclxuXHRcdHVzZXIudnJIZWlnaHQgPSBkYXRhLnZySGVpZ2h0XHJcblx0XHQvL3NlbGYucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkoc2VsZi5vYnNlcnZlcikpO1xyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcImFkZCB2b3hlbHNcIiApIHtcclxuXHJcblx0XHR2b3hlbExpc3QgPSB2b3hlbExpc3QuY29uY2F0KGRhdGEpXHJcblx0XHRkYXRhLm1hcCggdiA9PiB7XHJcblx0XHRcdHZveGVsc1sgdi5jZWxsLmpvaW4oXCIuXCIpIF0gPSB2XHJcblx0XHR9KVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJyZW1vdmUgdm94ZWxzXCIgKSB7XHJcblxyXG5cdFx0cCA9IGRhdGEubGVuZ3RoIC0xXHJcblxyXG5cdFx0d2hpbGUgKCBwID49IDAgKSB7XHJcblxyXG5cdFx0XHR0b1JlbW92ZSA9IGRhdGFbcF1cclxuXHRcdFx0YyA9IHZveGVsTGlzdC5sZW5ndGgtMVxyXG5cclxuXHRcdFx0d2hpbGUgKCBjID49IDAgKSB7XHJcblxyXG5cdFx0XHRcdHZveGVsID0gdm94ZWxMaXN0WyBjIF1cclxuXHRcdFx0XHRpZiAoIHZveGVsICE9IG51bGwgJiYgdm94ZWwuY2VsbFswXSA9PSB0b1JlbW92ZS5jZWxsWzBdICYmIHZveGVsLmNlbGxbMV0gPT0gdG9SZW1vdmUuY2VsbFsxXSAgJiYgdm94ZWwuY2VsbFsyXSA9PSB0b1JlbW92ZS5jZWxsWzJdICkge1x0XHJcblx0XHRcdFx0XHR2b3hlbExpc3Quc3BsaWNlKCBjLCAxIClcclxuXHRcdFx0XHRcdHZveGVsc1sgdm94ZWwuY2VsbC5qb2luKFwiLlwiKV0gPSBudWxsXHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGMtLVxyXG5cdFx0XHR9XHJcblx0XHRcdHAgLS1cclxuXHRcdH1cclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwiYWRkIGVudGl0eVwiICkge1xyXG5cclxuXHRcdGlmICghISEgdm94ZWxzW2RhdGEuY29vcmRzLmpvaW4oXCIuXCIpXSlcclxuXHRcdFx0dm94ZWxzW2RhdGEuY29vcmRzLmpvaW4oXCIuXCIpXSA9IHsgZW50aXRpZXM6IFtdLCBjZWxsOiBkYXRhLmNvb3JkcyB9XHJcblxyXG4gICAgXHRlbnRpdGllcyA9IHZveGVsc1tkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKV0uZW50aXRpZXNcclxuICAgIFx0ZW50aXRpZXMucHVzaCggZGF0YS5lbnRpdHkgKVxyXG5cclxuICB9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJyZW1vdmUgZW50aXR5XCIgKSB7XHJcblxyXG4gICAgXHRlbnRpdGllcyA9IHZveGVsc1sgZGF0YS5jb29yZHMuam9pbihcIi5cIikgXS5lbnRpdGllc1xyXG5cclxuXHRcdGlmICggZW50aXRpZXMgIT0gbnVsbCApIHtcclxuXHJcblx0XHRcdGMgPSBlbnRpdGllcy5sZW5ndGgtMVxyXG5cdFx0XHR3aGlsZSAoIGMgPj0gMCApIHtcclxuXHRcdFx0XHRpZiAoIGVudGl0aWVzW2NdLmlkID09IGRhdGEuZW50aXR5SWQgKSB7XHJcblx0XHRcdFx0XHR2b3hlbHNbIGRhdGEuY29vcmRzLmpvaW4oXCIuXCIpIF0uZW50aXRpZXMuc3BsaWNlKGMsIDEpXHJcblx0XHRcdFx0XHRjID0gLTFcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Yy0tXHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwidXBkYXRlIGVudGl0eVwiICkge1xyXG5cclxuXHRcdGVudGl0aWVzID0gdm94ZWxzWyBkYXRhLmNvb3Jkcy5qb2luKFwiLlwiKSBdLmVudGl0aWVzXHJcblxyXG5cdFx0aWYgKCBlbnRpdGllcyAhPSBudWxsICkge1xyXG5cdFx0XHRjID0gZW50aXRpZXMubGVuZ3RoLTFcclxuXHJcblx0XHRcdHdoaWxlICggYyA+PSAwICkge1xyXG5cdFx0XHRcdGlmIChlbnRpdGllc1sgYyBdLmlkID09IGRhdGEuZW50aXR5SWQpIHtcclxuXHRcdFx0XHRcdGVudGl0aWVzWyBjIF0gPSBkYXRhLmVudGl0eVxyXG5cdFx0XHRcdFx0YyA9IC0xXHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGMtLVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcImNsZWFyXCIgKSB7XHJcblxyXG5cdFx0dm94ZWxzID0gW11cclxuXHRcdHZveGVsTGlzdCA9IFtdXHJcblxyXG5cdH0gZWxzZSBpZiAoIG1lc3NhZ2UuY29tbWFuZCA9PSBcInN0YXJ0XCIgKSB7XHJcblxyXG5cdFx0c2VsZi51cGRhdGUoKVxyXG5cclxuXHR9IGVsc2UgaWYgKCBtZXNzYWdlLmNvbW1hbmQgPT0gXCJzdG9wXCIgKSB7XHJcblxyXG5cdFx0c2VsZi5zdG9wKClcclxuXHJcblx0fSBlbHNlIGlmICggbWVzc2FnZS5jb21tYW5kID09IFwibG9nXCIgKSB7XHJcblx0XHRpZiAoZGF0YSA9PSBcIlwiKSB7XHJcblx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoJ3tcImNvbW1hbmRcIjpcImxvZ1wiLFwiZGF0YVwiOlsnICsgdXNlci5wb3NpdGlvblswXSArICcsJyArIHVzZXIucG9zaXRpb25bMV0gKyAnLCcgKyB1c2VyLnBvc2l0aW9uWzJdICsgJ119Jyk7XHJcblx0XHRcdHNlbGYucG9zdE1lc3NhZ2UoJ3tcImNvbW1hbmRcIjpcImxvZ1wiLFwiZGF0YVwiOicgKyBKU09OLnN0cmluZ2lmeSh2b3hlbHMpKyAnfScpO1xyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcbnNlbGYuc3RvcCA9ICgpID0+IHtcclxuXHRjbGVhclRpbWVvdXQoIHNlbGYudXBkYXRlTG9vcCApXHJcbn1cclxuIl19
